/*! CIC 2016-08-19 */
function RGBColor(color_string){this.ok=!1,"#"==color_string.charAt(0)&&(color_string=color_string.substr(1,6)),color_string=color_string.replace(/ /g,""),color_string=color_string.toLowerCase();var simple_colors={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};for(var key in simple_colors)color_string==key&&(color_string=simple_colors[key]);for(var color_defs=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(bits){return[parseInt(bits[1]),parseInt(bits[2]),parseInt(bits[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(bits){return[parseInt(bits[1],16),parseInt(bits[2],16),parseInt(bits[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(bits){return[parseInt(bits[1]+bits[1],16),parseInt(bits[2]+bits[2],16),parseInt(bits[3]+bits[3],16)]}}],i=0;i<color_defs.length;i++){var re=color_defs[i].re,processor=color_defs[i].process,bits=re.exec(color_string);bits&&(channels=processor(bits),this.r=channels[0],this.g=channels[1],this.b=channels[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var r=this.r.toString(16),g=this.g.toString(16),b=this.b.toString(16);return 1==r.length&&(r="0"+r),1==g.length&&(g="0"+g),1==b.length&&(b="0"+b),"#"+r+g+b},this.getHelpXML=function(){for(var examples=new Array,i=0;i<color_defs.length;i++)for(var example=color_defs[i].example,j=0;j<example.length;j++)examples[examples.length]=example[j];for(var sc in simple_colors)examples[examples.length]=sc;var xml=document.createElement("ul");xml.setAttribute("id","rgbcolor-examples");for(var i=0;i<examples.length;i++)try{var list_item=document.createElement("li"),list_color=new RGBColor(examples[i]),example_div=document.createElement("div");example_div.style.cssText="margin: 3px; border: 1px solid black; background:"+list_color.toHex()+"; color:"+list_color.toHex(),example_div.appendChild(document.createTextNode("test"));var list_item_value=document.createTextNode(" "+examples[i]+" -> "+list_color.toRGB()+" -> "+list_color.toHex());list_item.appendChild(example_div),list_item.appendChild(list_item_value),xml.appendChild(list_item)}catch(e){}return xml}}!function($,document,window){function $tag(tag,id,css){var element=document.createElement(tag);return id&&(element.id=prefix+id),css&&(element.style.cssText=css),$(element)}function winheight(){return window.innerHeight?window.innerHeight:$(window).height()}function Settings(element,options){options!==Object(options)&&(options={}),this.cache={},this.el=element,this.value=function(key){var dataAttr;return void 0===this.cache[key]&&(dataAttr=$(this.el).attr("data-cbox-"+key),void 0!==dataAttr?this.cache[key]=dataAttr:void 0!==options[key]?this.cache[key]=options[key]:void 0!==defaults[key]&&(this.cache[key]=defaults[key])),this.cache[key]},this.get=function(key){var value=this.value(key);return $.isFunction(value)?value.call(this.el,this):value}}function getIndex(increment){var max=$related.length,newIndex=(index+increment)%max;return 0>newIndex?max+newIndex:newIndex}function setSize(size,dimension){return Math.round((/%/.test(size)?("x"===dimension?$window.width():winheight())/100:1)*parseInt(size,10))}function isImage(settings,url){return settings.get("photo")||settings.get("photoRegex").test(url)}function retinaUrl(settings,url){return settings.get("retinaUrl")&&window.devicePixelRatio>1?url.replace(settings.get("photoRegex"),settings.get("retinaSuffix")):url}function trapFocus(e){"contains"in $box[0]&&!$box[0].contains(e.target)&&e.target!==$overlay[0]&&(e.stopPropagation(),$box.focus())}function setClass(str){setClass.str!==str&&($box.add($overlay).removeClass(setClass.str).addClass(str),setClass.str=str)}function getRelated(rel){index=0,rel&&rel!==!1&&"nofollow"!==rel?($related=$("."+boxElement).filter(function(){var options=$.data(this,colorbox),settings=new Settings(this,options);return settings.get("rel")===rel}),index=$related.index(settings.el),-1===index&&($related=$related.add(settings.el),index=$related.length-1)):$related=$(settings.el)}function trigger(event){$(document).trigger(event),$events.triggerHandler(event)}function launch(element){var options;if(!closing){if(options=$(element).data(colorbox),settings=new Settings(element,options),getRelated(settings.get("rel")),!open){open=active=!0,setClass(settings.get("className")),$box.css({visibility:"hidden",display:"block",opacity:""}),$loaded=$tag(div,"LoadedContent","width:0; height:0; overflow:hidden; visibility:hidden"),$content.css({width:"",height:""}).append($loaded),interfaceHeight=$topBorder.height()+$bottomBorder.height()+$content.outerHeight(!0)-$content.height(),interfaceWidth=$leftBorder.width()+$rightBorder.width()+$content.outerWidth(!0)-$content.width(),loadedHeight=$loaded.outerHeight(!0),loadedWidth=$loaded.outerWidth(!0);var initialWidth=setSize(settings.get("initialWidth"),"x"),initialHeight=setSize(settings.get("initialHeight"),"y"),maxWidth=settings.get("maxWidth"),maxHeight=settings.get("maxHeight");settings.w=(maxWidth!==!1?Math.min(initialWidth,setSize(maxWidth,"x")):initialWidth)-loadedWidth-interfaceWidth,settings.h=(maxHeight!==!1?Math.min(initialHeight,setSize(maxHeight,"y")):initialHeight)-loadedHeight-interfaceHeight,$loaded.css({width:"",height:settings.h}),publicMethod.position(),trigger(event_open),settings.get("onOpen"),$groupControls.add($title).hide(),$box.focus(),settings.get("trapFocus")&&document.addEventListener&&(document.addEventListener("focus",trapFocus,!0),$events.one(event_closed,function(){document.removeEventListener("focus",trapFocus,!0)})),settings.get("returnFocus")&&$events.one(event_closed,function(){$(settings.el).focus()})}var opacity=parseFloat(settings.get("opacity"));$overlay.css({opacity:opacity===opacity?opacity:"",cursor:settings.get("overlayClose")?"pointer":"",visibility:"visible"}).show(),settings.get("closeButton")?$close.html(settings.get("close")).appendTo($content):$close.appendTo("<div/>"),load()}}function appendHTML(){$box||(init=!1,$window=$(window),$box=$tag(div).attr({id:colorbox,"class":$.support.opacity===!1?prefix+"IE":"",role:"dialog",tabindex:"-1"}).hide(),$overlay=$tag(div,"Overlay").hide(),$loadingOverlay=$([$tag(div,"LoadingOverlay")[0],$tag(div,"LoadingGraphic")[0]]),$wrap=$tag(div,"Wrapper"),$content=$tag(div,"Content").append($title=$tag(div,"Title"),$current=$tag(div,"Current"),$prev=$('<button type="button"/>').attr({id:prefix+"Previous"}),$next=$('<button type="button"/>').attr({id:prefix+"Next"}),$slideshow=$tag("button","Slideshow"),$loadingOverlay),$close=$('<button type="button"/>').attr({id:prefix+"Close"}),$wrap.append($tag(div).append($tag(div,"TopLeft"),$topBorder=$tag(div,"TopCenter"),$tag(div,"TopRight")),$tag(div,!1,"clear:left").append($leftBorder=$tag(div,"MiddleLeft"),$content,$rightBorder=$tag(div,"MiddleRight")),$tag(div,!1,"clear:left").append($tag(div,"BottomLeft"),$bottomBorder=$tag(div,"BottomCenter"),$tag(div,"BottomRight"))).find("div div").css({"float":"left"}),$loadingBay=$tag(div,!1,"position:absolute; width:9999px; visibility:hidden; display:none; max-width:none;"),$groupControls=$next.add($prev).add($current).add($slideshow)),document.body&&!$box.parent().length&&$(document.body).append($overlay,$box.append($wrap,$loadingBay))}function addBindings(){function clickHandler(e){e.which>1||e.shiftKey||e.altKey||e.metaKey||e.ctrlKey||(e.preventDefault(),launch(this))}return $box?(init||(init=!0,$next.click(function(){publicMethod.next()}),$prev.click(function(){publicMethod.prev()}),$close.click(function(){publicMethod.close()}),$overlay.click(function(){settings.get("overlayClose")&&publicMethod.close()}),$(document).bind("keydown."+prefix,function(e){var key=e.keyCode;open&&settings.get("escKey")&&27===key&&(e.preventDefault(),publicMethod.close()),open&&settings.get("arrowKey")&&$related[1]&&!e.altKey&&(37===key?(e.preventDefault(),$prev.click()):39===key&&(e.preventDefault(),$next.click()))}),$.isFunction($.fn.on)?$(document).on("click."+prefix,"."+boxElement,clickHandler):$("."+boxElement).live("click."+prefix,clickHandler)),!0):!1}function load(){var href,setResize,$inline,prep=publicMethod.prep,request=++requests;if(active=!0,photo=!1,trigger(event_purge),trigger(event_load),settings.get("onLoad"),settings.h=settings.get("height")?setSize(settings.get("height"),"y")-loadedHeight-interfaceHeight:settings.get("innerHeight")&&setSize(settings.get("innerHeight"),"y"),settings.w=settings.get("width")?setSize(settings.get("width"),"x")-loadedWidth-interfaceWidth:settings.get("innerWidth")&&setSize(settings.get("innerWidth"),"x"),settings.mw=settings.w,settings.mh=settings.h,settings.get("maxWidth")&&(settings.mw=setSize(settings.get("maxWidth"),"x")-loadedWidth-interfaceWidth,settings.mw=settings.w&&settings.w<settings.mw?settings.w:settings.mw),settings.get("maxHeight")&&(settings.mh=setSize(settings.get("maxHeight"),"y")-loadedHeight-interfaceHeight,settings.mh=settings.h&&settings.h<settings.mh?settings.h:settings.mh),href=settings.get("href"),loadingTimer=setTimeout(function(){$loadingOverlay.show()},100),settings.get("inline")){var $target=$(href);$inline=$("<div>").hide().insertBefore($target),$events.one(event_purge,function(){$inline.replaceWith($target)}),prep($target)}else settings.get("iframe")?prep(" "):settings.get("html")?prep(settings.get("html")):isImage(settings,href)?(href=retinaUrl(settings,href),photo=settings.get("createImg"),$(photo).addClass(prefix+"Photo").bind("error",function(){prep($tag(div,"Error").html(settings.get("imgError")))}).one("load",function(){request===requests&&setTimeout(function(){var percent;settings.get("retinaImage")&&window.devicePixelRatio>1&&(photo.height=photo.height/window.devicePixelRatio,photo.width=photo.width/window.devicePixelRatio),settings.get("scalePhotos")&&(setResize=function(){photo.height-=photo.height*percent,photo.width-=photo.width*percent},settings.mw&&photo.width>settings.mw&&(percent=(photo.width-settings.mw)/photo.width,setResize()),settings.mh&&photo.height>settings.mh&&(percent=(photo.height-settings.mh)/photo.height,setResize())),settings.h&&(photo.style.marginTop=Math.max(settings.mh-photo.height,0)/2+"px"),$related[1]&&(settings.get("loop")||$related[index+1])&&(photo.style.cursor="pointer",photo.onclick=function(){publicMethod.next()}),photo.style.width=photo.width+"px",photo.style.height=photo.height+"px",prep(photo)},1)}),photo.src=href):href&&$loadingBay.load(href,settings.get("data"),function(data,status){request===requests&&prep("error"===status?$tag(div,"Error").html(settings.get("xhrError")):$(this).contents())})}var $overlay,$box,$wrap,$content,$topBorder,$leftBorder,$rightBorder,$bottomBorder,$related,$window,$loaded,$loadingBay,$loadingOverlay,$title,$current,$slideshow,$next,$prev,$close,$groupControls,settings,interfaceHeight,interfaceWidth,loadedHeight,loadedWidth,index,photo,open,active,closing,loadingTimer,publicMethod,init,defaults={html:!1,photo:!1,iframe:!1,inline:!1,transition:"elastic",speed:300,fadeOut:300,width:!1,initialWidth:"600",innerWidth:!1,maxWidth:!1,height:!1,initialHeight:"450",innerHeight:!1,maxHeight:!1,scalePhotos:!0,scrolling:!0,opacity:.9,preloading:!0,className:!1,overlayClose:!0,escKey:!0,arrowKey:!0,top:!1,bottom:!1,left:!1,right:!1,fixed:!1,data:void 0,closeButton:!0,fastIframe:!0,open:!1,reposition:!0,loop:!0,slideshow:!1,slideshowAuto:!0,slideshowSpeed:2500,slideshowStart:"start slideshow",slideshowStop:"stop slideshow",photoRegex:/\.(gif|png|jp(e|g|eg)|bmp|ico|webp|jxr|svg)((#|\?).*)?$/i,retinaImage:!1,retinaUrl:!1,retinaSuffix:"@2x.$1",current:"image {current} of {total}",previous:"previous",next:"next",close:"close",xhrError:"This content failed to load.",imgError:"This image failed to load.",returnFocus:!0,trapFocus:!0,onOpen:!1,onLoad:!1,onComplete:!1,onCleanup:!1,onClosed:!1,rel:function(){return this.rel},href:function(){return $(this).attr("href")},title:function(){return this.title},createImg:function(){var img=new Image,attrs=$(this).data("cbox-img-attrs");return"object"==typeof attrs&&$.each(attrs,function(key,val){img[key]=val}),img},createIframe:function(){var iframe=document.createElement("iframe"),attrs=$(this).data("cbox-iframe-attrs");return"object"==typeof attrs&&$.each(attrs,function(key,val){iframe[key]=val}),"frameBorder"in iframe&&(iframe.frameBorder=0),"allowTransparency"in iframe&&(iframe.allowTransparency="true"),iframe.name=(new Date).getTime(),iframe.allowFullScreen=!0,iframe}},colorbox="colorbox",prefix="cbox",boxElement=prefix+"Element",event_open=prefix+"_open",event_load=prefix+"_load",event_complete=prefix+"_complete",event_cleanup=prefix+"_cleanup",event_closed=prefix+"_closed",event_purge=prefix+"_purge",$events=$("<a/>"),div="div",requests=0,previousCSS={},slideshow=function(){function clear(){clearTimeout(timeOut)}function set(){(settings.get("loop")||$related[index+1])&&(clear(),timeOut=setTimeout(publicMethod.next,settings.get("slideshowSpeed")))}function start(){$slideshow.html(settings.get("slideshowStop")).unbind(click).one(click,stop),$events.bind(event_complete,set).bind(event_load,clear),$box.removeClass(className+"off").addClass(className+"on")}function stop(){clear(),$events.unbind(event_complete,set).unbind(event_load,clear),$slideshow.html(settings.get("slideshowStart")).unbind(click).one(click,function(){publicMethod.next(),start()}),$box.removeClass(className+"on").addClass(className+"off")}function reset(){active=!1,$slideshow.hide(),clear(),$events.unbind(event_complete,set).unbind(event_load,clear),$box.removeClass(className+"off "+className+"on")}var active,timeOut,className=prefix+"Slideshow_",click="click."+prefix;return function(){active?settings.get("slideshow")||($events.unbind(event_cleanup,reset),reset()):settings.get("slideshow")&&$related[1]&&(active=!0,$events.one(event_cleanup,reset),settings.get("slideshowAuto")?start():stop(),$slideshow.show())}}();$[colorbox]||($(appendHTML),publicMethod=$.fn[colorbox]=$[colorbox]=function(options,callback){var settings,$obj=this;return options=options||{},$.isFunction($obj)&&($obj=$("<a/>"),options.open=!0),$obj[0]?(appendHTML(),addBindings()&&(callback&&(options.onComplete=callback),$obj.each(function(){var old=$.data(this,colorbox)||{};$.data(this,colorbox,$.extend(old,options))}).addClass(boxElement),settings=new Settings($obj[0],options),settings.get("open")&&launch($obj[0])),$obj):$obj},publicMethod.position=function(speed,loadedCallback){function modalDimensions(){$topBorder[0].style.width=$bottomBorder[0].style.width=$content[0].style.width=parseInt($box[0].style.width,10)-interfaceWidth+"px",$content[0].style.height=$leftBorder[0].style.height=$rightBorder[0].style.height=parseInt($box[0].style.height,10)-interfaceHeight+"px"}var css,scrollTop,scrollLeft,top=0,left=0,offset=$box.offset();if($window.unbind("resize."+prefix),$box.css({top:-9e4,left:-9e4}),scrollTop=$window.scrollTop(),scrollLeft=$window.scrollLeft(),settings.get("fixed")?(offset.top-=scrollTop,offset.left-=scrollLeft,$box.css({position:"fixed"})):(top=scrollTop,left=scrollLeft,$box.css({position:"absolute"})),left+=settings.get("right")!==!1?Math.max($window.width()-settings.w-loadedWidth-interfaceWidth-setSize(settings.get("right"),"x"),0):settings.get("left")!==!1?setSize(settings.get("left"),"x"):Math.round(Math.max($window.width()-settings.w-loadedWidth-interfaceWidth,0)/2),top+=settings.get("bottom")!==!1?Math.max(winheight()-settings.h-loadedHeight-interfaceHeight-setSize(settings.get("bottom"),"y"),0):settings.get("top")!==!1?setSize(settings.get("top"),"y"):Math.round(Math.max(winheight()-settings.h-loadedHeight-interfaceHeight,0)/2),$box.css({top:offset.top,left:offset.left,visibility:"visible"}),$wrap[0].style.width=$wrap[0].style.height="9999px",css={width:settings.w+loadedWidth+interfaceWidth,height:settings.h+loadedHeight+interfaceHeight,top:top,left:left},speed){var tempSpeed=0;$.each(css,function(i){return css[i]!==previousCSS[i]?void(tempSpeed=speed):void 0}),speed=tempSpeed}previousCSS=css,speed||$box.css(css),$box.dequeue().animate(css,{duration:speed||0,complete:function(){modalDimensions(),active=!1,$wrap[0].style.width=settings.w+loadedWidth+interfaceWidth+"px",$wrap[0].style.height=settings.h+loadedHeight+interfaceHeight+"px",settings.get("reposition")&&setTimeout(function(){$window.bind("resize."+prefix,publicMethod.position)},1),$.isFunction(loadedCallback)&&loadedCallback()},step:modalDimensions})},publicMethod.resize=function(options){var scrolltop;open&&(options=options||{},options.width&&(settings.w=setSize(options.width,"x")-loadedWidth-interfaceWidth),options.innerWidth&&(settings.w=setSize(options.innerWidth,"x")),$loaded.css({width:settings.w}),options.height&&(settings.h=setSize(options.height,"y")-loadedHeight-interfaceHeight),options.innerHeight&&(settings.h=setSize(options.innerHeight,"y")),options.innerHeight||options.height||(scrolltop=$loaded.scrollTop(),$loaded.css({height:"auto"}),settings.h=$loaded.height()),$loaded.css({height:settings.h}),scrolltop&&$loaded.scrollTop(scrolltop),publicMethod.position("none"===settings.get("transition")?0:settings.get("speed")))},publicMethod.prep=function(object){function getWidth(){return settings.w=settings.w||$loaded.width(),settings.w=settings.mw&&settings.mw<settings.w?settings.mw:settings.w,settings.w}function getHeight(){return settings.h=settings.h||$loaded.height(),settings.h=settings.mh&&settings.mh<settings.h?settings.mh:settings.h,settings.h}if(open){var callback,speed="none"===settings.get("transition")?0:settings.get("speed");$loaded.remove(),$loaded=$tag(div,"LoadedContent").append(object),$loaded.hide().appendTo($loadingBay.show()).css({width:getWidth(),overflow:settings.get("scrolling")?"auto":"hidden"}).css({height:getHeight()}).prependTo($content),$loadingBay.hide(),$(photo).css({"float":"none"}),setClass(settings.get("className")),callback=function(){function removeFilter(){$.support.opacity===!1&&$box[0].style.removeAttribute("filter")}var iframe,complete,total=$related.length;open&&(complete=function(){clearTimeout(loadingTimer),$loadingOverlay.hide(),trigger(event_complete),settings.get("onComplete")},$title.html(settings.get("title")).show(),$loaded.show(),total>1?("string"==typeof settings.get("current")&&$current.html(settings.get("current").replace("{current}",index+1).replace("{total}",total)).show(),$next[settings.get("loop")||total-1>index?"show":"hide"]().html(settings.get("next")),$prev[settings.get("loop")||index?"show":"hide"]().html(settings.get("previous")),slideshow(),settings.get("preloading")&&$.each([getIndex(-1),getIndex(1)],function(){var img,i=$related[this],settings=new Settings(i,$.data(i,colorbox)),src=settings.get("href");src&&isImage(settings,src)&&(src=retinaUrl(settings,src),img=document.createElement("img"),img.src=src)})):$groupControls.hide(),settings.get("iframe")?(iframe=settings.get("createIframe"),settings.get("scrolling")||(iframe.scrolling="no"),$(iframe).attr({src:settings.get("href"),"class":prefix+"Iframe"}).one("load",complete).appendTo($loaded),$events.one(event_purge,function(){iframe.src="//about:blank"}),settings.get("fastIframe")&&$(iframe).trigger("load")):complete(),"fade"===settings.get("transition")?$box.fadeTo(speed,1,removeFilter):removeFilter())},"fade"===settings.get("transition")?$box.fadeTo(speed,0,function(){publicMethod.position(0,callback)}):publicMethod.position(speed,callback)}},publicMethod.next=function(){!active&&$related[1]&&(settings.get("loop")||$related[index+1])&&(index=getIndex(1),launch($related[index]))},publicMethod.prev=function(){!active&&$related[1]&&(settings.get("loop")||index)&&(index=getIndex(-1),launch($related[index]))},publicMethod.close=function(){open&&!closing&&(closing=!0,open=!1,trigger(event_cleanup),settings.get("onCleanup"),$window.unbind("."+prefix),$overlay.fadeTo(settings.get("fadeOut")||0,0),$box.stop().fadeTo(settings.get("fadeOut")||0,0,function(){$box.hide(),$overlay.hide(),trigger(event_purge),$loaded.remove(),setTimeout(function(){closing=!1,trigger(event_closed),settings.get("onClosed")},1)}))},publicMethod.remove=function(){$box&&($box.stop(),$[colorbox].close(),$box.stop(!1,!0).remove(),$overlay.remove(),closing=!1,$box=null,$("."+boxElement).removeData(colorbox).removeClass(boxElement),$(document).unbind("click."+prefix).unbind("keydown."+prefix))},publicMethod.element=function(){return $(settings.el)},publicMethod.settings=defaults)}(jQuery,document,window),function($){var defaults={swipeTolerance:40},touchStatus=function(target,touch){this.target=$(target),this.touch=touch,this.startX=this.currentX=touch.screenX,this.startY=this.currentY=touch.screenY,this.eventType=null};touchStatus.options={},touchStatus.latestTap=null,touchStatus.prototype.move=function(touch){this.currentX=touch.screenX,this.currentY=touch.screenY},touchStatus.prototype.process=function(){var offsetX=this.currentX-this.startX,offsetY=this.currentY-this.startY;0==offsetX&&0==offsetY?this.checkForDoubleTap():Math.abs(offsetY)>touchStatus.options.swipeTolerance&&Math.abs(offsetY)>Math.abs(offsetX)?(this.eventType=offsetY>0?"swipedown":"swipeup",this.target.trigger("swipe",[this])):Math.abs(offsetX)>touchStatus.options.swipeTolerance&&(this.eventType=offsetX>0?"swiperight":"swipeleft",this.target.trigger("swipe",[this])),this.eventType&&this.target.trigger(this.eventType,[this]),this.target.trigger("touch",[this])},touchStatus.prototype.checkForDoubleTap=function(){touchStatus.latestTap&&new Date-touchStatus.latestTap<400&&(this.eventType="doubletap"),this.eventType||(this.eventType="tap"),touchStatus.latestTap=new Date};var swipeEvents=function(elements,options){touchStatus.options=$.extend(defaults,options),elements.bind("touchstart",this.touchStart),elements.bind("touchmove",this.touchMove),elements.bind("touchcancel",this.touchCancel),elements.bind("touchend",this.touchEnd)};swipeEvents.prototype.touchStart=function(evt){var target=this;swipeEvents.eachTouch(evt,function(touch){swipeEvents.touches[touch.identifier]=new touchStatus(target,touch)})},swipeEvents.prototype.touchMove=function(evt){swipeEvents.eachTouch(evt,function(touch){var loc=swipeEvents.touches[touch.identifier];loc&&loc.move(touch)})},swipeEvents.prototype.touchCancel=function(evt){swipeEvents.eachTouch(evt,function(touch){swipeEvents.purge(touch,!0)})},swipeEvents.prototype.touchEnd=function(evt){swipeEvents.eachTouch(evt,function(touch){swipeEvents.purge(touch)})},swipeEvents.touches={},swipeEvents.purge=function(touch,cancelled){if(!cancelled){var loc=swipeEvents.touches[touch.identifier];loc&&loc.process()}delete swipeEvents.touches[touch.identifier]},swipeEvents.eachTouch=function(evt,callback){for(var evt=evt.originalEvent,num=evt.changedTouches.length,i=0;num>i;i++)callback(evt.changedTouches[i])},$.fn.addSwipeEvents=function(options,callback){return!callback&&jQuery.isFunction(options)&&(callback=options,options=null),new swipeEvents(this,options),callback&&this.bind("touch",callback),this}}(jQuery),"function"!=typeof Object.create&&(Object.create=function(a){function b(){}return b.prototype=a,new b}),function(a){var b={init:function(b){return this.options=a.extend({},a.noty.defaults,b),this.options.layout=this.options.custom?a.noty.layouts.inline:a.noty.layouts[this.options.layout],a.noty.themes[this.options.theme]?this.options.theme=a.noty.themes[this.options.theme]:b.themeClassName=this.options.theme,delete b.layout,delete b.theme,this.options=a.extend({},this.options,this.options.layout.options),this.options.id="noty_"+(new Date).getTime()*Math.floor(1e6*Math.random()),this.options=a.extend({},this.options,b),this._build(),this},_build:function(){var b=a('<div class="noty_bar noty_type_'+this.options.type+'"></div>').attr("id",this.options.id);if(b.append(this.options.template).find(".noty_text").html(this.options.text),this.$bar=null!==this.options.layout.parent.object?a(this.options.layout.parent.object).css(this.options.layout.parent.css).append(b):b,this.options.themeClassName&&this.$bar.addClass(this.options.themeClassName).addClass("noty_container_type_"+this.options.type),this.options.buttons){this.options.closeWith=[],this.options.timeout=!1;var c=a("<div/>").addClass("noty_buttons");null!==this.options.layout.parent.object?this.$bar.find(".noty_bar").append(c):this.$bar.append(c);var d=this;a.each(this.options.buttons,function(b,c){var e=a("<button/>").addClass(c.addClass?c.addClass:"gray").html(c.text).attr("id",c.id?c.id:"button-"+b).appendTo(d.$bar.find(".noty_buttons")).on("click",function(){a.isFunction(c.onClick)&&c.onClick.call(e,d)})})}this.$message=this.$bar.find(".noty_message"),this.$closeButton=this.$bar.find(".noty_close"),this.$buttons=this.$bar.find(".noty_buttons"),a.noty.store[this.options.id]=this},show:function(){var b=this;return b.options.custom?b.options.custom.find(b.options.layout.container.selector).append(b.$bar):a(b.options.layout.container.selector).append(b.$bar),b.options.theme&&b.options.theme.style&&b.options.theme.style.apply(b),"function"===a.type(b.options.layout.css)?this.options.layout.css.apply(b.$bar):b.$bar.css(this.options.layout.css||{}),b.$bar.addClass(b.options.layout.addClass),b.options.layout.container.style.apply(a(b.options.layout.container.selector)),b.showing=!0,b.options.theme&&b.options.theme.style&&b.options.theme.callback.onShow.apply(this),a.inArray("click",b.options.closeWith)>-1&&b.$bar.css("cursor","pointer").one("click",function(a){b.stopPropagation(a),b.options.callback.onCloseClick&&b.options.callback.onCloseClick.apply(b),b.close()}),a.inArray("hover",b.options.closeWith)>-1&&b.$bar.one("mouseenter",function(){b.close()}),a.inArray("button",b.options.closeWith)>-1&&b.$closeButton.one("click",function(a){b.stopPropagation(a),b.close()}),-1==a.inArray("button",b.options.closeWith)&&b.$closeButton.remove(),b.options.callback.onShow&&b.options.callback.onShow.apply(b),b.$bar.animate(b.options.animation.open,b.options.animation.speed,b.options.animation.easing,function(){b.options.callback.afterShow&&b.options.callback.afterShow.apply(b),b.showing=!1,b.shown=!0}),b.options.timeout&&b.$bar.delay(b.options.timeout).promise().done(function(){b.close()}),this},close:function(){if(!(this.closed||this.$bar&&this.$bar.hasClass("i-am-closing-now"))){var b=this;if(this.showing)return void b.$bar.queue(function(){b.close.apply(b)});if(!this.shown&&!this.showing){var c=[];return a.each(a.noty.queue,function(a,d){d.options.id!=b.options.id&&c.push(d)}),void(a.noty.queue=c)}b.$bar.addClass("i-am-closing-now"),b.options.callback.onClose&&b.options.callback.onClose.apply(b),b.$bar.clearQueue().stop().animate(b.options.animation.close,b.options.animation.speed,b.options.animation.easing,function(){b.options.callback.afterClose&&b.options.callback.afterClose.apply(b)}).promise().done(function(){b.options.modal&&(a.notyRenderer.setModalCount(-1),0==a.notyRenderer.getModalCount()&&a(".noty_modal").fadeOut("fast",function(){a(this).remove()})),a.notyRenderer.setLayoutCountFor(b,-1),0==a.notyRenderer.getLayoutCountFor(b)&&a(b.options.layout.container.selector).remove(),"undefined"!=typeof b.$bar&&null!==b.$bar&&(b.$bar.remove(),b.$bar=null,b.closed=!0),delete a.noty.store[b.options.id],b.options.theme.callback&&b.options.theme.callback.onClose&&b.options.theme.callback.onClose.apply(b),b.options.dismissQueue||(a.noty.ontap=!0,a.notyRenderer.render()),b.options.maxVisible>0&&b.options.dismissQueue&&a.notyRenderer.render()})}},setText:function(a){return this.closed||(this.options.text=a,this.$bar.find(".noty_text").html(a)),this},setType:function(a){return this.closed||(this.options.type=a,this.options.theme.style.apply(this),this.options.theme.callback.onShow.apply(this)),this},setTimeout:function(a){if(!this.closed){var b=this;this.options.timeout=a,b.$bar.delay(b.options.timeout).promise().done(function(){b.close()})}return this},stopPropagation:function(a){a=a||window.event,"undefined"!=typeof a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},closed:!1,showing:!1,shown:!1};a.notyRenderer={},a.notyRenderer.init=function(c){var d=Object.create(b).init(c);return d.options.killer&&a.noty.closeAll(),d.options.force?a.noty.queue.unshift(d):a.noty.queue.push(d),a.notyRenderer.render(),"object"==a.noty.returns?d:d.options.id},a.notyRenderer.render=function(){var b=a.noty.queue[0];"object"===a.type(b)?b.options.dismissQueue?b.options.maxVisible>0?a(b.options.layout.container.selector+" li").length<b.options.maxVisible&&a.notyRenderer.show(a.noty.queue.shift()):a.notyRenderer.show(a.noty.queue.shift()):a.noty.ontap&&(a.notyRenderer.show(a.noty.queue.shift()),a.noty.ontap=!1):a.noty.ontap=!0},a.notyRenderer.show=function(b){b.options.modal&&(a.notyRenderer.createModalFor(b),a.notyRenderer.setModalCount(1)),b.options.custom?0==b.options.custom.find(b.options.layout.container.selector).length?b.options.custom.append(a(b.options.layout.container.object).addClass("i-am-new")):b.options.custom.find(b.options.layout.container.selector).removeClass("i-am-new"):0==a(b.options.layout.container.selector).length?a("body").append(a(b.options.layout.container.object).addClass("i-am-new")):a(b.options.layout.container.selector).removeClass("i-am-new"),a.notyRenderer.setLayoutCountFor(b,1),b.show()
},a.notyRenderer.createModalFor=function(b){if(0==a(".noty_modal").length){var c=a("<div/>").addClass("noty_modal").addClass(b.options.theme).data("noty_modal_count",0);b.options.theme.modal&&b.options.theme.modal.css&&c.css(b.options.theme.modal.css),c.prependTo(a("body")).fadeIn("fast")}},a.notyRenderer.getLayoutCountFor=function(b){return a(b.options.layout.container.selector).data("noty_layout_count")||0},a.notyRenderer.setLayoutCountFor=function(b,c){return a(b.options.layout.container.selector).data("noty_layout_count",a.notyRenderer.getLayoutCountFor(b)+c)},a.notyRenderer.getModalCount=function(){return a(".noty_modal").data("noty_modal_count")||0},a.notyRenderer.setModalCount=function(b){return a(".noty_modal").data("noty_modal_count",a.notyRenderer.getModalCount()+b)},a.fn.noty=function(b){return b.custom=a(this),a.notyRenderer.init(b)},a.noty={},a.noty.queue=[],a.noty.ontap=!0,a.noty.layouts={},a.noty.themes={},a.noty.returns="object",a.noty.store={},a.noty.get=function(b){return a.noty.store.hasOwnProperty(b)?a.noty.store[b]:!1},a.noty.close=function(b){return a.noty.get(b)?a.noty.get(b).close():!1},a.noty.setText=function(b,c){return a.noty.get(b)?a.noty.get(b).setText(c):!1},a.noty.setType=function(b,c){return a.noty.get(b)?a.noty.get(b).setType(c):!1},a.noty.clearQueue=function(){a.noty.queue=[]},a.noty.closeAll=function(){a.noty.clearQueue(),a.each(a.noty.store,function(a,b){b.close()})};var c=window.alert;a.noty.consumeAlert=function(b){window.alert=function(c){b?b.text=c:b={text:c},a.notyRenderer.init(b)}},a.noty.stopConsumeAlert=function(){window.alert=c},a.noty.defaults={layout:"top",theme:"defaultTheme",type:"alert",text:"",dismissQueue:!0,template:'<div class="noty_message"><span class="noty_text"></span><div class="noty_close"></div></div>',animation:{open:{height:"toggle"},close:{height:"toggle"},easing:"swing",speed:500},timeout:!1,force:!1,modal:!1,maxVisible:5,killer:!1,closeWith:["click"],callback:{onShow:function(){},afterShow:function(){},onClose:function(){},afterClose:function(){},onCloseClick:function(){}},buttons:!1},a(window).on("resize",function(){a.each(a.noty.layouts,function(b,c){c.container.style.apply(a(c.container.selector))})})}(jQuery),window.noty=function(a){return jQuery.notyRenderer.init(a)},function(a){a.noty.layouts.bottom={name:"bottom",options:{},container:{object:'<ul id="noty_bottom_layout_container" />',selector:"ul#noty_bottom_layout_container",style:function(){a(this).css({bottom:0,left:"5%",position:"fixed",width:"90%",height:"auto",margin:0,padding:0,listStyleType:"none",zIndex:9999999})}},parent:{object:"<li />",selector:"li",css:{}},css:{display:"none"},addClass:""}}(jQuery),function(a){a.noty.layouts.bottomCenter={name:"bottomCenter",options:{},container:{object:'<ul id="noty_bottomCenter_layout_container" />',selector:"ul#noty_bottomCenter_layout_container",style:function(){a(this).css({bottom:20,left:0,position:"fixed",width:"310px",height:"auto",margin:0,padding:0,listStyleType:"none",zIndex:1e7}),a(this).css({left:(a(window).width()-a(this).outerWidth(!1))/2+"px"})}},parent:{object:"<li />",selector:"li",css:{}},css:{display:"none",width:"310px"},addClass:""}}(jQuery),function(a){a.noty.layouts.bottomLeft={name:"bottomLeft",options:{},container:{object:'<ul id="noty_bottomLeft_layout_container" />',selector:"ul#noty_bottomLeft_layout_container",style:function(){a(this).css({bottom:20,left:20,position:"fixed",width:"310px",height:"auto",margin:0,padding:0,listStyleType:"none",zIndex:1e7}),window.innerWidth<600&&a(this).css({left:5})}},parent:{object:"<li />",selector:"li",css:{}},css:{display:"none",width:"310px"},addClass:""}}(jQuery),function(a){a.noty.layouts.bottomRight={name:"bottomRight",options:{},container:{object:'<ul id="noty_bottomRight_layout_container" />',selector:"ul#noty_bottomRight_layout_container",style:function(){a(this).css({bottom:20,right:20,position:"fixed",width:"310px",height:"auto",margin:0,padding:0,listStyleType:"none",zIndex:1e7}),window.innerWidth<600&&a(this).css({right:5})}},parent:{object:"<li />",selector:"li",css:{}},css:{display:"none",width:"310px"},addClass:""}}(jQuery),function(a){a.noty.layouts.center={name:"center",options:{},container:{object:'<ul id="noty_center_layout_container" />',selector:"ul#noty_center_layout_container",style:function(){a(this).css({position:"fixed",width:"310px",height:"auto",margin:0,padding:0,listStyleType:"none",zIndex:1e7});var b=a(this).clone().css({visibility:"hidden",display:"block",position:"absolute",top:0,left:0}).attr("id","dupe");a("body").append(b),b.find(".i-am-closing-now").remove(),b.find("li").css("display","block");var c=b.height();b.remove(),a(this).hasClass("i-am-new")?a(this).css({left:(a(window).width()-a(this).outerWidth(!1))/2+"px",top:(a(window).height()-c)/2+"px"}):a(this).animate({left:(a(window).width()-a(this).outerWidth(!1))/2+"px",top:(a(window).height()-c)/2+"px"},500)}},parent:{object:"<li />",selector:"li",css:{}},css:{display:"none",width:"310px"},addClass:""}}(jQuery),function(a){a.noty.layouts.centerLeft={name:"centerLeft",options:{},container:{object:'<ul id="noty_centerLeft_layout_container" />',selector:"ul#noty_centerLeft_layout_container",style:function(){a(this).css({left:20,position:"fixed",width:"310px",height:"auto",margin:0,padding:0,listStyleType:"none",zIndex:1e7});var b=a(this).clone().css({visibility:"hidden",display:"block",position:"absolute",top:0,left:0}).attr("id","dupe");a("body").append(b),b.find(".i-am-closing-now").remove(),b.find("li").css("display","block");var c=b.height();b.remove(),a(this).hasClass("i-am-new")?a(this).css({top:(a(window).height()-c)/2+"px"}):a(this).animate({top:(a(window).height()-c)/2+"px"},500),window.innerWidth<600&&a(this).css({left:5})}},parent:{object:"<li />",selector:"li",css:{}},css:{display:"none",width:"310px"},addClass:""}}(jQuery),function(a){a.noty.layouts.centerRight={name:"centerRight",options:{},container:{object:'<ul id="noty_centerRight_layout_container" />',selector:"ul#noty_centerRight_layout_container",style:function(){a(this).css({right:20,position:"fixed",width:"310px",height:"auto",margin:0,padding:0,listStyleType:"none",zIndex:1e7});var b=a(this).clone().css({visibility:"hidden",display:"block",position:"absolute",top:0,left:0}).attr("id","dupe");a("body").append(b),b.find(".i-am-closing-now").remove(),b.find("li").css("display","block");var c=b.height();b.remove(),a(this).hasClass("i-am-new")?a(this).css({top:(a(window).height()-c)/2+"px"}):a(this).animate({top:(a(window).height()-c)/2+"px"},500),window.innerWidth<600&&a(this).css({right:5})}},parent:{object:"<li />",selector:"li",css:{}},css:{display:"none",width:"310px"},addClass:""}}(jQuery),function(a){a.noty.layouts.inline={name:"inline",options:{},container:{object:'<ul class="noty_inline_layout_container" />',selector:"ul.noty_inline_layout_container",style:function(){a(this).css({width:"100%",height:"auto",margin:0,padding:0,listStyleType:"none",zIndex:9999999})}},parent:{object:"<li />",selector:"li",css:{}},css:{display:"none"},addClass:""}}(jQuery),function(a){a.noty.layouts.top={name:"top",options:{},container:{object:'<ul id="noty_top_layout_container" />',selector:"ul#noty_top_layout_container",style:function(){a(this).css({top:0,left:"5%",position:"fixed",width:"90%",height:"auto",margin:0,padding:0,listStyleType:"none",zIndex:9999999})}},parent:{object:"<li />",selector:"li",css:{}},css:{display:"none"},addClass:""}}(jQuery),function(a){a.noty.layouts.topCenter={name:"topCenter",options:{},container:{object:'<ul id="noty_topCenter_layout_container" />',selector:"ul#noty_topCenter_layout_container",style:function(){a(this).css({top:20,left:0,position:"fixed",width:"310px",height:"auto",margin:0,padding:0,listStyleType:"none",zIndex:1e7}),a(this).css({left:(a(window).width()-a(this).outerWidth(!1))/2+"px"})}},parent:{object:"<li />",selector:"li",css:{}},css:{display:"none",width:"310px"},addClass:""}}(jQuery),function(a){a.noty.layouts.topLeft={name:"topLeft",options:{},container:{object:'<ul id="noty_topLeft_layout_container" />',selector:"ul#noty_topLeft_layout_container",style:function(){a(this).css({top:20,left:20,position:"fixed",width:"310px",height:"auto",margin:0,padding:0,listStyleType:"none",zIndex:1e7}),window.innerWidth<600&&a(this).css({left:5})}},parent:{object:"<li />",selector:"li",css:{}},css:{display:"none",width:"310px"},addClass:""}}(jQuery),function(a){a.noty.layouts.topRight={name:"topRight",options:{},container:{object:'<ul id="noty_topRight_layout_container" />',selector:"ul#noty_topRight_layout_container",style:function(){a(this).css({top:20,right:20,position:"fixed",width:"310px",height:"auto",margin:0,padding:0,listStyleType:"none",zIndex:1e7}),window.innerWidth<600&&a(this).css({right:5})}},parent:{object:"<li />",selector:"li",css:{}},css:{display:"none",width:"310px"},addClass:""}}(jQuery),function(a){a.noty.themes.defaultTheme={name:"defaultTheme",helpers:{borderFix:function(){if(this.options.dismissQueue){var b=this.options.layout.container.selector+" "+this.options.layout.parent.selector;switch(this.options.layout.name){case"top":a(b).css({borderRadius:"0px 0px 0px 0px"}),a(b).last().css({borderRadius:"0px 0px 5px 5px"});break;case"topCenter":case"topLeft":case"topRight":case"bottomCenter":case"bottomLeft":case"bottomRight":case"center":case"centerLeft":case"centerRight":case"inline":a(b).css({borderRadius:"0px 0px 0px 0px"}),a(b).first().css({"border-top-left-radius":"5px","border-top-right-radius":"5px"}),a(b).last().css({"border-bottom-left-radius":"5px","border-bottom-right-radius":"5px"});break;case"bottom":a(b).css({borderRadius:"0px 0px 0px 0px"}),a(b).first().css({borderRadius:"5px 5px 0px 0px"})}}}},modal:{css:{position:"fixed",width:"100%",height:"100%",backgroundColor:"#000",zIndex:1e4,opacity:.6,display:"none",left:0,top:0}},style:function(){switch(this.$bar.css({overflow:"hidden",background:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABsAAAAoCAYAAAAPOoFWAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAPZJREFUeNq81tsOgjAMANB2ov7/7ypaN7IlIwi9rGuT8QSc9EIDAsAznxvY4pXPKr05RUE5MEVB+TyWfCEl9LZApYopCmo9C4FKSMtYoI8Bwv79aQJU4l6hXXCZrQbokJEksxHo9KMOgc6w1atHXM8K9DVC7FQnJ0i8iK3QooGgbnyKgMDygBWyYFZoqx4qS27KqLZJjA1D0jK6QJcYEQEiWv9PGkTsbqxQ8oT+ZtZB6AkdsJnQDnMoHXHLGKOgDYuCWmYhEERCI5gaamW0bnHdA3k2ltlIN+2qKRyCND0bhqSYCyTB3CAOc4WusBEIpkeBuPgJMAAX8Hs1NfqHRgAAAABJRU5ErkJggg==') repeat-x scroll left top #fff"}),this.$message.css({fontSize:"13px",lineHeight:"16px",textAlign:"center",padding:"8px 10px 9px",width:"auto",position:"relative"}),this.$closeButton.css({position:"absolute",top:4,right:4,width:10,height:10,background:"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAATpJREFUeNoszrFqVFEUheG19zlz7sQ7ijMQBAvfYBqbpJCoZSAQbOwEE1IHGytbLQUJ8SUktW8gCCFJMSGSNxCmFBJO7j5rpXD6n5/P5vM53H3b3T9LOiB5AQDuDjM7BnA7DMPHDGBH0nuSzwHsRcRVRNRSysuU0i6AOwA/02w2+9Fae00SEbEh6SGAR5K+k3zWWptKepCm0+kpyRoRGyRBcpPkDsn1iEBr7drdP2VJZyQXERGSPpiZAViTBACXKaV9kqd5uVzCzO5KKb/d/UZSDwD/eyxqree1VqSu6zKAF2Z2RPJJaw0rAkjOJT0m+SuT/AbgDcmnkmBmfwAsJL1dXQ8lWY6IGwB1ZbrOOb8zs8thGP4COFwx/mE8Ho9Go9ErMzvJOW/1fY/JZIJSypqZfXX3L13X9fcDAKJct1sx3OiuAAAAAElFTkSuQmCC)",display:"none",cursor:"pointer"}),this.$buttons.css({padding:5,textAlign:"right",borderTop:"1px solid #ccc",backgroundColor:"#fff"}),this.$buttons.find("button").css({marginLeft:5}),this.$buttons.find("button:first").css({marginLeft:0}),this.$bar.on({mouseenter:function(){a(this).find(".noty_close").stop().fadeTo("normal",1)},mouseleave:function(){a(this).find(".noty_close").stop().fadeTo("normal",0)}}),this.options.layout.name){case"top":this.$bar.css({borderRadius:"0px 0px 5px 5px",borderBottom:"2px solid #eee",borderLeft:"2px solid #eee",borderRight:"2px solid #eee",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)"});break;case"topCenter":case"center":case"bottomCenter":case"inline":this.$bar.css({borderRadius:"5px",border:"1px solid #eee",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)"}),this.$message.css({fontSize:"13px",textAlign:"center"});break;case"topLeft":case"topRight":case"bottomLeft":case"bottomRight":case"centerLeft":case"centerRight":this.$bar.css({borderRadius:"5px",border:"1px solid #eee",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)"}),this.$message.css({fontSize:"13px",textAlign:"left"});break;case"bottom":this.$bar.css({borderRadius:"5px 5px 0px 0px",borderTop:"2px solid #eee",borderLeft:"2px solid #eee",borderRight:"2px solid #eee",boxShadow:"0 -2px 4px rgba(0, 0, 0, 0.1)"});break;default:this.$bar.css({border:"2px solid #eee",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)"})}switch(this.options.type){case"alert":case"notification":this.$bar.css({backgroundColor:"#FFF",borderColor:"#CCC",color:"#444"});break;case"warning":this.$bar.css({backgroundColor:"#FFEAA8",borderColor:"#FFC237",color:"#826200"}),this.$buttons.css({borderTop:"1px solid #FFC237"});break;case"error":this.$bar.css({backgroundColor:"red",borderColor:"darkred",color:"#FFF"}),this.$message.css({fontWeight:"bold"}),this.$buttons.css({borderTop:"1px solid darkred"});break;case"information":this.$bar.css({backgroundColor:"#57B7E2",borderColor:"#0B90C4",color:"#FFF"}),this.$buttons.css({borderTop:"1px solid #0B90C4"});break;case"success":this.$bar.css({backgroundColor:"lightgreen",borderColor:"#50C24E",color:"darkgreen"}),this.$buttons.css({borderTop:"1px solid #50C24E"});break;default:this.$bar.css({backgroundColor:"#FFF",borderColor:"#CCC",color:"#444"})}},callback:{onShow:function(){a.noty.themes.defaultTheme.helpers.borderFix.apply(this)},onClose:function(){a.noty.themes.defaultTheme.helpers.borderFix.apply(this)}}}}(jQuery),function($){function initMouseDetection(disable){var eNS=".smartmenus_mouse";if(mouseDetectionEnabled||disable)mouseDetectionEnabled&&disable&&($(document).unbind(eNS),mouseDetectionEnabled=!1);else{var firstTime=!0,lastMove=null;$(document).bind(getEventsNS([["mousemove",function(e){var thisMove={x:e.pageX,y:e.pageY,timeStamp:(new Date).getTime()};if(lastMove){var deltaX=Math.abs(lastMove.x-thisMove.x),deltaY=Math.abs(lastMove.y-thisMove.y);if((deltaX>0||deltaY>0)&&2>=deltaX&&2>=deltaY&&thisMove.timeStamp-lastMove.timeStamp<=300&&(mouse=!0,firstTime)){var $a=$(e.target).closest("a");$a.is("a")&&$.each(menuTrees,function(){return $.contains(this.$root[0],$a[0])?(this.itemEnter({currentTarget:$a[0]}),!1):void 0}),firstTime=!1}}lastMove=thisMove}],[touchEvents()?"touchstart":"pointerover pointermove pointerout MSPointerOver MSPointerMove MSPointerOut",function(e){isTouchEvent(e.originalEvent)&&(mouse=!1)}]],eNS)),mouseDetectionEnabled=!0}}function isTouchEvent(e){return!/^(4|mouse)$/.test(e.pointerType)}function touchEvents(){return"ontouchstart"in window}function getEventsNS(defArr,eNS){eNS||(eNS="");var obj={};return $.each(defArr,function(index,value){obj[value[0].split(" ").join(eNS+" ")+eNS]=value[1]}),obj}var menuTrees=[],IE=!!window.createPopup,mouse=!1,mouseDetectionEnabled=!1;$.SmartMenus=function(elm,options){this.$root=$(elm),this.opts=options,this.rootId="",this.accessIdPrefix="",this.$subArrow=null,this.activatedItems=[],this.visibleSubMenus=[],this.showTimeout=0,this.hideTimeout=0,this.scrollTimeout=0,this.clickActivated=!1,this.focusActivated=!1,this.zIndexInc=0,this.idInc=0,this.$firstLink=null,this.$firstSub=null,this.disabled=!1,this.$disableOverlay=null,this.isTouchScrolling=!1,this.wasCollapsible=!1,this.init()},$.extend($.SmartMenus,{hideAll:function(){$.each(menuTrees,function(){this.menuHideAll()})},destroy:function(){for(;menuTrees.length;)menuTrees[0].destroy();initMouseDetection(!0)},prototype:{init:function(refresh){var self=this;if(!refresh){menuTrees.push(this),this.rootId=((new Date).getTime()+Math.random()+"").replace(/\D/g,""),this.accessIdPrefix="sm-"+this.rootId+"-",this.$root.hasClass("sm-rtl")&&(this.opts.rightToLeftSubMenus=!0);var eNS=".smartmenus";this.$root.data("smartmenus",this).attr("data-smartmenus-id",this.rootId).dataSM("level",1).bind(getEventsNS([["mouseover focusin",$.proxy(this.rootOver,this)],["mouseout focusout",$.proxy(this.rootOut,this)],["keydown",$.proxy(this.rootKeyDown,this)]],eNS)).delegate("a",getEventsNS([["mouseenter",$.proxy(this.itemEnter,this)],["mouseleave",$.proxy(this.itemLeave,this)],["mousedown",$.proxy(this.itemDown,this)],["focus",$.proxy(this.itemFocus,this)],["blur",$.proxy(this.itemBlur,this)],["click",$.proxy(this.itemClick,this)],["touchend",$.proxy(this.itemTouchEnd,this)]],eNS)),eNS+=this.rootId,this.opts.hideOnClick&&$(document).bind(getEventsNS([["touchstart",$.proxy(this.docTouchStart,this)],["touchmove",$.proxy(this.docTouchMove,this)],["touchend",$.proxy(this.docTouchEnd,this)],["click",$.proxy(this.docClick,this)]],eNS)),$(window).bind(getEventsNS([["resize orientationchange",$.proxy(this.winResize,this)]],eNS)),this.opts.subIndicators&&(this.$subArrow=$("<span/>").addClass("sub-arrow"),this.opts.subIndicatorsText&&this.$subArrow.html(this.opts.subIndicatorsText)),initMouseDetection()}if(this.$firstSub=this.$root.find("ul").each(function(){self.menuInit($(this))}).eq(0),this.$firstLink=this.$root.find("a").eq(0),this.opts.markCurrentItem){var reDefaultDoc=/(index|default)\.[^#\?\/]*/i,reHash=/#.*/,locHref=window.location.href.replace(reDefaultDoc,""),locHrefNoHash=locHref.replace(reHash,"");this.$root.find("a").each(function(){var href=this.href.replace(reDefaultDoc,""),$this=$(this);(href==locHref||href==locHrefNoHash)&&($this.addClass("current"),self.opts.markCurrentTree&&$this.parentsUntil("[data-smartmenus-id]","ul").each(function(){$(this).dataSM("parent-a").addClass("current")}))})}this.wasCollapsible=this.isCollapsible()},destroy:function(refresh){if(!refresh){var eNS=".smartmenus";this.$root.removeData("smartmenus").removeAttr("data-smartmenus-id").removeDataSM("level").unbind(eNS).undelegate(eNS),eNS+=this.rootId,$(document).unbind(eNS),$(window).unbind(eNS),this.opts.subIndicators&&(this.$subArrow=null)}this.menuHideAll();var self=this;this.$root.find("ul").each(function(){var $this=$(this);$this.dataSM("scroll-arrows")&&$this.dataSM("scroll-arrows").remove(),$this.dataSM("shown-before")&&((self.opts.subMenusMinWidth||self.opts.subMenusMaxWidth)&&$this.css({width:"",minWidth:"",maxWidth:""}).removeClass("sm-nowrap"),$this.dataSM("scroll-arrows")&&$this.dataSM("scroll-arrows").remove(),$this.css({zIndex:"",top:"",left:"",marginLeft:"",marginTop:"",display:""})),0==$this.attr("id").indexOf(self.accessIdPrefix)&&$this.removeAttr("id")}).removeDataSM("in-mega").removeDataSM("shown-before").removeDataSM("ie-shim").removeDataSM("scroll-arrows").removeDataSM("parent-a").removeDataSM("level").removeDataSM("beforefirstshowfired").removeAttr("role").removeAttr("aria-hidden").removeAttr("aria-labelledby").removeAttr("aria-expanded"),this.$root.find("a.has-submenu").each(function(){var $this=$(this);0==$this.attr("id").indexOf(self.accessIdPrefix)&&$this.removeAttr("id")}).removeClass("has-submenu").removeDataSM("sub").removeAttr("aria-haspopup").removeAttr("aria-controls").removeAttr("aria-expanded").closest("li").removeDataSM("sub"),this.opts.subIndicators&&this.$root.find("span.sub-arrow").remove(),this.opts.markCurrentItem&&this.$root.find("a.current").removeClass("current"),refresh||(this.$root=null,this.$firstLink=null,this.$firstSub=null,this.$disableOverlay&&(this.$disableOverlay.remove(),this.$disableOverlay=null),menuTrees.splice($.inArray(this,menuTrees),1))},disable:function(noOverlay){if(!this.disabled){if(this.menuHideAll(),!noOverlay&&!this.opts.isPopup&&this.$root.is(":visible")){var pos=this.$root.offset();this.$disableOverlay=$('<div class="sm-jquery-disable-overlay"/>').css({position:"absolute",top:pos.top,left:pos.left,width:this.$root.outerWidth(),height:this.$root.outerHeight(),zIndex:this.getStartZIndex(!0),opacity:0}).appendTo(document.body)}this.disabled=!0}},docClick:function(e){return this.isTouchScrolling?void(this.isTouchScrolling=!1):void((this.visibleSubMenus.length&&!$.contains(this.$root[0],e.target)||$(e.target).is("a"))&&this.menuHideAll())},docTouchEnd:function(){if(this.lastTouch){if(!(!this.visibleSubMenus.length||void 0!==this.lastTouch.x2&&this.lastTouch.x1!=this.lastTouch.x2||void 0!==this.lastTouch.y2&&this.lastTouch.y1!=this.lastTouch.y2||this.lastTouch.target&&$.contains(this.$root[0],this.lastTouch.target))){this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=0);var self=this;this.hideTimeout=setTimeout(function(){self.menuHideAll()},350)}this.lastTouch=null}},docTouchMove:function(e){if(this.lastTouch){var touchPoint=e.originalEvent.touches[0];this.lastTouch.x2=touchPoint.pageX,this.lastTouch.y2=touchPoint.pageY}},docTouchStart:function(e){var touchPoint=e.originalEvent.touches[0];this.lastTouch={x1:touchPoint.pageX,y1:touchPoint.pageY,target:touchPoint.target}},enable:function(){this.disabled&&(this.$disableOverlay&&(this.$disableOverlay.remove(),this.$disableOverlay=null),this.disabled=!1)},getClosestMenu:function(elm){for(var $closestMenu=$(elm).closest("ul");$closestMenu.dataSM("in-mega");)$closestMenu=$closestMenu.parent().closest("ul");return $closestMenu[0]||null},getHeight:function($elm){return this.getOffset($elm,!0)},getOffset:function($elm,height){var old;"none"==$elm.css("display")&&(old={position:$elm[0].style.position,visibility:$elm[0].style.visibility},$elm.css({position:"absolute",visibility:"hidden"}).show());var box=$elm[0].getBoundingClientRect&&$elm[0].getBoundingClientRect(),val=box&&(height?box.height||box.bottom-box.top:box.width||box.right-box.left);return val||0===val||(val=height?$elm[0].offsetHeight:$elm[0].offsetWidth),old&&$elm.hide().css(old),val},getStartZIndex:function(root){var zIndex=parseInt(this[root?"$root":"$firstSub"].css("z-index"));return!root&&isNaN(zIndex)&&(zIndex=parseInt(this.$root.css("z-index"))),isNaN(zIndex)?1:zIndex},getTouchPoint:function(e){return e.touches&&e.touches[0]||e.changedTouches&&e.changedTouches[0]||e},getViewport:function(height){var name=height?"Height":"Width",val=document.documentElement["client"+name],val2=window["inner"+name];return val2&&(val=Math.min(val,val2)),val},getViewportHeight:function(){return this.getViewport(!0)},getViewportWidth:function(){return this.getViewport()},getWidth:function($elm){return this.getOffset($elm)},handleEvents:function(){return!this.disabled&&this.isCSSOn()},handleItemEvents:function($a){return this.handleEvents()&&!this.isLinkInMegaMenu($a)},isCollapsible:function(){return"static"==this.$firstSub.css("position")},isCSSOn:function(){return"block"==this.$firstLink.css("display")},isFixed:function(){var isFixed="fixed"==this.$root.css("position");return isFixed||this.$root.parentsUntil("body").each(function(){return"fixed"==$(this).css("position")?(isFixed=!0,!1):void 0}),isFixed},isLinkInMegaMenu:function($a){return $(this.getClosestMenu($a[0])).hasClass("mega-menu")},isTouchMode:function(){return!mouse||this.isCollapsible()},itemActivate:function($a,focus){var $ul=$a.closest("ul"),level=$ul.dataSM("level");if(level>1&&(!this.activatedItems[level-2]||this.activatedItems[level-2][0]!=$ul.dataSM("parent-a")[0])){var self=this;$($ul.parentsUntil("[data-smartmenus-id]","ul").get().reverse()).add($ul).each(function(){self.itemActivate($(this).dataSM("parent-a"))})}if((!this.isCollapsible()||focus)&&this.menuHideSubMenus(this.activatedItems[level-1]&&this.activatedItems[level-1][0]==$a[0]?level:level-1),this.activatedItems[level-1]=$a,this.$root.triggerHandler("activate.smapi",$a[0])!==!1){var $sub=$a.dataSM("sub");$sub&&(this.isTouchMode()||!this.opts.showOnClick||this.clickActivated)&&this.menuShow($sub)}},itemBlur:function(e){var $a=$(e.currentTarget);this.handleItemEvents($a)&&this.$root.triggerHandler("blur.smapi",$a[0])},itemClick:function(e){if(this.isTouchScrolling)return this.isTouchScrolling=!1,e.stopPropagation(),!1;var $a=$(e.currentTarget);if(this.handleItemEvents($a)){if(this.$root.triggerHandler("click.smapi",$a[0])===!1)return!1;$a.dataSM("href")&&$a.attr("href",$a.dataSM("href")).removeDataSM("href");var subArrowClicked=$(e.target).is("span.sub-arrow"),$sub=$a.dataSM("sub");if($sub&&!$sub.is(":visible")){if(this.itemActivate($a),$sub.is(":visible"))return this.focusActivated=!0,!1}else if(this.isCollapsible()&&subArrowClicked)return this.itemActivate($a),this.menuHide($sub),!1;return this.opts.showOnClick&&$sub&&2==$sub.dataSM("level")?(this.clickActivated=!0,this.menuShow($sub),!1):$a.hasClass("disabled")?!1:this.$root.triggerHandler("select.smapi",$a[0])===!1?!1:void 0}},itemDown:function(e){var $a=$(e.currentTarget);this.handleItemEvents($a)&&$a.dataSM("mousedown",!0)},itemEnter:function(e){var $a=$(e.currentTarget);if(this.handleItemEvents($a)){if(!this.isTouchMode()){this.showTimeout&&(clearTimeout(this.showTimeout),this.showTimeout=0);var self=this;this.showTimeout=setTimeout(function(){self.itemActivate($a)},this.opts.showOnClick&&1==$a.closest("ul").dataSM("level")?1:this.opts.showTimeout)}this.$root.triggerHandler("mouseenter.smapi",$a[0])}},itemFocus:function(e){var $a=$(e.currentTarget);this.handleItemEvents($a)&&(!this.focusActivated||this.isTouchMode()&&$a.dataSM("mousedown")||this.activatedItems.length&&this.activatedItems[this.activatedItems.length-1][0]==$a[0]||this.itemActivate($a,!0),this.$root.triggerHandler("focus.smapi",$a[0]))},itemLeave:function(e){var $a=$(e.currentTarget);this.handleItemEvents($a)&&(this.isTouchMode()||this.showTimeout&&(clearTimeout(this.showTimeout),this.showTimeout=0),$a.removeDataSM("mousedown"),this.$root.triggerHandler("mouseleave.smapi",$a[0]))},itemTouchEnd:function(e){var $a=$(e.currentTarget);if(this.handleItemEvents($a)){var $sub=$a.dataSM("sub");"#"!==$a.attr("href").charAt(0)&&$sub&&!$sub.is(":visible")&&$a.dataSM("href",$a.attr("href")).attr("href","#")}},menuHide:function($sub){if(this.$root.triggerHandler("beforehide.smapi",$sub[0])!==!1&&($sub.stop(!0,!0),"none"!=$sub.css("display"))){var complete=function(){$sub.css("z-index","")};this.isCollapsible()?this.opts.collapsibleHideFunction?this.opts.collapsibleHideFunction.call(this,$sub,complete):$sub.hide(this.opts.collapsibleHideDuration,complete):this.opts.hideFunction?this.opts.hideFunction.call(this,$sub,complete):$sub.hide(this.opts.hideDuration,complete),$sub.dataSM("ie-shim")&&$sub.dataSM("ie-shim").remove(),$sub.dataSM("scroll")&&(this.menuScrollStop($sub),$sub.css({"touch-action":"","-ms-touch-action":""}).unbind(".smartmenus_scroll").removeDataSM("scroll").dataSM("scroll-arrows").hide()),$sub.dataSM("parent-a").removeClass("highlighted").attr("aria-expanded","false"),$sub.attr({"aria-expanded":"false","aria-hidden":"true"});var level=$sub.dataSM("level");this.activatedItems.splice(level-1,1),this.visibleSubMenus.splice($.inArray($sub,this.visibleSubMenus),1),this.$root.triggerHandler("hide.smapi",$sub[0])}},menuHideAll:function(){this.showTimeout&&(clearTimeout(this.showTimeout),this.showTimeout=0);for(var level=this.opts.isPopup?1:0,i=this.visibleSubMenus.length-1;i>=level;i--)this.menuHide(this.visibleSubMenus[i]);this.opts.isPopup&&(this.$root.stop(!0,!0),this.$root.is(":visible")&&(this.opts.hideFunction?this.opts.hideFunction.call(this,this.$root):this.$root.hide(this.opts.hideDuration),this.$root.dataSM("ie-shim")&&this.$root.dataSM("ie-shim").remove())),this.activatedItems=[],this.visibleSubMenus=[],this.clickActivated=!1,this.focusActivated=!1,this.zIndexInc=0},menuHideSubMenus:function(level){for(var i=this.activatedItems.length-1;i>=level;i--){var $sub=this.activatedItems[i].dataSM("sub");$sub&&this.menuHide($sub)}},menuIframeShim:function($ul){IE&&this.opts.overlapControlsInIE&&!$ul.dataSM("ie-shim")&&$ul.dataSM("ie-shim",$("<iframe/>").attr({src:"javascript:0",tabindex:-9}).css({position:"absolute",top:"auto",left:"0",opacity:0,border:"0"}))},menuInit:function($ul){if(!$ul.dataSM("in-mega")){$ul.hasClass("mega-menu")&&$ul.find("ul").dataSM("in-mega",!0);for(var level=2,par=$ul[0];(par=par.parentNode.parentNode)!=this.$root[0];)level++;var $a=$ul.prevAll("a").eq(-1);$a.length||($a=$ul.prevAll().find("a").eq(-1)),$a.addClass("has-submenu").dataSM("sub",$ul),$ul.dataSM("parent-a",$a).dataSM("level",level).parent().dataSM("sub",$ul);var aId=$a.attr("id")||this.accessIdPrefix+ ++this.idInc,ulId=$ul.attr("id")||this.accessIdPrefix+ ++this.idInc;$a.attr({id:aId,"aria-haspopup":"true","aria-controls":ulId,"aria-expanded":"false"}),$ul.attr({id:ulId,role:"group","aria-hidden":"true","aria-labelledby":aId,"aria-expanded":"false"}),this.opts.subIndicators&&$a[this.opts.subIndicatorsPos](this.$subArrow.clone())
}},menuPosition:function($sub){var x,y,$a=$sub.dataSM("parent-a"),$li=$a.closest("li"),$ul=$li.parent(),level=$sub.dataSM("level"),subW=this.getWidth($sub),subH=this.getHeight($sub),itemOffset=$a.offset(),itemX=itemOffset.left,itemY=itemOffset.top,itemW=this.getWidth($a),itemH=this.getHeight($a),$win=$(window),winX=$win.scrollLeft(),winY=$win.scrollTop(),winW=this.getViewportWidth(),winH=this.getViewportHeight(),horizontalParent=$ul.hasClass("sm")&&!$ul.hasClass("sm-vertical"),rightToLeft=this.opts.rightToLeftSubMenus&&!$li.is("[data-sm-reverse]")||!this.opts.rightToLeftSubMenus&&$li.is("[data-sm-reverse]"),subOffsetX=2==level?this.opts.mainMenuSubOffsetX:this.opts.subMenusSubOffsetX,subOffsetY=2==level?this.opts.mainMenuSubOffsetY:this.opts.subMenusSubOffsetY;if(horizontalParent?(x=rightToLeft?itemW-subW-subOffsetX:subOffsetX,y=this.opts.bottomToTopSubMenus?-subH-subOffsetY:itemH+subOffsetY):(x=rightToLeft?subOffsetX-subW:itemW-subOffsetX,y=this.opts.bottomToTopSubMenus?itemH-subOffsetY-subH:subOffsetY),this.opts.keepInViewport){var absX=itemX+x,absY=itemY+y;if(rightToLeft&&winX>absX?x=horizontalParent?winX-absX+x:itemW-subOffsetX:!rightToLeft&&absX+subW>winX+winW&&(x=horizontalParent?winX+winW-subW-absX+x:subOffsetX-subW),horizontalParent||(winH>subH&&absY+subH>winY+winH?y+=winY+winH-subH-absY:(subH>=winH||winY>absY)&&(y+=winY-absY)),horizontalParent&&(absY+subH>winY+winH+.49||winY>absY)||!horizontalParent&&subH>winH+.49){var self=this;$sub.dataSM("scroll-arrows")||$sub.dataSM("scroll-arrows",$([$('<span class="scroll-up"><span class="scroll-up-arrow"></span></span>')[0],$('<span class="scroll-down"><span class="scroll-down-arrow"></span></span>')[0]]).bind({mouseenter:function(){$sub.dataSM("scroll").up=$(this).hasClass("scroll-up"),self.menuScroll($sub)},mouseleave:function(e){self.menuScrollStop($sub),self.menuScrollOut($sub,e)},"mousewheel DOMMouseScroll":function(e){e.preventDefault()}}).insertAfter($sub));var eNS=".smartmenus_scroll";$sub.dataSM("scroll",{step:1,itemH:itemH,subH:subH,arrowDownH:this.getHeight($sub.dataSM("scroll-arrows").eq(1))}).bind(getEventsNS([["mouseover",function(e){self.menuScrollOver($sub,e)}],["mouseout",function(e){self.menuScrollOut($sub,e)}],["mousewheel DOMMouseScroll",function(e){self.menuScrollMousewheel($sub,e)}]],eNS)).dataSM("scroll-arrows").css({top:"auto",left:"0",marginLeft:x+(parseInt($sub.css("border-left-width"))||0),width:subW-(parseInt($sub.css("border-left-width"))||0)-(parseInt($sub.css("border-right-width"))||0),zIndex:$sub.css("z-index")}).eq(horizontalParent&&this.opts.bottomToTopSubMenus?0:1).show(),this.isFixed()&&$sub.css({"touch-action":"none","-ms-touch-action":"none"}).bind(getEventsNS([[touchEvents()?"touchstart touchmove touchend":"pointerdown pointermove pointerup MSPointerDown MSPointerMove MSPointerUp",function(e){self.menuScrollTouch($sub,e)}]],eNS))}}$sub.css({top:"auto",left:"0",marginLeft:x,marginTop:y-itemH}),this.menuIframeShim($sub),$sub.dataSM("ie-shim")&&$sub.dataSM("ie-shim").css({zIndex:$sub.css("z-index"),width:subW,height:subH,marginLeft:x,marginTop:y-itemH})},menuScroll:function($sub,once,step){var diff,data=$sub.dataSM("scroll"),$arrows=$sub.dataSM("scroll-arrows"),y=parseFloat($sub.css("margin-top")),end=data.up?data.upEnd:data.downEnd;if(!once&&data.velocity){if(data.velocity*=.9,diff=data.velocity,.5>diff)return void this.menuScrollStop($sub)}else diff=step||(once||!this.opts.scrollAccelerate?this.opts.scrollStep:Math.floor(data.step));var level=$sub.dataSM("level");this.activatedItems[level-1]&&this.activatedItems[level-1].dataSM("sub")&&this.activatedItems[level-1].dataSM("sub").is(":visible")&&this.menuHideSubMenus(level-1);var newY=data.up&&y>=end||!data.up&&end>=y?y:Math.abs(end-y)>diff?y+(data.up?diff:-diff):end;if($sub.add($sub.dataSM("ie-shim")).css("margin-top",newY),mouse&&(data.up&&newY>data.downEnd||!data.up&&newY<data.upEnd)&&$arrows.eq(data.up?1:0).show(),newY==end)mouse&&$arrows.eq(data.up?0:1).hide(),this.menuScrollStop($sub);else if(!once){this.opts.scrollAccelerate&&data.step<this.opts.scrollStep&&(data.step+=.5);var self=this;this.scrollTimeout=setTimeout(function(){self.menuScroll($sub)},this.opts.scrollInterval)}},menuScrollMousewheel:function($sub,e){if(this.getClosestMenu(e.target)==$sub[0]){e=e.originalEvent;var up=(e.wheelDelta||-e.detail)>0;$sub.dataSM("scroll-arrows").eq(up?0:1).is(":visible")&&($sub.dataSM("scroll").up=up,this.menuScroll($sub,!0))}e.preventDefault()},menuScrollOut:function($sub,e){mouse&&(/^scroll-(up|down)/.test((e.relatedTarget||"").className)||($sub[0]==e.relatedTarget||$.contains($sub[0],e.relatedTarget))&&this.getClosestMenu(e.relatedTarget)==$sub[0]||$sub.dataSM("scroll-arrows").css("visibility","hidden"))},menuScrollOver:function($sub,e){if(mouse&&!/^scroll-(up|down)/.test(e.target.className)&&this.getClosestMenu(e.target)==$sub[0]){this.menuScrollRefreshData($sub);var data=$sub.dataSM("scroll");$sub.dataSM("scroll-arrows").eq(0).css("margin-top",data.upEnd).end().eq(1).css("margin-top",data.downEnd+data.subH-data.arrowDownH).end().css("visibility","visible")}},menuScrollRefreshData:function($sub){var data=$sub.dataSM("scroll"),$win=$(window),vportY=$win.scrollTop()-$sub.dataSM("parent-a").offset().top-data.itemH;$.extend(data,{upEnd:vportY,downEnd:vportY+this.getViewportHeight()-data.subH})},menuScrollStop:function($sub){return this.scrollTimeout?(clearTimeout(this.scrollTimeout),this.scrollTimeout=0,$.extend($sub.dataSM("scroll"),{step:1,velocity:0}),!0):void 0},menuScrollTouch:function($sub,e){if(e=e.originalEvent,isTouchEvent(e)){var touchPoint=this.getTouchPoint(e);if(this.getClosestMenu(touchPoint.target)==$sub[0]){var data=$sub.dataSM("scroll");if(/(start|down)$/i.test(e.type))this.menuScrollStop($sub)?(e.preventDefault(),this.isTouchScrolling=!0):this.isTouchScrolling=!1,this.menuScrollRefreshData($sub),$.extend(data,{touchY:touchPoint.pageY,touchTimestamp:e.timeStamp,velocity:0});else if(/move$/i.test(e.type)){var prevY=data.touchY;void 0!==prevY&&prevY!=touchPoint.pageY&&(this.isTouchScrolling=!0,$.extend(data,{up:prevY<touchPoint.pageY,touchY:touchPoint.pageY,touchTimestamp:e.timeStamp,velocity:data.velocity+.5*Math.abs(touchPoint.pageY-prevY)}),this.menuScroll($sub,!0,Math.abs(data.touchY-prevY))),e.preventDefault()}else void 0!==data.touchY&&(e.timeStamp-data.touchTimestamp<120&&data.velocity>0&&(data.velocity*=.5,this.menuScrollStop($sub),this.menuScroll($sub),e.preventDefault()),delete data.touchY)}}},menuShow:function($sub){if(($sub.dataSM("beforefirstshowfired")||($sub.dataSM("beforefirstshowfired",!0),this.$root.triggerHandler("beforefirstshow.smapi",$sub[0])!==!1))&&this.$root.triggerHandler("beforeshow.smapi",$sub[0])!==!1&&($sub.dataSM("shown-before",!0).stop(!0,!0),!$sub.is(":visible"))){var $a=$sub.dataSM("parent-a");if((this.opts.keepHighlighted||this.isCollapsible())&&$a.addClass("highlighted"),this.isCollapsible())$sub.removeClass("sm-nowrap").css({zIndex:"",width:"auto",minWidth:"",maxWidth:"",top:"",left:"",marginLeft:"",marginTop:""});else{if($sub.css("z-index",this.zIndexInc=(this.zIndexInc||this.getStartZIndex())+1),(this.opts.subMenusMinWidth||this.opts.subMenusMaxWidth)&&($sub.css({width:"auto",minWidth:"",maxWidth:""}).addClass("sm-nowrap"),this.opts.subMenusMinWidth&&$sub.css("min-width",this.opts.subMenusMinWidth),this.opts.subMenusMaxWidth)){var noMaxWidth=this.getWidth($sub);$sub.css("max-width",this.opts.subMenusMaxWidth),noMaxWidth>this.getWidth($sub)&&$sub.removeClass("sm-nowrap").css("width",this.opts.subMenusMaxWidth)}this.menuPosition($sub),$sub.dataSM("ie-shim")&&$sub.dataSM("ie-shim").insertBefore($sub)}var complete=function(){$sub.css("overflow","")};this.isCollapsible()?this.opts.collapsibleShowFunction?this.opts.collapsibleShowFunction.call(this,$sub,complete):$sub.show(this.opts.collapsibleShowDuration,complete):this.opts.showFunction?this.opts.showFunction.call(this,$sub,complete):$sub.show(this.opts.showDuration,complete),$a.attr("aria-expanded","true"),$sub.attr({"aria-expanded":"true","aria-hidden":"false"}),this.visibleSubMenus.push($sub),this.$root.triggerHandler("show.smapi",$sub[0])}},popupHide:function(noHideTimeout){this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=0);var self=this;this.hideTimeout=setTimeout(function(){self.menuHideAll()},noHideTimeout?1:this.opts.hideTimeout)},popupShow:function(left,top){if(!this.opts.isPopup)return void alert('SmartMenus jQuery Error:\n\nIf you want to show this menu via the "popupShow" method, set the isPopup:true option.');if(this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=0),this.$root.dataSM("shown-before",!0).stop(!0,!0),!this.$root.is(":visible")){this.$root.css({left:left,top:top}),this.menuIframeShim(this.$root),this.$root.dataSM("ie-shim")&&this.$root.dataSM("ie-shim").css({zIndex:this.$root.css("z-index"),width:this.getWidth(this.$root),height:this.getHeight(this.$root),left:left,top:top}).insertBefore(this.$root);var self=this,complete=function(){self.$root.css("overflow","")};this.opts.showFunction?this.opts.showFunction.call(this,this.$root,complete):this.$root.show(this.opts.showDuration,complete),this.visibleSubMenus[0]=this.$root}},refresh:function(){this.destroy(!0),this.init(!0)},rootKeyDown:function(e){if(this.handleEvents())switch(e.keyCode){case 27:var $activeTopItem=this.activatedItems[0];if($activeTopItem){this.menuHideAll(),$activeTopItem[0].focus();var $sub=$activeTopItem.dataSM("sub");$sub&&this.menuHide($sub)}break;case 32:var $target=$(e.target);if($target.is("a")&&this.handleItemEvents($target)){var $sub=$target.dataSM("sub");$sub&&!$sub.is(":visible")&&(this.itemClick({currentTarget:e.target}),e.preventDefault())}}},rootOut:function(e){if(this.handleEvents()&&!this.isTouchMode()&&e.target!=this.$root[0]&&(this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=0),!this.opts.showOnClick||!this.opts.hideOnClick)){var self=this;this.hideTimeout=setTimeout(function(){self.menuHideAll()},this.opts.hideTimeout)}},rootOver:function(e){this.handleEvents()&&!this.isTouchMode()&&e.target!=this.$root[0]&&this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=0)},winResize:function(e){if(this.handleEvents()){if(!("onorientationchange"in window)||"orientationchange"==e.type){var isCollapsible=this.isCollapsible();this.wasCollapsible&&isCollapsible||(this.activatedItems.length&&this.activatedItems[this.activatedItems.length-1][0].blur(),this.menuHideAll()),this.wasCollapsible=isCollapsible}}else if(this.$disableOverlay){var pos=this.$root.offset();this.$disableOverlay.css({top:pos.top,left:pos.left,width:this.$root.outerWidth(),height:this.$root.outerHeight()})}}}}),$.fn.dataSM=function(key,val){return val?this.data(key+"_smartmenus",val):this.data(key+"_smartmenus")},$.fn.removeDataSM=function(key){return this.removeData(key+"_smartmenus")},$.fn.smartmenus=function(options){if("string"==typeof options){var args=arguments,method=options;return Array.prototype.shift.call(args),this.each(function(){var smartmenus=$(this).data("smartmenus");smartmenus&&smartmenus[method]&&smartmenus[method].apply(smartmenus,args)})}var opts=$.extend({},$.fn.smartmenus.defaults,options);return this.each(function(){new $.SmartMenus(this,opts)})},$.fn.smartmenus.defaults={isPopup:!1,mainMenuSubOffsetX:0,mainMenuSubOffsetY:0,subMenusSubOffsetX:0,subMenusSubOffsetY:0,subMenusMinWidth:"10em",subMenusMaxWidth:"20em",subIndicators:!0,subIndicatorsPos:"prepend",subIndicatorsText:"+",scrollStep:30,scrollInterval:30,scrollAccelerate:!0,showTimeout:250,hideTimeout:500,showDuration:0,showFunction:null,hideDuration:0,hideFunction:function($ul,complete){$ul.fadeOut(200,complete)},collapsibleShowDuration:0,collapsibleShowFunction:function($ul,complete){$ul.slideDown(200,complete)},collapsibleHideDuration:0,collapsibleHideFunction:function($ul,complete){$ul.slideUp(200,complete)},showOnClick:!1,hideOnClick:!0,keepInViewport:!0,keepHighlighted:!0,markCurrentItem:!1,markCurrentTree:!0,rightToLeftSubMenus:!1,bottomToTopSubMenus:!1,overlapControlsInIE:!0}}(jQuery),function($){$(function(){var $navbars=$("ul.navbar-nav:not([data-sm-skip])");$navbars.each(function(){function winResize(){var newW=obj.getViewportWidth();newW!=winW&&(obj.isCollapsible()?($this.addClass("sm-collapsible"),$this.is("[data-sm-skip-collapsible-behavior]")||$carets.addClass("navbar-toggle sub-arrow")):($this.removeClass("sm-collapsible"),$this.is("[data-sm-skip-collapsible-behavior]")||$carets.removeClass("navbar-toggle sub-arrow")),winW=newW)}var $this=$(this);$this.addClass("sm").smartmenus({subMenusSubOffsetX:2,subMenusSubOffsetY:-6,subIndicators:!1,collapsibleShowFunction:null,collapsibleHideFunction:null,rightToLeftSubMenus:$this.hasClass("navbar-right"),bottomToTopSubMenus:$this.closest(".navbar").hasClass("navbar-fixed-bottom")}).bind({"show.smapi":function(e,menu){var $menu=$(menu),$scrollArrows=$menu.dataSM("scroll-arrows");$scrollArrows&&$scrollArrows.css("background-color",$(document.body).css("background-color")),$menu.parent().addClass("open")},"hide.smapi":function(e,menu){$(menu).parent().removeClass("open")}}).find("a.current").parent().addClass("active");var obj=$this.data("smartmenus");$this.is("[data-sm-skip-collapsible-behavior]")&&$this.bind({"click.smapi":function(e,item){var obj=$(this).data("smartmenus"),$item=$(item),$sub=$item.parent().dataSM("sub");return $sub&&$sub.dataSM("shown-before")&&$sub.is(":visible")?(obj.itemActivate($item),obj.menuHide($sub),!1):void 0}});var winW,$carets=$this.find(".caret");winResize(),$(window).bind("resize.smartmenus"+obj.rootId,winResize)})}),$.SmartMenus.prototype.isCollapsible=function(){return"left"!=this.$firstLink.parent().css("float")},$.SmartMenus.prototype.isTouchMode=function(){return!0}}(jQuery),function(e,t,n){"use strict";var r=function(){t(".rrssb-buttons").each(function(){var n=t(this),r=t("li",n).length,i=100/r;t("li",n).css("width",i+"%").attr("data-initwidth",i)})},i=function(){t(".rrssb-buttons").each(function(){var n=t(this),r=parseFloat(t(n).width()),i=t("li",n).not(".small").first().width(),s=t("li.small",n).length;i>170&&1>s?t(n).addClass("large-format"):t(n).removeClass("large-format"),200>r?t(n).removeClass("small-format").addClass("tiny-format"):t(n).removeClass("tiny-format")})},s=function(){t(".rrssb-buttons").each(function(){var s,o,n=t(this),r=0,i=0,a=t("li.small",n).length;if(a===t("li",n).length){var f=42*a,l=parseFloat(t(n).width());s=t("li.small",n).first(),o=parseFloat(t(s).attr("data-size"))+55,l>f+o&&(t(n).removeClass("small-format"),t("li.small",n).first().removeClass("small"),u())}else{t("li",n).not(".small").each(function(){var n=parseFloat(t(this).attr("data-size"))+55,s=parseFloat(t(this).width());r+=s,i+=n});var c=r-i;s=t("li.small",n).first(),o=parseFloat(t(s).attr("data-size"))+55,c>o&&(t(s).removeClass("small"),u())}})},o=function(e){t(".rrssb-buttons").each(function(){{var n=t(this),r=t("li",n).nextAll();r.length}t(t("li",n).get().reverse()).each(function(e,r){if(t(this).hasClass("small")===!1){var i=parseFloat(t(this).attr("data-size"))+55,o=parseFloat(t(this).width());if(i>o){var a=t("li",n).not(".small").last();t(a).addClass("small"),u()}}--r||s()})}),e===!0&&f(u)},u=function(){t(".rrssb-buttons").each(function(){var i,s,o,u,a,n=t(this),f=t("li.small",n).length;f>0&&f!==t("li",n).length?(t(n).removeClass("small-format"),t("li.small",n).css("width","42px"),o=42*f,i=t("li",n).not(".small").length,s=100/i,a=o/i,u=navigator.userAgent.indexOf("Chrome")>=0||navigator.userAgent.indexOf("Safari")>=0?"-webkit-calc("+s+"% - "+a+"px)":navigator.userAgent.indexOf("Firefox")>=0?"-moz-calc("+s+"% - "+a+"px)":"calc("+s+"% - "+a+"px)",t("li",n).not(".small").css("width",u)):f===t("li",n).length?(t(n).addClass("small-format"),r()):(t(n).removeClass("small-format"),r())}),i()},a=function(){t(".rrssb-buttons").each(function(e){t(this).addClass("rrssb-"+(e+1))}),r(),t(".rrssb-buttons li .text").each(function(){var n=parseFloat(t(this).width());t(this).closest("li").attr("data-size",n)}),o(!0)},f=function(e){t(".rrssb-buttons li.small").removeClass("small"),o(),e()},l=function(t,r,i,s){var o=e.screenLeft!==n?e.screenLeft:screen.left,u=e.screenTop!==n?e.screenTop:screen.top,a=e.innerWidth?e.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,f=e.innerHeight?e.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,l=a/2-i/2+o,c=f/3-s/3+u,h=e.open(t,r,"scrollbars=yes, width="+i+", height="+s+", top="+c+", left="+l);e.focus&&h.focus()},c=function(){var e={};return function(t,n,r){r||(r="Don't call this twice without a uniqueId"),e[r]&&clearTimeout(e[r]),e[r]=setTimeout(t,n)}}();t(".rrssb-buttons a.popup").on("click",function(e){var n=t(this);l(n.attr("href"),n.find(".text").html(),580,470),e.preventDefault()}),t(e).resize(function(){f(u),c(function(){f(u)},200,"finished resizing")}),t(document).ready(function(){a()})}(window,jQuery),function(root,factory){"function"==typeof define&&define.amd?define(factory):"object"==typeof exports?module.exports=factory():root.NProgress=factory()}(this,function(){function clamp(n,min,max){return min>n?min:n>max?max:n}function toBarPerc(n){return 100*(-1+n)}function barPositionCSS(n,speed,ease){var barCSS;return barCSS="translate3d"===Settings.positionUsing?{transform:"translate3d("+toBarPerc(n)+"%,0,0)"}:"translate"===Settings.positionUsing?{transform:"translate("+toBarPerc(n)+"%,0)"}:{"margin-left":toBarPerc(n)+"%"},barCSS.transition="all "+speed+"ms "+ease,barCSS}function hasClass(element,name){var list="string"==typeof element?element:classList(element);return list.indexOf(" "+name+" ")>=0}function addClass(element,name){var oldList=classList(element),newList=oldList+name;hasClass(oldList,name)||(element.className=newList.substring(1))}function removeClass(element,name){var newList,oldList=classList(element);hasClass(element,name)&&(newList=oldList.replace(" "+name+" "," "),element.className=newList.substring(1,newList.length-1))}function classList(element){return(" "+(element.className||"")+" ").replace(/\s+/gi," ")}function removeElement(element){element&&element.parentNode&&element.parentNode.removeChild(element)}var NProgress={};NProgress.version="0.1.6";var Settings=NProgress.settings={minimum:.08,easing:"ease",positionUsing:"",speed:200,trickle:!0,trickleRate:.02,trickleSpeed:800,showSpinner:!0,barSelector:'[role="bar"]',spinnerSelector:'[role="spinner"]',parent:"body",template:'<div class="bar" role="bar"><div class="peg"></div></div><div class="spinner" role="spinner"><div class="spinner-icon"></div></div>'};NProgress.configure=function(options){var key,value;for(key in options)value=options[key],void 0!==value&&options.hasOwnProperty(key)&&(Settings[key]=value);return this},NProgress.status=null,NProgress.set=function(n){var started=NProgress.isStarted();n=clamp(n,Settings.minimum,1),NProgress.status=1===n?null:n;var progress=NProgress.render(!started),bar=progress.querySelector(Settings.barSelector),speed=Settings.speed,ease=Settings.easing;return progress.offsetWidth,queue(function(next){""===Settings.positionUsing&&(Settings.positionUsing=NProgress.getPositioningCSS()),css(bar,barPositionCSS(n,speed,ease)),1===n?(css(progress,{transition:"none",opacity:1}),progress.offsetWidth,setTimeout(function(){css(progress,{transition:"all "+speed+"ms linear",opacity:0}),setTimeout(function(){NProgress.remove(),next()},speed)},speed)):setTimeout(next,speed)}),this},NProgress.isStarted=function(){return"number"==typeof NProgress.status},NProgress.start=function(){NProgress.status||NProgress.set(0);var work=function(){setTimeout(function(){NProgress.status&&(NProgress.trickle(),work())},Settings.trickleSpeed)};return Settings.trickle&&work(),this},NProgress.done=function(force){return force||NProgress.status?NProgress.inc(.3+.5*Math.random()).set(1):this},NProgress.inc=function(amount){var n=NProgress.status;return n?("number"!=typeof amount&&(amount=(1-n)*clamp(Math.random()*n,.1,.95)),n=clamp(n+amount,0,.994),NProgress.set(n)):NProgress.start()},NProgress.trickle=function(){return NProgress.inc(Math.random()*Settings.trickleRate)},function(){var initial=0,current=0;NProgress.promise=function($promise){return $promise&&"resolved"!=$promise.state()?(0==current&&NProgress.start(),initial++,current++,$promise.always(function(){current--,0==current?(initial=0,NProgress.done()):NProgress.set((initial-current)/initial)}),this):this}}(),NProgress.render=function(fromStart){if(NProgress.isRendered())return document.getElementById("nprogress");addClass(document.documentElement,"nprogress-busy");var progress=document.createElement("div");progress.id="nprogress",progress.innerHTML=Settings.template;var spinner,bar=progress.querySelector(Settings.barSelector),perc=fromStart?"-100":toBarPerc(NProgress.status||0),parent=document.querySelector(Settings.parent);return css(bar,{transition:"all 0 linear",transform:"translate3d("+perc+"%,0,0)"}),Settings.showSpinner||(spinner=progress.querySelector(Settings.spinnerSelector),spinner&&removeElement(spinner)),parent!=document.body&&addClass(parent,"nprogress-custom-parent"),parent.appendChild(progress),progress},NProgress.remove=function(){removeClass(document.documentElement,"nprogress-busy"),removeClass(document.querySelector(Settings.parent),"nprogress-custom-parent");var progress=document.getElementById("nprogress");progress&&removeElement(progress)},NProgress.isRendered=function(){return!!document.getElementById("nprogress")},NProgress.getPositioningCSS=function(){var bodyStyle=document.body.style,vendorPrefix="WebkitTransform"in bodyStyle?"Webkit":"MozTransform"in bodyStyle?"Moz":"msTransform"in bodyStyle?"ms":"OTransform"in bodyStyle?"O":"";return vendorPrefix+"Perspective"in bodyStyle?"translate3d":vendorPrefix+"Transform"in bodyStyle?"translate":"margin"};var queue=function(){function next(){var fn=pending.shift();fn&&fn(next)}var pending=[];return function(fn){pending.push(fn),1==pending.length&&next()}}(),css=function(){function camelCase(string){return string.replace(/^-ms-/,"ms-").replace(/-([\da-z])/gi,function(match,letter){return letter.toUpperCase()})}function getVendorProp(name){var style=document.body.style;if(name in style)return name;for(var vendorName,i=cssPrefixes.length,capName=name.charAt(0).toUpperCase()+name.slice(1);i--;)if(vendorName=cssPrefixes[i]+capName,vendorName in style)return vendorName;return name}function getStyleProp(name){return name=camelCase(name),cssProps[name]||(cssProps[name]=getVendorProp(name))}function applyCss(element,prop,value){prop=getStyleProp(prop),element.style[prop]=value}var cssPrefixes=["Webkit","O","Moz","ms"],cssProps={};return function(element,properties){var prop,value,args=arguments;if(2==args.length)for(prop in properties)value=properties[prop],void 0!==value&&properties.hasOwnProperty(prop)&&applyCss(element,prop,value);else applyCss(element,args[1],args[2])}}();return NProgress}),function(){function build(){var svg={};return svg.FRAMERATE=30,svg.MAX_VIRTUAL_PIXELS=3e4,svg.init=function(ctx){svg.Definitions={},svg.Styles={},svg.Animations=[],svg.Images=[],svg.ctx=ctx,svg.ViewPort=new function(){this.viewPorts=[],this.Clear=function(){this.viewPorts=[]},this.SetCurrent=function(width,height){this.viewPorts.push({width:width,height:height})},this.RemoveCurrent=function(){this.viewPorts.pop()},this.Current=function(){return this.viewPorts[this.viewPorts.length-1]},this.width=function(){return this.Current().width},this.height=function(){return this.Current().height},this.ComputeSize=function(d){return null!=d&&"number"==typeof d?d:"x"==d?this.width():"y"==d?this.height():Math.sqrt(Math.pow(this.width(),2)+Math.pow(this.height(),2))/Math.sqrt(2)}}},svg.init(),svg.ImagesLoaded=function(){for(var i=0;i<svg.Images.length;i++)if(!svg.Images[i].loaded)return!1;return!0},svg.trim=function(s){return s.replace(/^\s+|\s+$/g,"")},svg.compressSpaces=function(s){return s.replace(/[\s\r\t\n]+/gm," ")},svg.ajax=function(url){var AJAX;return AJAX=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),AJAX?(AJAX.open("GET",url,!1),AJAX.send(null),AJAX.responseText):null},svg.parseXml=function(xml){if(window.DOMParser){var parser=new DOMParser;return parser.parseFromString(xml,"text/xml")}xml=xml.replace(/<!DOCTYPE svg[^>]*>/,"");var xmlDoc=new ActiveXObject("Microsoft.XMLDOM");return xmlDoc.async="false",xmlDoc.loadXML(xml),xmlDoc},svg.Property=function(name,value){this.name=name,this.value=value},svg.Property.prototype.getValue=function(){return this.value},svg.Property.prototype.hasValue=function(){return null!=this.value&&""!==this.value},svg.Property.prototype.numValue=function(){if(!this.hasValue())return 0;var n=parseFloat(this.value);return(this.value+"").match(/%$/)&&(n/=100),n},svg.Property.prototype.valueOrDefault=function(def){return this.hasValue()?this.value:def},svg.Property.prototype.numValueOrDefault=function(def){return this.hasValue()?this.numValue():def},svg.Property.prototype.addOpacity=function(opacity){var newValue=this.value;if(null!=opacity&&""!=opacity&&"string"==typeof this.value){var color=new RGBColor(this.value);color.ok&&(newValue="rgba("+color.r+", "+color.g+", "+color.b+", "+opacity+")")}return new svg.Property(this.name,newValue)},svg.Property.prototype.getDefinition=function(){var name=this.value.replace(/^(url\()?#([^\)]+)\)?$/,"$2");return svg.Definitions[name]},svg.Property.prototype.isUrlDefinition=function(){return 0==this.value.indexOf("url(")},svg.Property.prototype.getFillStyleDefinition=function(e){var def=this.getDefinition();return null!=def&&def.createGradient?def.createGradient(svg.ctx,e):null!=def&&def.createPattern?def.createPattern(svg.ctx,e):null},svg.Property.prototype.getDPI=function(){return 96},svg.Property.prototype.getEM=function(viewPort){var em=12,fontSize=new svg.Property("fontSize",svg.Font.Parse(svg.ctx.font).fontSize);return fontSize.hasValue()&&(em=fontSize.toPixels(viewPort)),em},svg.Property.prototype.getUnits=function(){var s=this.value+"";return s.replace(/[0-9\.\-]/g,"")},svg.Property.prototype.toPixels=function(viewPort){if(!this.hasValue())return 0;var s=this.value+"";return s.match(/em$/)?this.numValue()*this.getEM(viewPort):s.match(/ex$/)?this.numValue()*this.getEM(viewPort)/2:s.match(/px$/)?this.numValue():s.match(/pt$/)?this.numValue()*this.getDPI(viewPort)*(1/72):s.match(/pc$/)?15*this.numValue():s.match(/cm$/)?this.numValue()*this.getDPI(viewPort)/2.54:s.match(/mm$/)?this.numValue()*this.getDPI(viewPort)/25.4:s.match(/in$/)?this.numValue()*this.getDPI(viewPort):s.match(/%$/)?this.numValue()*svg.ViewPort.ComputeSize(viewPort):this.numValue()},svg.Property.prototype.toMilliseconds=function(){if(!this.hasValue())return 0;var s=this.value+"";return s.match(/s$/)?1e3*this.numValue():(s.match(/ms$/),this.numValue())},svg.Property.prototype.toRadians=function(){if(!this.hasValue())return 0;var s=this.value+"";return s.match(/deg$/)?this.numValue()*(Math.PI/180):s.match(/grad$/)?this.numValue()*(Math.PI/200):s.match(/rad$/)?this.numValue():this.numValue()*(Math.PI/180)},svg.Font=new function(){this.Styles="normal|italic|oblique|inherit",this.Variants="normal|small-caps|inherit",this.Weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit",this.CreateFont=function(fontStyle,fontVariant,fontWeight,fontSize,fontFamily,inherit){var f=null!=inherit?this.Parse(inherit):this.CreateFont("","","","","",svg.ctx.font);return{fontFamily:fontFamily||f.fontFamily,fontSize:fontSize||f.fontSize,fontStyle:fontStyle||f.fontStyle,fontWeight:fontWeight||f.fontWeight,fontVariant:fontVariant||f.fontVariant,toString:function(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize,this.fontFamily].join(" ")}}};var that=this;this.Parse=function(s){for(var f={},d=svg.trim(svg.compressSpaces(s||"")).split(" "),set={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1},ff="",i=0;i<d.length;i++)set.fontStyle||-1==that.Styles.indexOf(d[i])?set.fontVariant||-1==that.Variants.indexOf(d[i])?set.fontWeight||-1==that.Weights.indexOf(d[i])?set.fontSize?"inherit"!=d[i]&&(ff+=d[i]):("inherit"!=d[i]&&(f.fontSize=d[i].split("/")[0]),set.fontStyle=set.fontVariant=set.fontWeight=set.fontSize=!0):("inherit"!=d[i]&&(f.fontWeight=d[i]),set.fontStyle=set.fontVariant=set.fontWeight=!0):("inherit"!=d[i]&&(f.fontVariant=d[i]),set.fontStyle=set.fontVariant=!0):("inherit"!=d[i]&&(f.fontStyle=d[i]),set.fontStyle=!0);return""!=ff&&(f.fontFamily=ff),f}},svg.ToNumberArray=function(s){for(var a=svg.trim(svg.compressSpaces((s||"").replace(/,/g," "))).split(" "),i=0;i<a.length;i++)a[i]=parseFloat(a[i]);return a},svg.Point=function(x,y){this.x=x,this.y=y},svg.Point.prototype.angleTo=function(p){return Math.atan2(p.y-this.y,p.x-this.x)},svg.Point.prototype.applyTransform=function(v){var xp=this.x*v[0]+this.y*v[2]+v[4],yp=this.x*v[1]+this.y*v[3]+v[5];this.x=xp,this.y=yp},svg.CreatePoint=function(s){var a=svg.ToNumberArray(s);return new svg.Point(a[0],a[1])},svg.CreatePath=function(s){for(var a=svg.ToNumberArray(s),path=[],i=0;i<a.length;i+=2)path.push(new svg.Point(a[i],a[i+1]));return path},svg.BoundingBox=function(x1,y1,x2,y2){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN,this.x=function(){return this.x1},this.y=function(){return this.y1},this.width=function(){return this.x2-this.x1},this.height=function(){return this.y2-this.y1},this.addPoint=function(x,y){null!=x&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=x,this.x2=x),x<this.x1&&(this.x1=x),x>this.x2&&(this.x2=x)),null!=y&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=y,this.y2=y),y<this.y1&&(this.y1=y),y>this.y2&&(this.y2=y))},this.addX=function(x){this.addPoint(x,null)},this.addY=function(y){this.addPoint(null,y)},this.addBoundingBox=function(bb){this.addPoint(bb.x1,bb.y1),this.addPoint(bb.x2,bb.y2)},this.addQuadraticCurve=function(p0x,p0y,p1x,p1y,p2x,p2y){var cp1x=p0x+2/3*(p1x-p0x),cp1y=p0y+2/3*(p1y-p0y),cp2x=cp1x+1/3*(p2x-p0x),cp2y=cp1y+1/3*(p2y-p0y);this.addBezierCurve(p0x,p0y,cp1x,cp2x,cp1y,cp2y,p2x,p2y)},this.addBezierCurve=function(p0x,p0y,p1x,p1y,p2x,p2y,p3x,p3y){var p0=[p0x,p0y],p1=[p1x,p1y],p2=[p2x,p2y],p3=[p3x,p3y];for(this.addPoint(p0[0],p0[1]),this.addPoint(p3[0],p3[1]),i=0;1>=i;i++){var f=function(t){return Math.pow(1-t,3)*p0[i]+3*Math.pow(1-t,2)*t*p1[i]+3*(1-t)*Math.pow(t,2)*p2[i]+Math.pow(t,3)*p3[i]},b=6*p0[i]-12*p1[i]+6*p2[i],a=-3*p0[i]+9*p1[i]-9*p2[i]+3*p3[i],c=3*p1[i]-3*p0[i];if(0!=a){var b2ac=Math.pow(b,2)-4*c*a;if(!(0>b2ac)){var t1=(-b+Math.sqrt(b2ac))/(2*a);t1>0&&1>t1&&(0==i&&this.addX(f(t1)),1==i&&this.addY(f(t1)));var t2=(-b-Math.sqrt(b2ac))/(2*a);t2>0&&1>t2&&(0==i&&this.addX(f(t2)),1==i&&this.addY(f(t2)))}}else{if(0==b)continue;var t=-c/b;t>0&&1>t&&(0==i&&this.addX(f(t)),1==i&&this.addY(f(t)))}}},this.isPointInBox=function(x,y){return this.x1<=x&&x<=this.x2&&this.y1<=y&&y<=this.y2},this.addPoint(x1,y1),this.addPoint(x2,y2)},svg.Transform=function(v){var that=this;this.Type={},this.Type.translate=function(s){this.p=svg.CreatePoint(s),this.apply=function(ctx){ctx.translate(this.p.x||0,this.p.y||0)},this.applyToPoint=function(p){p.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0])}},this.Type.rotate=function(s){var a=svg.ToNumberArray(s);this.angle=new svg.Property("angle",a[0]),this.cx=a[1]||0,this.cy=a[2]||0,this.apply=function(ctx){ctx.translate(this.cx,this.cy),ctx.rotate(this.angle.toRadians()),ctx.translate(-this.cx,-this.cy)},this.applyToPoint=function(p){var a=this.angle.toRadians();p.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0]),p.applyTransform([Math.cos(a),Math.sin(a),-Math.sin(a),Math.cos(a),0,0]),p.applyTransform([1,0,0,1,-this.p.x||0,-this.p.y||0])}},this.Type.scale=function(s){this.p=svg.CreatePoint(s),this.apply=function(ctx){ctx.scale(this.p.x||1,this.p.y||this.p.x||1)},this.applyToPoint=function(p){p.applyTransform([this.p.x||0,0,0,this.p.y||0,0,0])}},this.Type.matrix=function(s){this.m=svg.ToNumberArray(s),this.apply=function(ctx){ctx.transform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])
},this.applyToPoint=function(p){p.applyTransform(this.m)}},this.Type.SkewBase=function(s){this.base=that.Type.matrix,this.base(s),this.angle=new svg.Property("angle",s)},this.Type.SkewBase.prototype=new this.Type.matrix,this.Type.skewX=function(s){this.base=that.Type.SkewBase,this.base(s),this.m=[1,0,Math.tan(this.angle.toRadians()),1,0,0]},this.Type.skewX.prototype=new this.Type.SkewBase,this.Type.skewY=function(s){this.base=that.Type.SkewBase,this.base(s),this.m=[1,Math.tan(this.angle.toRadians()),0,1,0,0]},this.Type.skewY.prototype=new this.Type.SkewBase,this.transforms=[],this.apply=function(ctx){for(var i=0;i<this.transforms.length;i++)this.transforms[i].apply(ctx)},this.applyToPoint=function(p){for(var i=0;i<this.transforms.length;i++)this.transforms[i].applyToPoint(p)};for(var data=svg.trim(svg.compressSpaces(v)).split(/\s(?=[a-z])/),i=0;i<data.length;i++){var type=data[i].split("(")[0],s=data[i].split("(")[1].replace(")",""),transform=new this.Type[type](s);this.transforms.push(transform)}},svg.AspectRatio=function(ctx,aspectRatio,width,desiredWidth,height,desiredHeight,minX,minY,refX,refY){aspectRatio=svg.compressSpaces(aspectRatio),aspectRatio=aspectRatio.replace(/^defer\s/,"");var align=aspectRatio.split(" ")[0]||"xMidYMid",meetOrSlice=aspectRatio.split(" ")[1]||"meet",scaleX=width/desiredWidth,scaleY=height/desiredHeight,scaleMin=Math.min(scaleX,scaleY),scaleMax=Math.max(scaleX,scaleY);"meet"==meetOrSlice&&(desiredWidth*=scaleMin,desiredHeight*=scaleMin),"slice"==meetOrSlice&&(desiredWidth*=scaleMax,desiredHeight*=scaleMax),refX=new svg.Property("refX",refX),refY=new svg.Property("refY",refY),refX.hasValue()&&refY.hasValue()?ctx.translate(-scaleMin*refX.toPixels("x"),-scaleMin*refY.toPixels("y")):(align.match(/^xMid/)&&("meet"==meetOrSlice&&scaleMin==scaleY||"slice"==meetOrSlice&&scaleMax==scaleY)&&ctx.translate(width/2-desiredWidth/2,0),align.match(/YMid$/)&&("meet"==meetOrSlice&&scaleMin==scaleX||"slice"==meetOrSlice&&scaleMax==scaleX)&&ctx.translate(0,height/2-desiredHeight/2),align.match(/^xMax/)&&("meet"==meetOrSlice&&scaleMin==scaleY||"slice"==meetOrSlice&&scaleMax==scaleY)&&ctx.translate(width-desiredWidth,0),align.match(/YMax$/)&&("meet"==meetOrSlice&&scaleMin==scaleX||"slice"==meetOrSlice&&scaleMax==scaleX)&&ctx.translate(0,height-desiredHeight)),"none"==align?ctx.scale(scaleX,scaleY):"meet"==meetOrSlice?ctx.scale(scaleMin,scaleMin):"slice"==meetOrSlice&&ctx.scale(scaleMax,scaleMax),ctx.translate(null==minX?0:-minX,null==minY?0:-minY)},svg.Element={},svg.EmptyProperty=new svg.Property("EMPTY",""),svg.Element.ElementBase=function(node){if(this.attributes={},this.styles={},this.children=[],this.attribute=function(name,createIfNotExists){var a=this.attributes[name];return null!=a?a:(1==createIfNotExists&&(a=new svg.Property(name,""),this.attributes[name]=a),a||svg.EmptyProperty)},this.style=function(name,createIfNotExists){var s=this.styles[name];if(null!=s)return s;var a=this.attribute(name);if(null!=a&&a.hasValue())return this.styles[name]=a,a;var p=this.parent;if(null!=p){var ps=p.style(name);if(null!=ps&&ps.hasValue())return ps}return 1==createIfNotExists&&(s=new svg.Property(name,""),this.styles[name]=s),s||svg.EmptyProperty},this.render=function(ctx){if("none"!=this.style("display").value&&"hidden"!=this.attribute("visibility").value){if(ctx.save(),this.setContext(ctx),this.attribute("mask").hasValue()){var mask=this.attribute("mask").getDefinition();null!=mask&&mask.apply(ctx,this)}else if(this.style("filter").hasValue()){var filter=this.style("filter").getDefinition();null!=filter&&filter.apply(ctx,this)}else this.renderChildren(ctx);this.clearContext(ctx),ctx.restore()}},this.setContext=function(){},this.clearContext=function(){},this.renderChildren=function(ctx){for(var i=0;i<this.children.length;i++)this.children[i].render(ctx)},this.addChild=function(childNode,create){var child=childNode;create&&(child=svg.CreateElement(childNode)),child.parent=this,this.children.push(child)},null!=node&&1==node.nodeType){for(var i=0;i<node.childNodes.length;i++){var childNode=node.childNodes[i];1==childNode.nodeType&&this.addChild(childNode,!0)}for(var i=0;i<node.attributes.length;i++){var attribute=node.attributes[i];this.attributes[attribute.nodeName]=new svg.Property(attribute.nodeName,attribute.nodeValue)}var styles=svg.Styles[node.nodeName];if(null!=styles)for(var name in styles)this.styles[name]=styles[name];if(this.attribute("class").hasValue())for(var classes=svg.compressSpaces(this.attribute("class").value).split(" "),j=0;j<classes.length;j++){if(styles=svg.Styles["."+classes[j]],null!=styles)for(var name in styles)this.styles[name]=styles[name];if(styles=svg.Styles[node.nodeName+"."+classes[j]],null!=styles)for(var name in styles)this.styles[name]=styles[name]}if(this.attribute("id").hasValue()){var styles=svg.Styles["#"+this.attribute("id").value];if(null!=styles)for(var name in styles)this.styles[name]=styles[name]}if(this.attribute("style").hasValue())for(var styles=this.attribute("style").value.split(";"),i=0;i<styles.length;i++)if(""!=svg.trim(styles[i])){var style=styles[i].split(":"),name=svg.trim(style[0]),value=svg.trim(style[1]);this.styles[name]=new svg.Property(name,value)}this.attribute("id").hasValue()&&null==svg.Definitions[this.attribute("id").value]&&(svg.Definitions[this.attribute("id").value]=this)}},svg.Element.RenderedElementBase=function(node){this.base=svg.Element.ElementBase,this.base(node),this.setContext=function(ctx){if(this.style("fill").isUrlDefinition()){var fs=this.style("fill").getFillStyleDefinition(this);null!=fs&&(ctx.fillStyle=fs)}else if(this.style("fill").hasValue()){var fillStyle=this.style("fill");"currentColor"==fillStyle.value&&(fillStyle.value=this.style("color").value),ctx.fillStyle="none"==fillStyle.value?"rgba(0,0,0,0)":fillStyle.value}if(this.style("fill-opacity").hasValue()){var fillStyle=new svg.Property("fill",ctx.fillStyle);fillStyle=fillStyle.addOpacity(this.style("fill-opacity").value),ctx.fillStyle=fillStyle.value}if(this.style("stroke").isUrlDefinition()){var fs=this.style("stroke").getFillStyleDefinition(this);null!=fs&&(ctx.strokeStyle=fs)}else if(this.style("stroke").hasValue()){var strokeStyle=this.style("stroke");"currentColor"==strokeStyle.value&&(strokeStyle.value=this.style("color").value),ctx.strokeStyle="none"==strokeStyle.value?"rgba(0,0,0,0)":strokeStyle.value}if(this.style("stroke-opacity").hasValue()){var strokeStyle=new svg.Property("stroke",ctx.strokeStyle);strokeStyle=strokeStyle.addOpacity(this.style("stroke-opacity").value),ctx.strokeStyle=strokeStyle.value}if(this.style("stroke-width").hasValue()&&(ctx.lineWidth=this.style("stroke-width").toPixels()),this.style("stroke-linecap").hasValue()&&(ctx.lineCap=this.style("stroke-linecap").value),this.style("stroke-linejoin").hasValue()&&(ctx.lineJoin=this.style("stroke-linejoin").value),this.style("stroke-miterlimit").hasValue()&&(ctx.miterLimit=this.style("stroke-miterlimit").value),"undefined"!=typeof ctx.font&&(ctx.font=svg.Font.CreateFont(this.style("font-style").value,this.style("font-variant").value,this.style("font-weight").value,this.style("font-size").hasValue()?this.style("font-size").toPixels()+"px":"",this.style("font-family").value).toString()),this.attribute("transform").hasValue()){var transform=new svg.Transform(this.attribute("transform").value);transform.apply(ctx)}if(this.attribute("clip-path").hasValue()){var clip=this.attribute("clip-path").getDefinition();null!=clip&&clip.apply(ctx)}this.style("opacity").hasValue()&&(ctx.globalAlpha=this.style("opacity").numValue())}},svg.Element.RenderedElementBase.prototype=new svg.Element.ElementBase,svg.Element.PathElementBase=function(node){this.base=svg.Element.RenderedElementBase,this.base(node),this.path=function(ctx){return null!=ctx&&ctx.beginPath(),new svg.BoundingBox},this.renderChildren=function(ctx){this.path(ctx),svg.Mouse.checkPath(this,ctx),""!=ctx.fillStyle&&ctx.fill(),""!=ctx.strokeStyle&&ctx.stroke();var markers=this.getMarkers();if(null!=markers){if(this.style("marker-start").isUrlDefinition()){var marker=this.style("marker-start").getDefinition();marker.render(ctx,markers[0][0],markers[0][1])}if(this.style("marker-mid").isUrlDefinition())for(var marker=this.style("marker-mid").getDefinition(),i=1;i<markers.length-1;i++)marker.render(ctx,markers[i][0],markers[i][1]);if(this.style("marker-end").isUrlDefinition()){var marker=this.style("marker-end").getDefinition();marker.render(ctx,markers[markers.length-1][0],markers[markers.length-1][1])}}},this.getBoundingBox=function(){return this.path()},this.getMarkers=function(){return null}},svg.Element.PathElementBase.prototype=new svg.Element.RenderedElementBase,svg.Element.svg=function(node){this.base=svg.Element.RenderedElementBase,this.base(node),this.baseClearContext=this.clearContext,this.clearContext=function(ctx){this.baseClearContext(ctx),svg.ViewPort.RemoveCurrent()},this.baseSetContext=this.setContext,this.setContext=function(ctx){ctx.strokeStyle="rgba(0,0,0,0)",ctx.lineCap="butt",ctx.lineJoin="miter",ctx.miterLimit=4,this.baseSetContext(ctx),this.attribute("x").hasValue()||(this.attribute("x",!0).value=0),this.attribute("y").hasValue()||(this.attribute("y",!0).value=0),ctx.translate(this.attribute("x").toPixels("x"),this.attribute("y").toPixels("y"));var width=svg.ViewPort.width(),height=svg.ViewPort.height();if(this.attribute("width").hasValue()||(this.attribute("width",!0).value="100%"),this.attribute("height").hasValue()||(this.attribute("height",!0).value="100%"),"undefined"==typeof this.root){width=this.attribute("width").toPixels("x"),height=this.attribute("height").toPixels("y");var x=0,y=0;this.attribute("refX").hasValue()&&this.attribute("refY").hasValue()&&(x=-this.attribute("refX").toPixels("x"),y=-this.attribute("refY").toPixels("y")),ctx.beginPath(),ctx.moveTo(x,y),ctx.lineTo(width,y),ctx.lineTo(width,height),ctx.lineTo(x,height),ctx.closePath(),ctx.clip()}if(svg.ViewPort.SetCurrent(width,height),this.attribute("viewBox").hasValue()){var viewBox=svg.ToNumberArray(this.attribute("viewBox").value),minX=viewBox[0],minY=viewBox[1];width=viewBox[2],height=viewBox[3],svg.AspectRatio(ctx,this.attribute("preserveAspectRatio").value,svg.ViewPort.width(),width,svg.ViewPort.height(),height,minX,minY,this.attribute("refX").value,this.attribute("refY").value),svg.ViewPort.RemoveCurrent(),svg.ViewPort.SetCurrent(viewBox[2],viewBox[3])}}},svg.Element.svg.prototype=new svg.Element.RenderedElementBase,svg.Element.rect=function(node){this.base=svg.Element.PathElementBase,this.base(node),this.path=function(ctx){var x=this.attribute("x").toPixels("x"),y=this.attribute("y").toPixels("y"),width=this.attribute("width").toPixels("x"),height=this.attribute("height").toPixels("y"),rx=this.attribute("rx").toPixels("x"),ry=this.attribute("ry").toPixels("y");return this.attribute("rx").hasValue()&&!this.attribute("ry").hasValue()&&(ry=rx),this.attribute("ry").hasValue()&&!this.attribute("rx").hasValue()&&(rx=ry),null!=ctx&&(ctx.beginPath(),ctx.moveTo(x+rx,y),ctx.lineTo(x+width-rx,y),ctx.quadraticCurveTo(x+width,y,x+width,y+ry),ctx.lineTo(x+width,y+height-ry),ctx.quadraticCurveTo(x+width,y+height,x+width-rx,y+height),ctx.lineTo(x+rx,y+height),ctx.quadraticCurveTo(x,y+height,x,y+height-ry),ctx.lineTo(x,y+ry),ctx.quadraticCurveTo(x,y,x+rx,y),ctx.closePath()),new svg.BoundingBox(x,y,x+width,y+height)}},svg.Element.rect.prototype=new svg.Element.PathElementBase,svg.Element.circle=function(node){this.base=svg.Element.PathElementBase,this.base(node),this.path=function(ctx){var cx=this.attribute("cx").toPixels("x"),cy=this.attribute("cy").toPixels("y"),r=this.attribute("r").toPixels();return null!=ctx&&(ctx.beginPath(),ctx.arc(cx,cy,r,0,2*Math.PI,!0),ctx.closePath()),new svg.BoundingBox(cx-r,cy-r,cx+r,cy+r)}},svg.Element.circle.prototype=new svg.Element.PathElementBase,svg.Element.ellipse=function(node){this.base=svg.Element.PathElementBase,this.base(node),this.path=function(ctx){var KAPPA=4*((Math.sqrt(2)-1)/3),rx=this.attribute("rx").toPixels("x"),ry=this.attribute("ry").toPixels("y"),cx=this.attribute("cx").toPixels("x"),cy=this.attribute("cy").toPixels("y");return null!=ctx&&(ctx.beginPath(),ctx.moveTo(cx,cy-ry),ctx.bezierCurveTo(cx+KAPPA*rx,cy-ry,cx+rx,cy-KAPPA*ry,cx+rx,cy),ctx.bezierCurveTo(cx+rx,cy+KAPPA*ry,cx+KAPPA*rx,cy+ry,cx,cy+ry),ctx.bezierCurveTo(cx-KAPPA*rx,cy+ry,cx-rx,cy+KAPPA*ry,cx-rx,cy),ctx.bezierCurveTo(cx-rx,cy-KAPPA*ry,cx-KAPPA*rx,cy-ry,cx,cy-ry),ctx.closePath()),new svg.BoundingBox(cx-rx,cy-ry,cx+rx,cy+ry)}},svg.Element.ellipse.prototype=new svg.Element.PathElementBase,svg.Element.line=function(node){this.base=svg.Element.PathElementBase,this.base(node),this.getPoints=function(){return[new svg.Point(this.attribute("x1").toPixels("x"),this.attribute("y1").toPixels("y")),new svg.Point(this.attribute("x2").toPixels("x"),this.attribute("y2").toPixels("y"))]},this.path=function(ctx){var points=this.getPoints();return null!=ctx&&(ctx.beginPath(),ctx.moveTo(points[0].x,points[0].y),ctx.lineTo(points[1].x,points[1].y)),new svg.BoundingBox(points[0].x,points[0].y,points[1].x,points[1].y)},this.getMarkers=function(){var points=this.getPoints(),a=points[0].angleTo(points[1]);return[[points[0],a],[points[1],a]]}},svg.Element.line.prototype=new svg.Element.PathElementBase,svg.Element.polyline=function(node){this.base=svg.Element.PathElementBase,this.base(node),this.points=svg.CreatePath(this.attribute("points").value),this.path=function(ctx){var bb=new svg.BoundingBox(this.points[0].x,this.points[0].y);null!=ctx&&(ctx.beginPath(),ctx.moveTo(this.points[0].x,this.points[0].y));for(var i=1;i<this.points.length;i++)bb.addPoint(this.points[i].x,this.points[i].y),null!=ctx&&ctx.lineTo(this.points[i].x,this.points[i].y);return bb},this.getMarkers=function(){for(var markers=[],i=0;i<this.points.length-1;i++)markers.push([this.points[i],this.points[i].angleTo(this.points[i+1])]);return markers.push([this.points[this.points.length-1],markers[markers.length-1][1]]),markers}},svg.Element.polyline.prototype=new svg.Element.PathElementBase,svg.Element.polygon=function(node){this.base=svg.Element.polyline,this.base(node),this.basePath=this.path,this.path=function(ctx){var bb=this.basePath(ctx);return null!=ctx&&(ctx.lineTo(this.points[0].x,this.points[0].y),ctx.closePath()),bb}},svg.Element.polygon.prototype=new svg.Element.polyline,svg.Element.path=function(node){this.base=svg.Element.PathElementBase,this.base(node);var d=this.attribute("d").value;d=d.replace(/,/gm," "),d=d.replace(/([MmZzLlHhVvCcSsQqTtAa])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),d=d.replace(/([MmZzLlHhVvCcSsQqTtAa])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),d=d.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,"$1 $2"),d=d.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),d=d.replace(/([0-9])([+\-])/gm,"$1 $2"),d=d.replace(/(\.[0-9]*)(\.)/gm,"$1 $2"),d=d.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 "),d=svg.compressSpaces(d),d=svg.trim(d),this.PathParser=new function(d){this.tokens=d.split(" "),this.reset=function(){this.i=-1,this.command="",this.previousCommand="",this.start=new svg.Point(0,0),this.control=new svg.Point(0,0),this.current=new svg.Point(0,0),this.points=[],this.angles=[]},this.isEnd=function(){return this.i>=this.tokens.length-1},this.isCommandOrEnd=function(){return this.isEnd()?!0:null!=this.tokens[this.i+1].match(/^[A-Za-z]$/)},this.isRelativeCommand=function(){switch(this.command){case"m":case"l":case"h":case"v":case"c":case"s":case"q":case"t":case"a":case"z":return!0}return!1},this.getToken=function(){return this.i++,this.tokens[this.i]},this.getScalar=function(){return parseFloat(this.getToken())},this.nextCommand=function(){this.previousCommand=this.command,this.command=this.getToken()},this.getPoint=function(){var p=new svg.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(p)},this.getAsControlPoint=function(){var p=this.getPoint();return this.control=p,p},this.getAsCurrentPoint=function(){var p=this.getPoint();return this.current=p,p},this.getReflectedControlPoint=function(){if("c"!=this.previousCommand.toLowerCase()&&"s"!=this.previousCommand.toLowerCase())return this.current;var p=new svg.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y);return p},this.makeAbsolute=function(p){return this.isRelativeCommand()&&(p.x+=this.current.x,p.y+=this.current.y),p},this.addMarker=function(p,from,priorTo){null!=priorTo&&this.angles.length>0&&null==this.angles[this.angles.length-1]&&(this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(priorTo)),this.addMarkerAngle(p,null==from?null:from.angleTo(p))},this.addMarkerAngle=function(p,a){this.points.push(p),this.angles.push(a)},this.getMarkerPoints=function(){return this.points},this.getMarkerAngles=function(){for(var i=0;i<this.angles.length;i++)if(null==this.angles[i])for(var j=i+1;j<this.angles.length;j++)if(null!=this.angles[j]){this.angles[i]=this.angles[j];break}return this.angles}}(d),this.path=function(ctx){var pp=this.PathParser;pp.reset();var bb=new svg.BoundingBox;for(null!=ctx&&ctx.beginPath();!pp.isEnd();)switch(pp.nextCommand(),pp.command){case"M":case"m":var p=pp.getAsCurrentPoint();for(pp.addMarker(p),bb.addPoint(p.x,p.y),null!=ctx&&ctx.moveTo(p.x,p.y),pp.start=pp.current;!pp.isCommandOrEnd();){var p=pp.getAsCurrentPoint();pp.addMarker(p,pp.start),bb.addPoint(p.x,p.y),null!=ctx&&ctx.lineTo(p.x,p.y)}break;case"L":case"l":for(;!pp.isCommandOrEnd();){var c=pp.current,p=pp.getAsCurrentPoint();pp.addMarker(p,c),bb.addPoint(p.x,p.y),null!=ctx&&ctx.lineTo(p.x,p.y)}break;case"H":case"h":for(;!pp.isCommandOrEnd();){var newP=new svg.Point((pp.isRelativeCommand()?pp.current.x:0)+pp.getScalar(),pp.current.y);pp.addMarker(newP,pp.current),pp.current=newP,bb.addPoint(pp.current.x,pp.current.y),null!=ctx&&ctx.lineTo(pp.current.x,pp.current.y)}break;case"V":case"v":for(;!pp.isCommandOrEnd();){var newP=new svg.Point(pp.current.x,(pp.isRelativeCommand()?pp.current.y:0)+pp.getScalar());pp.addMarker(newP,pp.current),pp.current=newP,bb.addPoint(pp.current.x,pp.current.y),null!=ctx&&ctx.lineTo(pp.current.x,pp.current.y)}break;case"C":case"c":for(;!pp.isCommandOrEnd();){var curr=pp.current,p1=pp.getPoint(),cntrl=pp.getAsControlPoint(),cp=pp.getAsCurrentPoint();pp.addMarker(cp,cntrl,p1),bb.addBezierCurve(curr.x,curr.y,p1.x,p1.y,cntrl.x,cntrl.y,cp.x,cp.y),null!=ctx&&ctx.bezierCurveTo(p1.x,p1.y,cntrl.x,cntrl.y,cp.x,cp.y)}break;case"S":case"s":for(;!pp.isCommandOrEnd();){var curr=pp.current,p1=pp.getReflectedControlPoint(),cntrl=pp.getAsControlPoint(),cp=pp.getAsCurrentPoint();pp.addMarker(cp,cntrl,p1),bb.addBezierCurve(curr.x,curr.y,p1.x,p1.y,cntrl.x,cntrl.y,cp.x,cp.y),null!=ctx&&ctx.bezierCurveTo(p1.x,p1.y,cntrl.x,cntrl.y,cp.x,cp.y)}break;case"Q":case"q":for(;!pp.isCommandOrEnd();){var curr=pp.current,cntrl=pp.getAsControlPoint(),cp=pp.getAsCurrentPoint();pp.addMarker(cp,cntrl,cntrl),bb.addQuadraticCurve(curr.x,curr.y,cntrl.x,cntrl.y,cp.x,cp.y),null!=ctx&&ctx.quadraticCurveTo(cntrl.x,cntrl.y,cp.x,cp.y)}break;case"T":case"t":for(;!pp.isCommandOrEnd();){var curr=pp.current,cntrl=pp.getReflectedControlPoint();pp.control=cntrl;var cp=pp.getAsCurrentPoint();pp.addMarker(cp,cntrl,cntrl),bb.addQuadraticCurve(curr.x,curr.y,cntrl.x,cntrl.y,cp.x,cp.y),null!=ctx&&ctx.quadraticCurveTo(cntrl.x,cntrl.y,cp.x,cp.y)}break;case"A":case"a":for(;!pp.isCommandOrEnd();){var curr=pp.current,rx=pp.getScalar(),ry=pp.getScalar(),xAxisRotation=pp.getScalar()*(Math.PI/180),largeArcFlag=pp.getScalar(),sweepFlag=pp.getScalar(),cp=pp.getAsCurrentPoint(),currp=new svg.Point(Math.cos(xAxisRotation)*(curr.x-cp.x)/2+Math.sin(xAxisRotation)*(curr.y-cp.y)/2,-Math.sin(xAxisRotation)*(curr.x-cp.x)/2+Math.cos(xAxisRotation)*(curr.y-cp.y)/2),l=Math.pow(currp.x,2)/Math.pow(rx,2)+Math.pow(currp.y,2)/Math.pow(ry,2);l>1&&(rx*=Math.sqrt(l),ry*=Math.sqrt(l));var s=(largeArcFlag==sweepFlag?-1:1)*Math.sqrt((Math.pow(rx,2)*Math.pow(ry,2)-Math.pow(rx,2)*Math.pow(currp.y,2)-Math.pow(ry,2)*Math.pow(currp.x,2))/(Math.pow(rx,2)*Math.pow(currp.y,2)+Math.pow(ry,2)*Math.pow(currp.x,2)));isNaN(s)&&(s=0);var cpp=new svg.Point(s*rx*currp.y/ry,s*-ry*currp.x/rx),centp=new svg.Point((curr.x+cp.x)/2+Math.cos(xAxisRotation)*cpp.x-Math.sin(xAxisRotation)*cpp.y,(curr.y+cp.y)/2+Math.sin(xAxisRotation)*cpp.x+Math.cos(xAxisRotation)*cpp.y),m=function(v){return Math.sqrt(Math.pow(v[0],2)+Math.pow(v[1],2))},r=function(u,v){return(u[0]*v[0]+u[1]*v[1])/(m(u)*m(v))},a=function(u,v){return(u[0]*v[1]<u[1]*v[0]?-1:1)*Math.acos(r(u,v))},a1=a([1,0],[(currp.x-cpp.x)/rx,(currp.y-cpp.y)/ry]),u=[(currp.x-cpp.x)/rx,(currp.y-cpp.y)/ry],v=[(-currp.x-cpp.x)/rx,(-currp.y-cpp.y)/ry],ad=a(u,v);r(u,v)<=-1&&(ad=Math.PI),r(u,v)>=1&&(ad=0),0==sweepFlag&&ad>0&&(ad-=2*Math.PI),1==sweepFlag&&0>ad&&(ad+=2*Math.PI);var halfWay=new svg.Point(centp.x+rx*Math.cos((a1+(a1+ad))/2),centp.y+ry*Math.sin((a1+(a1+ad))/2));if(pp.addMarkerAngle(halfWay,(a1+(a1+ad))/2+(0==sweepFlag?-1:1)*Math.PI/2),pp.addMarkerAngle(cp,a1+ad+(0==sweepFlag?-1:1)*Math.PI/2),bb.addPoint(cp.x,cp.y),null!=ctx){var r=rx>ry?rx:ry,sx=rx>ry?1:rx/ry,sy=rx>ry?ry/rx:1;ctx.translate(centp.x,centp.y),ctx.rotate(xAxisRotation),ctx.scale(sx,sy),ctx.arc(0,0,r,a1,a1+ad,1-sweepFlag),ctx.scale(1/sx,1/sy),ctx.rotate(-xAxisRotation),ctx.translate(-centp.x,-centp.y)}}break;case"Z":case"z":null!=ctx&&ctx.closePath(),pp.current=pp.start}return bb},this.getMarkers=function(){for(var points=this.PathParser.getMarkerPoints(),angles=this.PathParser.getMarkerAngles(),markers=[],i=0;i<points.length;i++)markers.push([points[i],angles[i]]);return markers}},svg.Element.path.prototype=new svg.Element.PathElementBase,svg.Element.pattern=function(node){this.base=svg.Element.ElementBase,this.base(node),this.createPattern=function(ctx){var tempSvg=new svg.Element.svg;tempSvg.attributes.viewBox=new svg.Property("viewBox",this.attribute("viewBox").value),tempSvg.attributes.x=new svg.Property("x",this.attribute("x").value),tempSvg.attributes.y=new svg.Property("y",this.attribute("y").value),tempSvg.attributes.width=new svg.Property("width",this.attribute("width").value),tempSvg.attributes.height=new svg.Property("height",this.attribute("height").value),tempSvg.children=this.children;var c=document.createElement("canvas");return document.body.appendChild(c),c.width=this.attribute("width").toPixels("x")+this.attribute("x").toPixels("x"),c.height=this.attribute("height").toPixels("y")+this.attribute("y").toPixels("y"),tempSvg.render(c.getContext("2d")),ctx.createPattern(c,"repeat")}},svg.Element.pattern.prototype=new svg.Element.ElementBase,svg.Element.marker=function(node){this.base=svg.Element.ElementBase,this.base(node),this.baseRender=this.render,this.render=function(ctx,point,angle){ctx.translate(point.x,point.y),"auto"==this.attribute("orient").valueOrDefault("auto")&&ctx.rotate(angle),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&ctx.scale(ctx.lineWidth,ctx.lineWidth),ctx.save();var tempSvg=new svg.Element.svg;tempSvg.attributes.viewBox=new svg.Property("viewBox",this.attribute("viewBox").value),tempSvg.attributes.refX=new svg.Property("refX",this.attribute("refX").value),tempSvg.attributes.refY=new svg.Property("refY",this.attribute("refY").value),tempSvg.attributes.width=new svg.Property("width",this.attribute("markerWidth").value),tempSvg.attributes.height=new svg.Property("height",this.attribute("markerHeight").value),tempSvg.attributes.fill=new svg.Property("fill",this.attribute("fill").valueOrDefault("black")),tempSvg.attributes.stroke=new svg.Property("stroke",this.attribute("stroke").valueOrDefault("none")),tempSvg.children=this.children,tempSvg.render(ctx),ctx.restore(),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&ctx.scale(1/ctx.lineWidth,1/ctx.lineWidth),"auto"==this.attribute("orient").valueOrDefault("auto")&&ctx.rotate(-angle),ctx.translate(-point.x,-point.y)}},svg.Element.marker.prototype=new svg.Element.ElementBase,svg.Element.defs=function(node){this.base=svg.Element.ElementBase,this.base(node),this.render=function(){}},svg.Element.defs.prototype=new svg.Element.ElementBase,svg.Element.GradientBase=function(node){this.base=svg.Element.ElementBase,this.base(node),this.gradientUnits=this.attribute("gradientUnits").valueOrDefault("objectBoundingBox"),this.stops=[];for(var i=0;i<this.children.length;i++){var child=this.children[i];this.stops.push(child)}this.getGradient=function(){},this.createGradient=function(ctx,element){var stopsContainer=this;this.attribute("xlink:href").hasValue()&&(stopsContainer=this.attribute("xlink:href").getDefinition());var g=this.getGradient(ctx,element);if(null==g)return stopsContainer.stops[stopsContainer.stops.length-1].color;for(var i=0;i<stopsContainer.stops.length;i++)g.addColorStop(stopsContainer.stops[i].offset,stopsContainer.stops[i].color);if(this.attribute("gradientTransform").hasValue()){var rootView=svg.ViewPort.viewPorts[0],rect=new svg.Element.rect;rect.attributes.x=new svg.Property("x",-svg.MAX_VIRTUAL_PIXELS/3),rect.attributes.y=new svg.Property("y",-svg.MAX_VIRTUAL_PIXELS/3),rect.attributes.width=new svg.Property("width",svg.MAX_VIRTUAL_PIXELS),rect.attributes.height=new svg.Property("height",svg.MAX_VIRTUAL_PIXELS);var group=new svg.Element.g;group.attributes.transform=new svg.Property("transform",this.attribute("gradientTransform").value),group.children=[rect];var tempSvg=new svg.Element.svg;tempSvg.attributes.x=new svg.Property("x",0),tempSvg.attributes.y=new svg.Property("y",0),tempSvg.attributes.width=new svg.Property("width",rootView.width),tempSvg.attributes.height=new svg.Property("height",rootView.height),tempSvg.children=[group];var c=document.createElement("canvas");c.width=rootView.width,c.height=rootView.height;var tempCtx=c.getContext("2d");return tempCtx.fillStyle=g,tempSvg.render(tempCtx),tempCtx.createPattern(c,"no-repeat")}return g}},svg.Element.GradientBase.prototype=new svg.Element.ElementBase,svg.Element.linearGradient=function(node){this.base=svg.Element.GradientBase,this.base(node),this.getGradient=function(ctx,element){var bb=element.getBoundingBox(),x1="objectBoundingBox"==this.gradientUnits?bb.x()+bb.width()*this.attribute("x1").numValue():this.attribute("x1").toPixels("x"),y1="objectBoundingBox"==this.gradientUnits?bb.y()+bb.height()*this.attribute("y1").numValue():this.attribute("y1").toPixels("y"),x2="objectBoundingBox"==this.gradientUnits?bb.x()+bb.width()*this.attribute("x2").numValue():this.attribute("x2").toPixels("x"),y2="objectBoundingBox"==this.gradientUnits?bb.y()+bb.height()*this.attribute("y2").numValue():this.attribute("y2").toPixels("y");return x1==x2&&y1==y2?null:ctx.createLinearGradient(x1,y1,x2,y2)}},svg.Element.linearGradient.prototype=new svg.Element.GradientBase,svg.Element.radialGradient=function(node){this.base=svg.Element.GradientBase,this.base(node),this.getGradient=function(ctx,element){var bb=element.getBoundingBox();this.attribute("cx").hasValue()||(this.attribute("cx",!0).value="50%"),this.attribute("cy").hasValue()||(this.attribute("cy",!0).value="50%"),this.attribute("r").hasValue()||(this.attribute("r",!0).value="50%");var cx="objectBoundingBox"==this.gradientUnits?bb.x()+bb.width()*this.attribute("cx").numValue():this.attribute("cx").toPixels("x"),cy="objectBoundingBox"==this.gradientUnits?bb.y()+bb.height()*this.attribute("cy").numValue():this.attribute("cy").toPixels("y"),fx=cx,fy=cy;this.attribute("fx").hasValue()&&(fx="objectBoundingBox"==this.gradientUnits?bb.x()+bb.width()*this.attribute("fx").numValue():this.attribute("fx").toPixels("x")),this.attribute("fy").hasValue()&&(fy="objectBoundingBox"==this.gradientUnits?bb.y()+bb.height()*this.attribute("fy").numValue():this.attribute("fy").toPixels("y"));var r="objectBoundingBox"==this.gradientUnits?(bb.width()+bb.height())/2*this.attribute("r").numValue():this.attribute("r").toPixels();return ctx.createRadialGradient(fx,fy,0,cx,cy,r)}},svg.Element.radialGradient.prototype=new svg.Element.GradientBase,svg.Element.stop=function(node){this.base=svg.Element.ElementBase,this.base(node),this.offset=this.attribute("offset").numValue();var stopColor=this.style("stop-color");this.style("stop-opacity").hasValue()&&(stopColor=stopColor.addOpacity(this.style("stop-opacity").value)),this.color=stopColor.value},svg.Element.stop.prototype=new svg.Element.ElementBase,svg.Element.AnimateBase=function(node){this.base=svg.Element.ElementBase,this.base(node),svg.Animations.push(this),this.duration=0,this.begin=this.attribute("begin").toMilliseconds(),this.maxDuration=this.begin+this.attribute("dur").toMilliseconds(),this.getProperty=function(){var attributeType=this.attribute("attributeType").value,attributeName=this.attribute("attributeName").value;return"CSS"==attributeType?this.parent.style(attributeName,!0):this.parent.attribute(attributeName,!0)},this.initialValue=null,this.initialUnits="",this.removed=!1,this.calcValue=function(){return""},this.update=function(delta){if(null==this.initialValue&&(this.initialValue=this.getProperty().value,this.initialUnits=this.getProperty().getUnits()),this.duration>this.maxDuration){if("indefinite"!=this.attribute("repeatCount").value)return"remove"!=this.attribute("fill").valueOrDefault("remove")||this.removed?!1:(this.removed=!0,this.getProperty().value=this.initialValue,!0);this.duration=0}this.duration=this.duration+delta;var updated=!1;if(this.begin<this.duration){var newValue=this.calcValue();if(this.attribute("type").hasValue()){var type=this.attribute("type").value;newValue=type+"("+newValue+")"}this.getProperty().value=newValue,updated=!0}return updated},this.from=this.attribute("from"),this.to=this.attribute("to"),this.values=this.attribute("values"),this.values.hasValue()&&(this.values.value=this.values.value.split(";")),this.progress=function(){var ret={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(this.values.hasValue()){var p=ret.progress*(this.values.value.length-1),lb=Math.floor(p),ub=Math.ceil(p);ret.from=new svg.Property("from",parseFloat(this.values.value[lb])),ret.to=new svg.Property("to",parseFloat(this.values.value[ub])),ret.progress=(p-lb)/(ub-lb)}else ret.from=this.from,ret.to=this.to;return ret}},svg.Element.AnimateBase.prototype=new svg.Element.ElementBase,svg.Element.animate=function(node){this.base=svg.Element.AnimateBase,this.base(node),this.calcValue=function(){var p=this.progress(),newValue=p.from.numValue()+(p.to.numValue()-p.from.numValue())*p.progress;return newValue+this.initialUnits}},svg.Element.animate.prototype=new svg.Element.AnimateBase,svg.Element.animateColor=function(node){this.base=svg.Element.AnimateBase,this.base(node),this.calcValue=function(){var p=this.progress(),from=new RGBColor(p.from.value),to=new RGBColor(p.to.value);if(from.ok&&to.ok){var r=from.r+(to.r-from.r)*p.progress,g=from.g+(to.g-from.g)*p.progress,b=from.b+(to.b-from.b)*p.progress;return"rgb("+parseInt(r,10)+","+parseInt(g,10)+","+parseInt(b,10)+")"}return this.attribute("from").value}},svg.Element.animateColor.prototype=new svg.Element.AnimateBase,svg.Element.animateTransform=function(node){this.base=svg.Element.animate,this.base(node)},svg.Element.animateTransform.prototype=new svg.Element.animate,svg.Element.font=function(node){this.base=svg.Element.ElementBase,this.base(node),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.isRTL=!1,this.isArabic=!1,this.fontFace=null,this.missingGlyph=null,this.glyphs=[];for(var i=0;i<this.children.length;i++){var child=this.children[i];"font-face"==child.type?(this.fontFace=child,child.style("font-family").hasValue()&&(svg.Definitions[child.style("font-family").value]=this)):"missing-glyph"==child.type?this.missingGlyph=child:"glyph"==child.type&&(""!=child.arabicForm?(this.isRTL=!0,this.isArabic=!0,"undefined"==typeof this.glyphs[child.unicode]&&(this.glyphs[child.unicode]=[]),this.glyphs[child.unicode][child.arabicForm]=child):this.glyphs[child.unicode]=child)}},svg.Element.font.prototype=new svg.Element.ElementBase,svg.Element.fontface=function(node){this.base=svg.Element.ElementBase,this.base(node),this.ascent=this.attribute("ascent").value,this.descent=this.attribute("descent").value,this.unitsPerEm=this.attribute("units-per-em").numValue()
},svg.Element.fontface.prototype=new svg.Element.ElementBase,svg.Element.missingglyph=function(node){this.base=svg.Element.path,this.base(node),this.horizAdvX=0},svg.Element.missingglyph.prototype=new svg.Element.path,svg.Element.glyph=function(node){this.base=svg.Element.path,this.base(node),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.unicode=this.attribute("unicode").value,this.arabicForm=this.attribute("arabic-form").value},svg.Element.glyph.prototype=new svg.Element.path,svg.Element.text=function(node){if(this.base=svg.Element.RenderedElementBase,this.base(node),null!=node){this.children=[];for(var i=0;i<node.childNodes.length;i++){var childNode=node.childNodes[i];1==childNode.nodeType?this.addChild(childNode,!0):3==childNode.nodeType&&this.addChild(new svg.Element.tspan(childNode),!1)}}this.baseSetContext=this.setContext,this.setContext=function(ctx){this.baseSetContext(ctx),this.style("dominant-baseline").hasValue()&&(ctx.textBaseline=this.style("dominant-baseline").value),this.style("alignment-baseline").hasValue()&&(ctx.textBaseline=this.style("alignment-baseline").value)},this.renderChildren=function(ctx){for(var textAnchor=this.style("text-anchor").valueOrDefault("start"),x=this.attribute("x").toPixels("x"),y=this.attribute("y").toPixels("y"),i=0;i<this.children.length;i++){var child=this.children[i];child.attribute("x").hasValue()?child.x=child.attribute("x").toPixels("x"):(this.attribute("dx").hasValue()&&(y+=this.attribute("dx").toPixels("x")),child.attribute("dx").hasValue()&&(x+=child.attribute("dx").toPixels("x")),child.x=x);var childLength=child.measureText(ctx);if("start"!=textAnchor&&(0==i||child.attribute("x").hasValue())){for(var groupLength=childLength,j=i+1;j<this.children.length;j++){var childInGroup=this.children[j];if(childInGroup.attribute("x").hasValue())break;groupLength+=childInGroup.measureText(ctx)}child.x-="end"==textAnchor?groupLength:groupLength/2}x=child.x+childLength,child.attribute("y").hasValue()?child.y=child.attribute("y").toPixels("y"):(this.attribute("dy").hasValue()&&(y+=this.attribute("dy").toPixels("y")),child.attribute("dy").hasValue()&&(y+=child.attribute("dy").toPixels("y")),child.y=y),y=child.y,child.render(ctx)}}},svg.Element.text.prototype=new svg.Element.RenderedElementBase,svg.Element.TextElementBase=function(node){this.base=svg.Element.RenderedElementBase,this.base(node),this.getGlyph=function(font,text,i){var c=text[i],glyph=null;if(font.isArabic){var arabicForm="isolated";(0==i||" "==text[i-1])&&i<text.length-2&&" "!=text[i+1]&&(arabicForm="terminal"),i>0&&" "!=text[i-1]&&i<text.length-2&&" "!=text[i+1]&&(arabicForm="medial"),i>0&&" "!=text[i-1]&&(i==text.length-1||" "==text[i+1])&&(arabicForm="initial"),"undefined"!=typeof font.glyphs[c]&&(glyph=font.glyphs[c][arabicForm],null==glyph&&"glyph"==font.glyphs[c].type&&(glyph=font.glyphs[c]))}else glyph=font.glyphs[c];return null==glyph&&(glyph=font.missingGlyph),glyph},this.renderChildren=function(ctx){var customFont=this.parent.style("font-family").getDefinition();if(null==customFont)""!=ctx.strokeStyle&&ctx.strokeText(svg.compressSpaces(this.getText()),this.x,this.y),""!=ctx.fillStyle&&ctx.fillText(svg.compressSpaces(this.getText()),this.x,this.y);else{var fontSize=this.parent.style("font-size").numValueOrDefault(svg.Font.Parse(svg.ctx.font).fontSize),fontStyle=this.parent.style("font-style").valueOrDefault(svg.Font.Parse(svg.ctx.font).fontStyle),text=this.getText();customFont.isRTL&&(text=text.split("").reverse().join(""));for(var dx=svg.ToNumberArray(this.parent.attribute("dx").value),i=0;i<text.length;i++){var glyph=this.getGlyph(customFont,text,i),scale=fontSize/customFont.fontFace.unitsPerEm;ctx.translate(this.x,this.y),ctx.scale(scale,-scale);var lw=ctx.lineWidth;ctx.lineWidth=ctx.lineWidth*customFont.fontFace.unitsPerEm/fontSize,"italic"==fontStyle&&ctx.transform(1,0,.4,1,0,0),glyph.render(ctx),"italic"==fontStyle&&ctx.transform(1,0,-.4,1,0,0),ctx.lineWidth=lw,ctx.scale(1/scale,-1/scale),ctx.translate(-this.x,-this.y),this.x+=fontSize*(glyph.horizAdvX||customFont.horizAdvX)/customFont.fontFace.unitsPerEm,"undefined"==typeof dx[i]||isNaN(dx[i])||(this.x+=dx[i])}}},this.getText=function(){},this.measureText=function(ctx){var customFont=this.parent.style("font-family").getDefinition();if(null!=customFont){var fontSize=this.parent.style("font-size").numValueOrDefault(svg.Font.Parse(svg.ctx.font).fontSize),measure=0,text=this.getText();customFont.isRTL&&(text=text.split("").reverse().join(""));for(var dx=svg.ToNumberArray(this.parent.attribute("dx").value),i=0;i<text.length;i++){var glyph=this.getGlyph(customFont,text,i);measure+=(glyph.horizAdvX||customFont.horizAdvX)*fontSize/customFont.fontFace.unitsPerEm,"undefined"==typeof dx[i]||isNaN(dx[i])||(measure+=dx[i])}return measure}var textToMeasure=svg.compressSpaces(this.getText());if(!ctx.measureText)return 10*textToMeasure.length;ctx.save(),this.setContext(ctx);var width=ctx.measureText(textToMeasure).width;return ctx.restore(),width}},svg.Element.TextElementBase.prototype=new svg.Element.RenderedElementBase,svg.Element.tspan=function(node){this.base=svg.Element.TextElementBase,this.base(node),this.text=3==node.nodeType?node.nodeValue:node.childNodes.length>0?node.childNodes[0].nodeValue:node.text,this.getText=function(){return this.text}},svg.Element.tspan.prototype=new svg.Element.TextElementBase,svg.Element.tref=function(node){this.base=svg.Element.TextElementBase,this.base(node),this.getText=function(){var element=this.attribute("xlink:href").getDefinition();return null!=element?element.children[0].getText():void 0}},svg.Element.tref.prototype=new svg.Element.TextElementBase,svg.Element.a=function(node){this.base=svg.Element.TextElementBase,this.base(node),this.hasText=!0;for(var i=0;i<node.childNodes.length;i++)3!=node.childNodes[i].nodeType&&(this.hasText=!1);this.text=this.hasText?node.childNodes[0].nodeValue:"",this.getText=function(){return this.text},this.baseRenderChildren=this.renderChildren,this.renderChildren=function(ctx){if(this.hasText){this.baseRenderChildren(ctx);var fontSize=new svg.Property("fontSize",svg.Font.Parse(svg.ctx.font).fontSize);svg.Mouse.checkBoundingBox(this,new svg.BoundingBox(this.x,this.y-fontSize.toPixels("y"),this.x+this.measureText(ctx),this.y))}else{var g=new svg.Element.g;g.children=this.children,g.parent=this,g.render(ctx)}},this.onclick=function(){window.open(this.attribute("xlink:href").value)},this.onmousemove=function(){svg.ctx.canvas.style.cursor="pointer"}},svg.Element.a.prototype=new svg.Element.TextElementBase,svg.Element.image=function(node){this.base=svg.Element.RenderedElementBase,this.base(node);var href=this.attribute("xlink:href").value,isSvg=href.match(/\.svg$/);if(svg.Images.push(this),this.loaded=!1,isSvg)this.img=svg.ajax(href),this.loaded=!0;else{this.img=document.createElement("img");var self=this;this.img.onload=function(){self.loaded=!0},this.img.onerror=function(){console&&console.log('ERROR: image "'+href+'" not found'),self.loaded=!0},this.img.src=href}this.renderChildren=function(ctx){var x=this.attribute("x").toPixels("x"),y=this.attribute("y").toPixels("y"),width=this.attribute("width").toPixels("x"),height=this.attribute("height").toPixels("y");0!=width&&0!=height&&(ctx.save(),isSvg?ctx.drawSvg(this.img,x,y,width,height):(ctx.translate(x,y),svg.AspectRatio(ctx,this.attribute("preserveAspectRatio").value,width,this.img.width,height,this.img.height,0,0),ctx.drawImage(this.img,0,0)),ctx.restore())}},svg.Element.image.prototype=new svg.Element.RenderedElementBase,svg.Element.g=function(node){this.base=svg.Element.RenderedElementBase,this.base(node),this.getBoundingBox=function(){for(var bb=new svg.BoundingBox,i=0;i<this.children.length;i++)bb.addBoundingBox(this.children[i].getBoundingBox());return bb}},svg.Element.g.prototype=new svg.Element.RenderedElementBase,svg.Element.symbol=function(node){this.base=svg.Element.RenderedElementBase,this.base(node),this.baseSetContext=this.setContext,this.setContext=function(ctx){if(this.baseSetContext(ctx),this.attribute("viewBox").hasValue()){var viewBox=svg.ToNumberArray(this.attribute("viewBox").value),minX=viewBox[0],minY=viewBox[1];width=viewBox[2],height=viewBox[3],svg.AspectRatio(ctx,this.attribute("preserveAspectRatio").value,this.attribute("width").toPixels("x"),width,this.attribute("height").toPixels("y"),height,minX,minY),svg.ViewPort.SetCurrent(viewBox[2],viewBox[3])}}},svg.Element.symbol.prototype=new svg.Element.RenderedElementBase,svg.Element.style=function(node){this.base=svg.Element.ElementBase,this.base(node);var css=node.childNodes[0].nodeValue+(node.childNodes.length>1?node.childNodes[1].nodeValue:"");css=css.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,""),css=svg.compressSpaces(css);for(var cssDefs=css.split("}"),i=0;i<cssDefs.length;i++)if(""!=svg.trim(cssDefs[i]))for(var cssDef=cssDefs[i].split("{"),cssClasses=cssDef[0].split(","),cssProps=cssDef[1].split(";"),j=0;j<cssClasses.length;j++){var cssClass=svg.trim(cssClasses[j]);if(""!=cssClass){for(var props={},k=0;k<cssProps.length;k++){var prop=cssProps[k].indexOf(":"),name=cssProps[k].substr(0,prop),value=cssProps[k].substr(prop+1,cssProps[k].length-prop);null!=name&&null!=value&&(props[svg.trim(name)]=new svg.Property(svg.trim(name),svg.trim(value)))}if(svg.Styles[cssClass]=props,"@font-face"==cssClass)for(var fontFamily=props["font-family"].value.replace(/"/g,""),srcs=props.src.value.split(","),s=0;s<srcs.length;s++)if(srcs[s].indexOf('format("svg")')>0)for(var urlStart=srcs[s].indexOf("url"),urlEnd=srcs[s].indexOf(")",urlStart),url=srcs[s].substr(urlStart+5,urlEnd-urlStart-6),doc=svg.parseXml(svg.ajax(url)),fonts=doc.getElementsByTagName("font"),f=0;f<fonts.length;f++){var font=svg.CreateElement(fonts[f]);svg.Definitions[fontFamily]=font}}}},svg.Element.style.prototype=new svg.Element.ElementBase,svg.Element.use=function(node){this.base=svg.Element.RenderedElementBase,this.base(node),this.baseSetContext=this.setContext,this.setContext=function(ctx){this.baseSetContext(ctx),this.attribute("x").hasValue()&&ctx.translate(this.attribute("x").toPixels("x"),0),this.attribute("y").hasValue()&&ctx.translate(0,this.attribute("y").toPixels("y"))},this.getDefinition=function(){var element=this.attribute("xlink:href").getDefinition();return this.attribute("width").hasValue()&&(element.attribute("width",!0).value=this.attribute("width").value),this.attribute("height").hasValue()&&(element.attribute("height",!0).value=this.attribute("height").value),element},this.path=function(ctx){var element=this.getDefinition();null!=element&&element.path(ctx)},this.renderChildren=function(ctx){var element=this.getDefinition();if(null!=element){var oldParent=element.parent;element.parent=null,element.render(ctx),element.parent=oldParent}}},svg.Element.use.prototype=new svg.Element.RenderedElementBase,svg.Element.mask=function(node){this.base=svg.Element.ElementBase,this.base(node),this.apply=function(ctx,element){var x=this.attribute("x").toPixels("x"),y=this.attribute("y").toPixels("y"),width=this.attribute("width").toPixels("x"),height=this.attribute("height").toPixels("y"),mask=element.attribute("mask").value;element.attribute("mask").value="";var cMask=document.createElement("canvas");cMask.width=x+width,cMask.height=y+height;var maskCtx=cMask.getContext("2d");this.renderChildren(maskCtx);var c=document.createElement("canvas");c.width=x+width,c.height=y+height;var tempCtx=c.getContext("2d");element.render(tempCtx),tempCtx.globalCompositeOperation="destination-in",tempCtx.fillStyle=maskCtx.createPattern(cMask,"no-repeat"),tempCtx.fillRect(0,0,x+width,y+height),ctx.fillStyle=tempCtx.createPattern(c,"no-repeat"),ctx.fillRect(0,0,x+width,y+height),element.attribute("mask").value=mask},this.render=function(){}},svg.Element.mask.prototype=new svg.Element.ElementBase,svg.Element.clipPath=function(node){this.base=svg.Element.ElementBase,this.base(node),this.apply=function(ctx){for(var i=0;i<this.children.length;i++)this.children[i].path&&(this.children[i].path(ctx),ctx.clip())},this.render=function(){}},svg.Element.clipPath.prototype=new svg.Element.ElementBase,svg.Element.filter=function(node){this.base=svg.Element.ElementBase,this.base(node),this.apply=function(ctx,element){var bb=element.getBoundingBox(),x=this.attribute("x").toPixels("x"),y=this.attribute("y").toPixels("y");(0==x||0==y)&&(x=bb.x1,y=bb.y1);var width=this.attribute("width").toPixels("x"),height=this.attribute("height").toPixels("y");(0==width||0==height)&&(width=bb.width(),height=bb.height());var filter=element.style("filter").value;element.style("filter").value="";var extraPercent=.2,px=extraPercent*width,py=extraPercent*height,c=document.createElement("canvas");c.width=width+2*px,c.height=height+2*py;var tempCtx=c.getContext("2d");tempCtx.translate(-x+px,-y+py),element.render(tempCtx);for(var i=0;i<this.children.length;i++)this.children[i].apply(tempCtx,0,0,width+2*px,height+2*py);ctx.drawImage(c,0,0,width+2*px,height+2*py,x-px,y-py,width+2*px,height+2*py),element.style("filter",!0).value=filter},this.render=function(){}},svg.Element.filter.prototype=new svg.Element.ElementBase,svg.Element.feGaussianBlur=function(node){function make_fgauss(sigma){sigma=Math.max(sigma,.01);var len=Math.ceil(4*sigma)+1;mask=[];for(var i=0;len>i;i++)mask[i]=Math.exp(-.5*(i/sigma)*(i/sigma));return mask}function normalize(mask){for(var sum=0,i=1;i<mask.length;i++)sum+=Math.abs(mask[i]);sum=2*sum+Math.abs(mask[0]);for(var i=0;i<mask.length;i++)mask[i]/=sum;return mask}function convolve_even(src,dst,mask,width,height){for(var y=0;height>y;y++)for(var x=0;width>x;x++)for(var a=imGet(src,x,y,width,height,3)/255,rgba=0;4>rgba;rgba++){for(var sum=mask[0]*(0==a?255:imGet(src,x,y,width,height,rgba))*(0==a||3==rgba?1:a),i=1;i<mask.length;i++){var a1=imGet(src,Math.max(x-i,0),y,width,height,3)/255,a2=imGet(src,Math.min(x+i,width-1),y,width,height,3)/255;sum+=mask[i]*((0==a1?255:imGet(src,Math.max(x-i,0),y,width,height,rgba))*(0==a1||3==rgba?1:a1)+(0==a2?255:imGet(src,Math.min(x+i,width-1),y,width,height,rgba))*(0==a2||3==rgba?1:a2))}imSet(dst,y,x,height,width,rgba,sum)}}function imGet(img,x,y,width,height,rgba){return img[y*width*4+4*x+rgba]}function imSet(img,x,y,width,height,rgba,val){img[y*width*4+4*x+rgba]=val}function blur(ctx,width,height,sigma){var srcData=ctx.getImageData(0,0,width,height),mask=make_fgauss(sigma);mask=normalize(mask),tmp=[],convolve_even(srcData.data,tmp,mask,width,height),convolve_even(tmp,srcData.data,mask,height,width),ctx.clearRect(0,0,width,height),ctx.putImageData(srcData,0,0)}this.base=svg.Element.ElementBase,this.base(node),this.apply=function(ctx,x,y,width,height){blur(ctx,width,height,this.attribute("stdDeviation").numValue())}},svg.Element.filter.prototype=new svg.Element.feGaussianBlur,svg.Element.title=function(){},svg.Element.title.prototype=new svg.Element.ElementBase,svg.Element.desc=function(){},svg.Element.desc.prototype=new svg.Element.ElementBase,svg.Element.MISSING=function(node){console&&console.log("ERROR: Element '"+node.nodeName+"' not yet implemented.")},svg.Element.MISSING.prototype=new svg.Element.ElementBase,svg.CreateElement=function(node){var className=node.nodeName.replace(/^[^:]+:/,"");className=className.replace(/\-/g,"");var e=null;return e="undefined"!=typeof svg.Element[className]?new svg.Element[className](node):new svg.Element.MISSING(node),e.type=node.nodeName,e},svg.load=function(ctx,url){svg.loadXml(ctx,svg.ajax(url))},svg.loadXml=function(ctx,xml){svg.loadXmlDoc(ctx,svg.parseXml(xml))},svg.loadXmlDoc=function(ctx,dom){svg.init(ctx);var mapXY=function(p){for(var e=ctx.canvas;e;)p.x-=e.offsetLeft,p.y-=e.offsetTop,e=e.offsetParent;return window.scrollX&&(p.x+=window.scrollX),window.scrollY&&(p.y+=window.scrollY),p};1!=svg.opts.ignoreMouse&&(ctx.canvas.onclick=function(e){var p=mapXY(new svg.Point(null!=e?e.clientX:event.clientX,null!=e?e.clientY:event.clientY));svg.Mouse.onclick(p.x,p.y)},ctx.canvas.onmousemove=function(e){var p=mapXY(new svg.Point(null!=e?e.clientX:event.clientX,null!=e?e.clientY:event.clientY));svg.Mouse.onmousemove(p.x,p.y)});var e=svg.CreateElement(dom.documentElement);e.root=!0;var isFirstRender=!0,draw=function(){svg.ViewPort.Clear(),ctx.canvas.parentNode&&svg.ViewPort.SetCurrent(ctx.canvas.parentNode.clientWidth,ctx.canvas.parentNode.clientHeight),1!=svg.opts.ignoreDimensions&&(e.style("width").hasValue()&&(ctx.canvas.width=e.style("width").toPixels("x"),ctx.canvas.style.width=ctx.canvas.width+"px"),e.style("height").hasValue()&&(ctx.canvas.height=e.style("height").toPixels("y"),ctx.canvas.style.height=ctx.canvas.height+"px"));var cWidth=ctx.canvas.clientWidth||ctx.canvas.width,cHeight=ctx.canvas.clientHeight||ctx.canvas.height;if(1==svg.opts.ignoreDimensions&&e.style("width").hasValue()&&e.style("height").hasValue()&&(cWidth=e.style("width").toPixels("x"),cHeight=e.style("height").toPixels("y")),svg.ViewPort.SetCurrent(cWidth,cHeight),null!=svg.opts.offsetX&&(e.attribute("x",!0).value=svg.opts.offsetX),null!=svg.opts.offsetY&&(e.attribute("y",!0).value=svg.opts.offsetY),null!=svg.opts.scaleWidth&&null!=svg.opts.scaleHeight){var xRatio=1,yRatio=1,viewBox=svg.ToNumberArray(e.attribute("viewBox").value);e.attribute("width").hasValue()?xRatio=e.attribute("width").toPixels("x")/svg.opts.scaleWidth:isNaN(viewBox[2])||(xRatio=viewBox[2]/svg.opts.scaleWidth),e.attribute("height").hasValue()?yRatio=e.attribute("height").toPixels("y")/svg.opts.scaleHeight:isNaN(viewBox[3])||(yRatio=viewBox[3]/svg.opts.scaleHeight),e.attribute("width",!0).value=svg.opts.scaleWidth,e.attribute("height",!0).value=svg.opts.scaleHeight,e.attribute("viewBox",!0).value="0 0 "+cWidth*xRatio+" "+cHeight*yRatio,e.attribute("preserveAspectRatio",!0).value="none"}1!=svg.opts.ignoreClear&&ctx.clearRect(0,0,cWidth,cHeight),e.render(ctx),isFirstRender&&(isFirstRender=!1,"function"==typeof svg.opts.renderCallback&&svg.opts.renderCallback())},waitingForImages=!0;svg.ImagesLoaded()&&(waitingForImages=!1,draw()),svg.intervalID=setInterval(function(){var needUpdate=!1;if(waitingForImages&&svg.ImagesLoaded()&&(waitingForImages=!1,needUpdate=!0),1!=svg.opts.ignoreMouse&&(needUpdate|=svg.Mouse.hasEvents()),1!=svg.opts.ignoreAnimation)for(var i=0;i<svg.Animations.length;i++)needUpdate|=svg.Animations[i].update(1e3/svg.FRAMERATE);"function"==typeof svg.opts.forceRedraw&&1==svg.opts.forceRedraw()&&(needUpdate=!0),needUpdate&&(draw(),svg.Mouse.runEvents())},1e3/svg.FRAMERATE)},svg.stop=function(){svg.intervalID&&clearInterval(svg.intervalID)},svg.Mouse=new function(){this.events=[],this.hasEvents=function(){return 0!=this.events.length},this.onclick=function(x,y){this.events.push({type:"onclick",x:x,y:y,run:function(e){e.onclick&&e.onclick()}})},this.onmousemove=function(x,y){this.events.push({type:"onmousemove",x:x,y:y,run:function(e){e.onmousemove&&e.onmousemove()}})},this.eventElements=[],this.checkPath=function(element,ctx){for(var i=0;i<this.events.length;i++){var e=this.events[i];ctx.isPointInPath&&ctx.isPointInPath(e.x,e.y)&&(this.eventElements[i]=element)}},this.checkBoundingBox=function(element,bb){for(var i=0;i<this.events.length;i++){var e=this.events[i];bb.isPointInBox(e.x,e.y)&&(this.eventElements[i]=element)}},this.runEvents=function(){svg.ctx.canvas.style.cursor="";for(var i=0;i<this.events.length;i++)for(var e=this.events[i],element=this.eventElements[i];element;)e.run(element),element=element.parent;this.events=[],this.eventElements=[]}},svg}this.canvg=function(target,s,opts){if(null!=target||null!=s||null!=opts){opts=opts||{},"string"==typeof target&&(target=document.getElementById(target)),null!=target.svg&&target.svg.stop(),target.svg=svg=build(),svg.opts=opts;var ctx=target.getContext("2d");"undefined"!=typeof s.documentElement?svg.loadXmlDoc(ctx,s):"<"==s.substr(0,1)?svg.loadXml(ctx,s):svg.load(ctx,s)}else for(var svgTags=document.getElementsByTagName("svg"),i=0;i<svgTags.length;i++){var svgTag=svgTags[i],c=document.createElement("canvas");c.width=svgTag.clientWidth,c.height=svgTag.clientHeight,svgTag.parentNode.insertBefore(c,svgTag),svgTag.parentNode.removeChild(svgTag);var div=document.createElement("div");div.appendChild(svgTag),canvg(c,div.innerHTML)}}}(),CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.drawSvg=function(s,dx,dy,dw,dh){canvg(this.canvas,s,{ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:dx,offsetY:dy,scaleWidth:dw,scaleHeight:dh})});var svgenie=function(){"use strict";function _pretendClick(eElement){var oEvent=document.createEvent("MouseEvents");return oEvent.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),eElement.dispatchEvent(oEvent)}var _serializeXmlNode=function(xmlNode){return"undefined"!=typeof window.XMLSerializer?(new window.XMLSerializer).serializeToString(xmlNode):"undefined"!=typeof xmlNode.xml?xmlNode.xml:""},_toCanvas=function(svg,options,callback){"string"==typeof svg&&("#"==svg.substr(0,1)&&(svg=svg.substr(1)),svg=document.getElementById(svg));var canvas=document.createElement("canvas");canvas.setAttribute("height",svg.offsetHeight),canvas.setAttribute("width",svg.offsetWidth),canvg(canvas,_serializeXmlNode(svg),{ignoreMouse:!0,ignoreAnimation:!0,renderCallback:function(){callback(canvas)}})},_toDataURL=function(id,options,callback){_toCanvas(id,options,function(canvas){callback(canvas.toDataURL("image/png"),canvas)})},_save=function(id,options){_toDataURL(id,options,function(data,canvas){_saveToFile({data:data,canvas:canvas,name:options.name||"image.png"})})},_saveToFile=function(conf){var a=document.createElement("a");return null!=a.download?(a.href=conf.data,a.download=conf.name,void _pretendClick(a)):window.navigator.msSaveBlob?void conf.canvas.toBlob(function(blobby){window.navigator.msSaveBlob&&window.navigator.msSaveBlob(blobby,conf.name)},"image/png"):void 0};return{save:_save,toCanvas:_toCanvas,toDataURL:_toDataURL}}();!function(){angular.module("CIC",[]).factory("spanel",function(){return{}}).factory("FeedService",["$http",function($http){return{parseFeed:function(url){return $http.jsonp("//ajax.googleapis.com/ajax/services/feed/load?v=1.0&num=4&callback=JSON_CALLBACK&q="+encodeURIComponent(url))}}}]).controller("MenuController",["spanel",function(spanel){this.accessMoreData=function(){spanel.toggleShowing("accessMoreData")}}]).controller("PanelController",["$scope","spanel",function($scope,spanel){var panel=$scope.panel;panel.NUM_HELP_TABS=6,panel.visible=!0,panel.showOnMapVisible=!1,panel.printVisible=!1,panel.currentText=$(window).width()>768?"update":"help",panel.currentHelpTab=$(window).width()>768?1:3,panel.setVisible=function(vis){panel.visible=vis},panel.isShowing=function(textId){return panel.currentText===textId},panel.toggleShowing=function(newTextId){panel.currentText===newTextId?panel.setVisible(!panel.visible):(panel.setVisible(!0),panel.currentText=newTextId),$("#stateSearchToggle").hide()},panel.selectHelpTab=function(newTab){newTab>0&&newTab<=panel.NUM_HELP_TABS&&(panel.currentHelpTab=newTab)},panel.incrementHelpTab=function(incr){var newTabNum=panel.currentHelpTab+incr;newTabNum>0&&newTabNum<=panel.NUM_HELP_TABS&&(panel.currentHelpTab+=incr)},panel.isHelpSelected=function(tab){return panel.currentHelpTab===tab},panel.goToIndicator=function(dataset,indicator){CIC.findACounty=!1,indicator=indicator.replace("","'"),panel.setVisible(!1),CIC.update(dataset,indicator),ga("send","event","map a new indicator",dataset,indicator)},spanel.toggleShowing=panel.toggleShowing}]).controller("MainController",function(){}).controller("FeedCtrl",["$scope","FeedService",function($scope,Feed){$scope.feedSrc="http://www.naco.org/rss.xml",$scope.loadFeed=function(f){Feed.parseFeed(f).then(function(res){$scope.feeds=res.data.responseData.feed.entries;for(var i=0;i<$scope.feeds.length;i++){var beginning=$scope.feeds[i].content.indexOf('src="')+5;$scope.feeds[i].img=$scope.feeds[i].content.substr(beginning,$scope.feeds[i].content.indexOf('"',beginning)-beginning),-1!=$scope.feeds[i].img.indexOf("<")&&($scope.feeds[i].img="http://www.naco.org/sites/default/files/styles/medium/public/default_images/default-field-image_0.png?itok=2RfHkd95")}})},$scope.loadFeed($scope.feedSrc)}]).directive("indicatorList",function(){return{restrict:"A",templateUrl:"assets/indicatorList.html",controller:function($scope){$scope.indicatorListType="curated"},link:function(scope,elem){var menu=$(elem).closest(".nav");menu.smartmenus({subMenusSubOffsetX:1,subMenusSubOffsetY:-8}),menu.find(".sub-arrow").first().hide()}}}).directive("profileList",function(){return{restrict:"A",templateUrl:"assets/profileList.html",link:function(scope,elem){var menu=$(elem).closest(".nav");menu.smartmenus({subMenusSubOffsetX:1,subMenusSubOffsetY:-8}),menu.find(".sub-arrow").first().hide()}}}).directive("overlay",function(){return{restrict:"E",templateUrl:"assets/overlay.html"}}).directive("mailingForm",function(){return{restrict:"E",templateUrl:"assets/mailingForm.html"}}).directive("stateList",function(){return{restrict:"A",templateUrl:"assets/stateList.html"}}).directive("socialButtons",function(){return{restrict:"A",templateUrl:"assets/socialButtons.html"}}).directive("notes",function(){return{restrict:"A",templateUrl:"assets/notes.html"}})}();var colorlegend=function(target,scale,type,options){for(var scaleTypes=["linear","quantile","ordinal"],found=!1,opts=options||{},dataType=opts.dataType||"level",boxWidth=opts.boxWidth||20,boxHeight=opts.boxHeight||20,title=opts.title||null,fill=opts.fill||!1,isNumeric=(opts.linearBoxes||9,"level"===dataType||"level_np"===dataType||"percent"===dataType),unit=opts.unit||"",longLegendNames=opts.longLegendNames||!1,suppressMinMax=opts.suppressMinMax||!1,overrideLegendMax=opts.overrideLegendMax||null,htmlElement=document.getElementById("#"===target.substring(0,1)?target.substring(1,target.length):target),w=htmlElement.offsetWidth,h=htmlElement.offsetHeight,colors=[],padding=[0,4,10,0],boxSpacing="ordinal"===type?3:0,titlePadding=title?22:0,boxLabelHeight=10,domain=scale.domain(),range=scale.range(),measure_type=opts.measure_type,small_large=opts.small_large||!1,format_type=opts.format_type||!1,format=opts.formatFnArr,i=0;i<scaleTypes.length;i++)if(scaleTypes[i]===type){found=!0;break}if(!found)throw new Error("Scale type, "+type+", is not supported.");"categorical"===dataType&&(boxWidth+=24);for(var i=0;i<range.length;i++)colors[i]=range[i];"quartile"===measure_type&&colors.unshift(level_colors[0]),(fill||w<(boxWidth+boxSpacing)*colors.length+padding[1]+padding[3])&&(boxWidth=(w-padding[1]-padding[3]-boxSpacing*colors.length)/colors.length),(fill||h<boxHeight+padding[0]+padding[2]+titlePadding)&&(boxHeight=h-padding[0]-padding[2]-titlePadding);var svg=d3.select(target).append("svg").attr("width",w).attr("height",h),legend=svg.append("g").attr("class","colorlegend").style("font-size",".76em").style("fill","#666");legend.reposition=function(){svg.attr("width",htmlElement.offsetWidth).attr("height",htmlElement.offsetHeight),legend.attr("transform","translate("+(padding[3]+htmlElement.offsetWidth/2-boxWidth*colors.length/2)+","+padding[0]+")")},legend.reposition();var dataValues=[];if(isNumeric)if("threshold"===measure_type){dataValues.push("level"===dataType?0:small_large[0]);for(var i=0;i<domain.length;i++)dataValues.push(domain[i]);dataValues.push(small_large[1]<=domain[domain.length-1]?domain[domain.length-1]+1:small_large[1])}else if("quartile"===measure_type){var quantiles=scale.quantiles();dataValues.push(0),dataValues.push("percent"===dataType?1e-5:1);for(var i=0;i<quantiles.length;i++)dataValues.push(quantiles[i]);dataValues.push(domain[domain.length-1])}else{var quantiles=scale.quantiles();dataValues.push("level"===dataType?0:domain[0]);for(var i=0;i<quantiles.length;i++)dataValues.push(quantiles[i]);dataValues.push(domain[domain.length-1])}else for(var j=0;j<colors.length;j++)for(var ind in options.keyArray)if(options.keyArray[ind]===j){dataValues.push(ind);break}if("string"==typeof dataValues[0])for(var k=0;k<dataValues.length;k++)"Low Skills Equilibrium"===dataValues[k]?dataValues[k]="Low Skills":"High Skills Equilibrium"===dataValues[k]&&(dataValues[k]="High Skills");"binary"===dataType&&(colors=[binary_colors[1],binary_colors[0]],dataValues=["Yes","No"]);var legendBoxes=legend.selectAll("g.legend").data(dataValues).enter().append("g");if(legendBoxes.append("rect").attr("width",boxWidth).attr("height",boxHeight).attr("x",function(d,i){return i*(boxWidth+boxSpacing)}).attr("y",boxLabelHeight).style("fill",function(d,i){return colors[i]}).style("display",function(d,i){return i>=colors.length?"none":void 0}),isNumeric&&"quintile"===measure_type&&legendBoxes.append("text").attr("class","colorlegend-boxlabels").attr("x",function(d,i){return i*(boxWidth+boxSpacing)+boxWidth/2}).attr("y",boxLabelHeight+13).style("text-anchor","middle").style("pointer-events","none").style("fill",function(d,i){return 0===i?"black":4===i?"white":void 0}).text(function(d,i){return 0===i?"bottom 20%":4===i?"top 20%":void 0}),longLegendNames){var dataValuesWrap=["","","",""];dataValuesWrap.wrapText=function(){for(var index=0;index<dataValues.length;index++){var value=dataValues[index],tempValue=value.split(" ");if(tempValue.length>2){if(dataValues[index]=tempValue[0]+" "+tempValue[1],dataValuesWrap[index]=tempValue[2],tempValue.length>3)for(j=3;j<tempValue.length;j++)dataValuesWrap[index]=dataValuesWrap[index]+" "+tempValue[j]}else dataValuesWrap[index]=""}},dataValuesWrap.wrapText()}return legendBoxes.append("text").attr("class","colorlegend-labels").attr("dy",".71em").attr("x",function(d,i){var leftAlignX=i*(boxWidth+boxSpacing);return isNumeric?leftAlignX:leftAlignX+boxWidth/2}).attr("y",boxLabelHeight+boxHeight+4).style("text-anchor",function(){return"ordinal"===type?"start":"middle"}).style("pointer-events","none").text(function(d,i){return"ordinal"===type?dataValues[i]:suppressMinMax&0==i||suppressMinMax&5==i?" ":null!==overrideLegendMax&5==i?overrideLegendMax:format_type===!1?format[dataType](dataValues[i],unit):format[format_type](dataValues[i],unit)}),longLegendNames&&legendBoxes.append("text").attr("class","colorlegend-labels").attr("dy","1.71em").attr("x",function(d,i){var leftAlignX=i*(boxWidth+boxSpacing);return isNumeric?leftAlignX:leftAlignX+boxWidth/2}).attr("y",boxLabelHeight+boxHeight+4).style("text-anchor",function(){return"ordinal"===type?"start":"middle"}).style("pointer-events","none").text(function(d,i){return"ordinal"===type?dataValuesWrap[i]:suppressMinMax&0==i||suppressMinMax&5==i?" ":format_type===!1?format[dataType](dataValuesWrap[i],unit):format[format_type](dataValuesWrap[i],unit)}),title&&legend.append("text").attr("class","colorlegend-title").attr("x",colors.length*(boxWidth/2)).attr("y",boxLabelHeight+boxHeight+titlePadding).attr("dy",".71em").style("text-anchor","middle").style("pointer-events","none").text(title),legend};$(document).ready(function(){$("div.call-to-action").appendTo("div.featured-docs")}),$.noty.defaults.layout="center",$.noty.defaults.killer=!0,$.noty.defaults.timeout=3e3,$.noty.defaults.closeWith=["click","button"],$.noty.defaults.template='<div class="noty_message"><div class="noty_text"></div><div class="noty_close"></div></div>';var na_color="rgb(204,204,204)",highlight_color="rgb(204,51,0)",percent_colors=["rgb(255,204,102)","rgb(255,153,51)","rgb(0,153,204)","rgb(0,102,153)","rgb(0,51,102)"],binary_colors=["rgb(0,51,102)","rgb(255,153,51)"],categorical_colors=["rgb(255,204,102)","rgb(255,153,51)","rgb(0,153,204)","rgb(0,102,153)","rgb(0,51,102)"],level_colors=["rgb(255,204,102)","rgb(255,153,51)","rgb(0,153,204)","rgb(0,102,153)","rgb(0,51,102)"],neighbor_colors=d3.scale.category10(),customColors=null;CIC={},function(){var localVersion=!1,default_dset="Payments in Lieu of Taxes (PILT)",default_ind="PILT Profiles";CIC.findACounty=!0,CIC.embed=!1,CIC.stateAssoc=$("#stateAssociationLogo").attr("stateAssoc");var stateMap={};switch(CIC.stateAssoc){case"FL":stateMap.translate=[-900,-800],stateMap.scale=4.5,stateMap.zoomExtent=3;
break;default:stateMap.translate=[0,0],stateMap.scale=1.2,stateMap.zoomExtent=10}window.location.search.indexOf("embed=true")>-1&&(CIC.embed=!0,-1==window.location.search.indexOf("fullSite=true")&&$("#header").hide(),$("#definitionsContainer").hide(),$("#notesContainer").hide(),$("#byline").hide(),$("#side-icon-container").hide(),$("#container").removeClass("container").addClass("container-fluid"),window.location.search.indexOf("external=true")>-1&&$("#external-logo").show());var topo,stateMesh,path,svg,g,CICstructure,legend,selected,frmrS,frmrT,stateImgHeight,zoom=d3.behavior.zoom().scaleExtent([1,stateMap.zoomExtent]),width=document.getElementById("container").offsetWidth,height=width/1.8,windowWidth=$(window).width(),windowHeight=$(window).height(),containerOffset=$("#container").offset(),tooltip=d3.select("#tt"),tipContainer=d3.select("#tipContainer"),currentDataType="",currentDI="",isPerCapita=!1,pop_db={},searchType="countySearch",searchState="State",measureType="quintile",corrDomain=[],range=[],quantByIds=[],indObjects=[],idByName={},countyObjectById={},countyPathById={},inTransition=!1,small_large_array=[],setup=function(width,height){var projection=d3.geo.albersUsa().translate(stateMap.translate).scale(width*stateMap.scale);path=d3.geo.path().projection(projection),svg=d3.select("#map").insert("svg","div").attr("width",width).attr("height",height).attr("id","map-svg").append("g").attr("transform","translate("+width/2+","+height/2+")").call(zoom).on("dblclick.zoom",null),g=svg.append("g").attr("class","counties"),$("#undermap").width(width),frmrS=1,frmrT=[0,0],zoom.scale(frmrS),zoom.translate(frmrT),zoom.on("zoom",function(){inTransition=!1,tooltip.classed("hidden",!0),unhighlight();var t=d3.event.translate,s=d3.event.scale;t[0]=Math.min(width/2*(s-1),Math.max(width/2*(1-s),t[0])),t[1]=Math.min(height/2*(s-1),Math.max(height/2*(1-s),t[1]));var zoomSmoothly=!(s===frmrS);zoomMap(t,s,zoomSmoothly)}),768>=windowWidth?$("#profileIndLi").hide():$("#profileIndLi").show(),zoomMap([0,0],1),positionZoomIcons(),positionInstruction()},draw=function(topo,stateMesh){var county=g.selectAll(".county").data(topo);county.enter().insert("path").attr("class","county").attr("d",path).attr("id",function(d){return d.id}).attr("state",function(d){return stateFipsMatch(d.properties.state)}),g.append("path").datum(stateMesh).attr("id","state-borders").attr("d",path);var mdownTime=-1;county.on("mousedown",function(){mdownTime=$.now()});var clicked=function(d,event){if(highlight(d),hideInstructions(),d3.select(".county.active").empty()!==!0){inTransition=!0;var transition=CIC.executeSearchMatch(event.target.id);transition===!1?inTransition=!1:transition.each("end.bool",function(){inTransition=!1})}};$("html").hasClass("no-touch")?(county.each(function(d){d.clickCount=0}),county.on("click",function(d){if($.now()-mdownTime<300){d3.event.stopPropagation();var event=d3.event;d.clickCount++,1===d.clickCount?singleClickTimer=setTimeout(function(){d.clickCount=0,inTransition||clicked(d,event)},300):2===d.clickCount&&(clearTimeout(singleClickTimer),d.clickCount=0,highlight(d),doubleClicked(d.id))}})):(county.on("click",function(d){$.now()-mdownTime<300&&(d3.event.stopPropagation(),inTransition||clicked(d,d3.event))}),$(".county").addSwipeEvents().bind("doubletap",function(event){event.stopPropagation(),inTransition=!1,doubleClicked(event.target.id)}))},setBehaviors=function(){d3.select("#map").on("click",unhighlight),d3.select("#print").on("click",function(){var window_title="";null!==selected?(window_title=countyObjectById[selected.id].geography.split(",")[0],window_title+=" Information, NACo Research"):window_title="County Information, NACo Research";var specWindow=window.open("",window_title,"left=0,top=0,toolbar=0,scrollbars=0,status=0");specWindow.document.write(document.getElementById("instruction-content").innerHTML),specWindow.document.write('<link rel="stylesheet" media="print" href="css/main.css">'),specWindow.document.close(),specWindow.focus(),specWindow.print(),specWindow.close()}),setDisabled(),setDropdownBehavior(),setSearchBehavior(),setIconBehavior(),setZoomIconBehavior(),setDataButtonBehavior()},setIconBehavior=function(){$("#stateSearchToggle").hide(),$("#backToMapIcon, #backToMapIconText").on("click",function(e){e.stopPropagation(),tooltip.classed("hidden",!0),unhighlight(),zoomMap([0,0],1),CIC.findACounty=!0}),$(".share-toggle").on("click",function(e){e.stopPropagation();var twitterContentIntro="http://twitter.com/home?status=See%20",twitterContentEnd="%20data%20for%20your%20county%20by%20@NACoTweets%20%23CountyExplorer%20www.naco.org%2FCountyExplorer",i=currentDI.indexOf(" | "),twitterContentDataset=encodeURIComponent(currentDI.substring(0,i));if($(".rrssb-buttons").is(":visible")){var moveTransition=d3.select("#rrssbContainer").transition().duration(500).style("right","-200px");moveTransition.each("end",function(){$(".rrssb-buttons").hide()})}else $(".rrssb-buttons").show(),d3.select("#twitterContent").attr("href",twitterContentIntro+twitterContentDataset+twitterContentEnd),d3.select("#rrssbContainer").transition().duration(500).style("right","0px")})},setDataButtonBehavior=function(){$("#perCapitaButton").on("click",function(){if(!$(this).hasClass("disabled")){if(NProgress.start(),$(this).button("toggle"),$(this).hasClass("active")){pop_db.currentIndicator=indObjects[0].name,pop_db.thresholds=[],pop_db.replaceThresholds=!1,pop_db.personPerUnit=!1,indObjects[0].hasOwnProperty("thresholds")&&(pop_db.replaceThreshold=!0,pop_db.thresholds=indObjects[0].thresholds,delete indObjects[0].thresholds,console.log(pop_db),console.log(indObjects[0])),isPerCapita=!0;var year=indObjects[0].year,updateQuants=function(){for(var i=0;i<quantByIds[0].length;i++)quantByIds[0][i]&&(quantByIds[0][i]/=pop_db[year][i])};if(pop_db.hasOwnProperty(year))updateQuants(),updateView();else if(pop_db[year]={},localVersion)d3.tsv("data/local_data.tsv",function(error,countyData){for(var i=0;i<countyData.length;i++)pop_db[year][countyData[i].id]=+countyData[i]["Population Levels and Trends - Population Level"];updateQuants(),updateView()});else{var query_str="db_set=Demographics&db_ind=Pop_LT_Population&db_year="+year;d3.xhr("/ciccfm/indicators.cfm?"+query_str,function(error,request){try{var responseObj=jQuery.parseJSON(request.responseText),population=responseObj.DATA.POP_LT_POPULATION}catch(error){noty({text:"Error retrieving population for"+year+"from database."}),NProgress.done(!0)}0===responseObj.ROWCOUNT&&noty({text:"Population data for "+year+" is not available"});for(var i=0;i<population.length;i++)pop_db[year][+responseObj.DATA.FIPS[i]]=+population[i];updateQuants(),updateView()})}}else{pop_db.replaceThresholds&&indObjects[0]===pop_db.currentIndicator&&(indObjects[0].thresholds=pop_db.thresholds,pop_db.replaceThresholds=!1),isPerCapita=!1,this.blur(),updateView();var k=currentDI.indexOf(" | ");CIC.update(currentDI.substring(0,k),currentDI.substring(k+3,currentDI.length))}NProgress.done()}}),$("#quantileButton").on("click",function(){$("#thresholdButton").hasClass("active")&&(NProgress.start(),$(this).button("toggle"),$("#thresholdButton").button("toggle"),$("#thresholdInputContainer").hide(),updateView(),NProgress.done())}),$("#thresholdButton").on("click",function(){$("#quantileButton").hasClass("active")&&(NProgress.start(),$("#quantileButton").button("toggle"),$(this).button("toggle"),small_large_array=switchToThreshold(color.domain(),color.range()),fillMapColors(),legend=createLegend("threshold",null,small_large_array),showThresholdInputs(),NProgress.done())}),$("#thresholdSubmit").on("click",function(){NProgress.start();for(var tvs=[],i=1;4>=i;i++)tvs.push(+$("#thresholdInput"+i).val());for(var i=1;i<tvs.length;i++)if(tvs[i]<=tvs[i-1])return void noty({text:"Invalid threshold values. Please try again."});return tvs[0]<=small_large_array[0]||tvs[3]>=small_large_array[1]?void noty({text:"Invalid threshold values. Please try again."}):(color.domain(tvs),legend=createLegend("threshold",null,small_large_array),fillMapColors(),void NProgress.done())})},setDisabled=function(){$(".dataset.disabled").find(".indicator").parent().addClass("disabled"),$(".category.disabled").find(".dataset").addClass("disabled"),$(".category.disabled").find(".indicator").parent().addClass("disabled")},setDropdownBehavior=function(){var pickedIndicator=function(dataset,indicator){$.SmartMenus.hideAll(),hideInstructions(),currentDI===dataset+" | "+indicator||(CIC.update(dataset,indicator),ga("send","event","map an indicator",dataset,indicator))},pickedCountyProfile=function(dataset,indicator){$.SmartMenus.hideAll(),hideInstructions(),currentDI===dataset+" | "+indicator||(CIC.update(dataset,indicator),ga("send","event","County Profiles",dataset,indicator))},setDropdownClick=function(menuId,endFunction){d3.select(menuId).selectAll(".dataset").each(function(){var dataset=d3.select(this),datasetName=dataset.attr("name");$(".more-less").bind("click.smapi",function(){return!1}),dataset.selectAll("li").on("click",function(){if(CIC.findACounty=!1,d3.select(this).classed("disabled"))d3.event.stopPropagation(),$.SmartMenus.hideAll();else{var indicatorName=d3.select(this).select(".indicator").attr("name");endFunction(datasetName,indicatorName,this.innerHTML)}})})};setDropdownClick("#primeInd",pickedIndicator),setDropdownClick("#profileInd",pickedCountyProfile),d3.selectAll(".dataset a").style("cursor","pointer"),d3.selectAll(".dataset.disabled a:first-child").style("cursor","default"),d3.selectAll(".dataset").selectAll("li .disabled").selectAll(".indicator").style("cursor","default")},setSearchBehavior=function(){var searchField=d3.select("#searchBox"),stateDrop=d3.select("#state-drop-container");d3.select("#search-submit").on("click",submitSearch),$("#searchTypes .btn").on("click",function(){$("#"+searchType).button("toggle"),searchType=$(this).attr("id"),$(this).button("toggle"),"stateSearch"===searchType?(stateDrop.classed("hidden",!1),searchField.classed("hidden",!0)):(stateDrop.classed("hidden",!0),searchField.classed("hidden",!1),searchField.select("#search-field").attr("placeholder",$(this).attr("name")))}),d3.select("#stateDrop").selectAll("a").on("click",function(){searchState!==this.name&&(searchState=this.name,d3.select("#stateDropText").html(searchState+'<span class="sub-arrow"></span>')),"stateSearch"===searchType&&"State"!==searchState&&submitSearch()})},stateSearchResults=function(searchState){state_search_str="state.cfm?statecode="+searchState,CIC.displayResults(state_search_str);var stateImg=new Image;stateImg.onload=function(){stateImgHeight=this.height},stateImg.src="http://www.uscounties.org/cffiles_web/counties/images/"+searchState+".gif"},submitSearch=function(){d3.event.preventDefault(),768>windowWidth&&0==CIC.embed&&$(".navbar-toggle").trigger("click");{var search_str=d3.select("#search-field").property("value");d3.select("#container")}if(ga("send","event","search",searchType,search_str),"stateSearch"===searchType)"RI"===searchState||"CT"===searchState?noty({text:"No county data available for this state."}):"DC"===searchState?CIC.displayResults("county.cfm?id=11001"):stateSearchResults(searchState);else if("countySearch"===searchType){if(""===search_str)return void noty({text:"Enter a county name to search."});var countyName=search_str,stateName="";if(-1!==search_str.indexOf(",")){var csArray=search_str.split(",");stateName=csArray[1].trim().toUpperCase(),countyName=csArray[0].trim()}for(var fats=["county","city","borough","parish"],i=0;i<fats.length;i++)-1!==countyName.indexOf(fats[i])&&(countyName.replace(fats[i],""),countyName.trim());var geoDesc=[" County"," City"," Borough"," Parish"];if(""!==stateName){for(var j=0;j<geoDesc.length;j++){var search_comb=toTitleCase(countyName)+geoDesc[j]+", "+stateName;if(idByName[search_comb])if(""!=CIC.stateAssoc){if(stateFipsMatch(Math.floor(CIC.fipsConversion("string",parseInt(idByName[search_comb]))/1e3))==CIC.stateAssoc)return void(CIC.findACounty?CIC.displayResults("county.cfm?id="+CIC.fipsConversion("string",parseInt(idByName[search_comb]))):CIC.executeSearchMatch(parseInt(idByName[search_comb])));noty({timeout:!1,text:'Your search was not a Florida county.  Please use the <a href="http://explorer.naco.org">full version of County Explorer</a>.'})}else CIC.findACounty?CIC.displayResults("county.cfm?id="+CIC.fipsConversion("string",parseInt(idByName[search_comb]))):CIC.executeSearchMatch(parseInt(idByName[search_comb]))}"washington"===countyName.toLowerCase()&&"DC"===stateName&&(""!=stateAssoc?noty({text:"Your search was not a "+CIC.stateAssoc+' county.  Please use the <a href="http://explorer.naco.org">full version of County Explorer</a>.'}):CIC.findACounty?CIC.displayResults("county.cfm?id=11001"):CIC.executeSearchMatch(11001))}var pMatchArray=[];for(var ind in idByName){var cs_array=ind.split(", ");if((stateName===cs_array[1]||""===stateName)&&-1!=cs_array[0].toLowerCase().indexOf(countyName.toLowerCase())){for(var pObj={fips:parseInt(idByName[ind]),cs_array:cs_array},j=0;j<geoDesc.length&&(pObj.fullCountyMatch=toTitleCase(countyName+" "+geoDesc[j])===cs_array[0],pObj.fullCountyMatch!==!0);j++);pMatchArray.push(pObj)}}if(pMatchArray.length>1){for(var numExactCountyMatch=0,cMatchFIPS=-1,i=0;i<pMatchArray.length;i++)pMatchArray[i].fullCountyMatch&&(numExactCountyMatch++,cMatchFIPS=pMatchArray[i].fips);if(1===numExactCountyMatch)if(""!=CIC.stateAssoc){if(stateFipsMatch(Math.floor(CIC.fipsConversion("string",cMatchFIPS)/1e3))==CIC.stateAssoc)return void(CIC.findACounty?CIC.displayResults("county.cfm?id="+CIC.fipsConversion("string",cMatchFIPS)):CIC.executeSearchMatch(cMatchFIPS));noty({timeout:!1,text:"Your search was not a "+CIC.stateAssoc+' county.  Please use the <a href="http://explorer.naco.org">full version of County Explorer</a>.'})}else CIC.findACounty?CIC.displayResults("county.cfm?id="+CIC.fipsConversion("string",cMatchFIPS)):CIC.executeSearchMatch(cMatchFIPS);if(""!=CIC.stateAssoc){for(var i=pMatchArray.length-1;i>=0;i--)pMatchArray[i].cs_array[1]!=CIC.stateAssoc&&(console.log(pMatchArray[i].cs_array[1]+" : "+CIC.stateAssoc),pMatchArray.splice(i,1));if(0==pMatchArray.length)return void noty({timeout:!1,text:'Your search did not return any Florida counties.  Please use the <a href="http://explorer.naco.org">full version of County Explorer</a>.'})}showResults();var searchResults=d3.select("#results-container").append("div").attr("class","temp");searchResults.append("p").style("text-align","center").text("Your search returned "+pMatchArray.length+" results");for(var rTable=searchResults.append("div").attr("id","multiCountyResult").attr("class","container-fluid").append("table").attr("class","table table-striped table-condensed table-hover").append("tbody"),rTitleRow=rTable.append("tr"),i=(rTitleRow.append("th").text("FIPS"),rTitleRow.append("th").text("County Name"),rTitleRow.append("th").text("State"),0);i<pMatchArray.length;i++){{var countyObj=countyObjectById[pMatchArray[i].fips],nameArr=countyObj.geography.split(", "),countyRow=rTable.append("tr"),name_cell=(countyRow.append("td").text(countyObj.id),countyRow.append("td").classed("link",!0).text(nameArr[0]));countyRow.append("td").text(nameArr[1])}!function(cell,fips){cell.on("click",function(){CIC.findACounty?CIC.displayResults("county.cfm?id="+CIC.fipsConversion("string",fips)):CIC.executeSearchMatch(fips)})}(name_cell,pMatchArray[i].fips)}showInstructions()}else 1==pMatchArray.length?""!=CIC.stateAssoc?stateFipsMatch(Math.floor(CIC.fipsConversion("string",pMatchArray[0].fips)/1e3))==CIC.stateAssoc?CIC.findACounty?CIC.displayResults("county.cfm?id="+CIC.fipsConversion("string",pMatchArray[0].fips)):CIC.executeSearchMatch(pMatchArray[0].fips):(noty({timeout:!1,text:"Your search was not a "+CIC.stateAssoc+' county.  Please use the <a href="http://explorer.naco.org">full version of County Explorer</a>.'}),document.getElementById("search_form").reset()):CIC.findACounty?CIC.displayResults("county.cfm?id="+CIC.fipsConversion("string",pMatchArray[0].fips)):CIC.executeSearchMatch(pMatchArray[0].fips):(noty({text:"Your search did not match any counties."}),document.getElementById("search_form").reset())}else if("citySearch"===searchType)if(isNaN(+search_str))if(2===search_str.length)citiesStateSearch="citiesstateall.cfm?STATECODE="+search_str+"&websource=naco",CIC.displayResults(citiesStateSearch);else{var city_str_index=search_str.toLowerCase().indexOf("city"),comma_index=search_str.toLowerCase().indexOf(",");-1!==city_str_index&&(search_str=search_str.substr(0,city_str_index)),-1!==comma_index&&comma_index<=search_str.length&&(search_str=search_str.substr(0,comma_index)),CIC.displayResults("city_res.cfm?city="+search_str)}else{var zipFormat=d3.format("05d"),zipSearch="zip_res.cfm?zip="+zipFormat(search_str);console.log(),CIC.displayResults(zipSearch)}};CIC.executeSearchMatch=function(FIPS){hideInstructions(),$("#search-field").val("");var county=countyObjectById[+FIPS];if(county){$.noty.closeAll(),highlight(county);var zoomTransition=zoomTo(+FIPS);return populateTooltip(county),zoomTransition.each("end",function(){if(positionTooltip($(".county.active")[0]),indObjects[0].has_profile)if(cbOptsVert={iframe:!0,width:"792px",height:"632px",maxHeight:"90%",maxWidth:"90%",title:"",href:""},cbOptsHoriz={iframe:!0,width:"792px",height:"632px",maxHeight:"90%",maxWidth:"90%",title:"",href:""},"County Economies | County Economic Profile"===currentDI)if("."===quantByIds[4][+FIPS])noty({text:"<strong>Profile Temporarily Unavailable</strong>  Please check back soon."});else{var countyName=parseCountyName(+FIPS,county.geography);countyName=countyName.replace(/\s/g,"");var profileURL="../profiles/countyeconomies/"+countyName+".pdf";cbOptsHoriz.title='<a class="newWindow" href="'+profileURL+'" target=_blank">Open In New Window</a>',cbOptsHoriz.href=profileURL,$.colorbox(cbOptsHoriz)}else if("Municipal Bonds | County Muni Bonds Profiles"===currentDI)if(isNaN(quantByIds[0][+FIPS]))noty({text:"<strong>No Profile Available</strong>"});else{var countyName=parseCountyName(+FIPS,county.geography),profileURL="../profiles/county_muniBonds/muni_bonds_profile_"+countyName+".pdf";cbOptsHoriz.title='<a class="newWindow" href="'+profileURL+'" target=_blank">Open In New Window</a>',cbOptsHoriz.href=profileURL,$.colorbox(cbOptsHoriz)}else if("Community Development Block Grants (CDBG) | CDBG Profiles"===currentDI){if(0===quantByIds[0][+FIPS]||isNaN(quantByIds[0][+FIPS]))var profileURL="../profiles/CDBG/national.pdf";else var countyName=parseCountyName(+FIPS,county.geography),profileURL="../profiles/CDBG/"+countyName+".pdf";cbOptsVert.title='<a class="newWindow" href="'+profileURL+'" target=_blank">Open In New Window</a>',cbOptsVert.href=profileURL,$.colorbox(cbOptsVert)}else if("Municipal Bonds | Statewide Muni Bonds Profiles"===currentDI){var state=countyObjectById[+FIPS].STATE,profileURL="../profiles/state_muniBonds/state_bonds_profiles"+state+".pdf";cbOptsHoriz.title='<a class="newWindow" href="'+profileURL+'" target=_blank">Open In New Window</a>',cbOptsHoriz.href=profileURL,$.colorbox(cbOptsHoriz)}else if("Payment in Lieu of Taxes (PILT) | PILT Profiles"===currentDI){if(0===quantByIds[0][+FIPS])var profileURL="../profiles/PILT/National_PILT.pdf";else var countyName=parseCountyName(+FIPS,county.geography),profileURL="../profiles/PILT/"+countyName+".pdf";cbOptsVert.title='<a class="newWindow" href="'+profileURL+'" target=_blank">Open In New Window</a>',cbOptsVert.href=profileURL,$.colorbox(cbOptsVert)}else if("Payment in Lieu of Taxes (PILT) | State PILT Profiles"===currentDI){var state=countyObjectById[+FIPS].STATE,profileURL="../profiles/PILT_State/"+state+".pdf";cbOptsVert.title='<a class="newWindow" href="'+profileURL+'" target=_blank">Open In New Window</a>',cbOptsVert.href=profileURL,$.colorbox(cbOptsVert)}else if("MFA Profiles | MFA Profiles"===currentDI){var state=countyObjectById[+FIPS].STATE;if("MT"==state|"OR"==state|"NH"==state|"DE"==state)noty({text:"<strong>No Profile Available</strong></br>This state does not have a sales tax."});else{var profileURL="../profiles/MFA/MITFA_"+state+".pdf";cbOptsVert.title='<a class="newWindow" href="'+profileURL+'" target=_blank">Open In New Window</a>',cbOptsVert.href=profileURL,$.colorbox(cbOptsVert)}}else if("Transportation Funding Profiles | Transportation Funding Profiles"===currentDI)if(0/0===quantByIds[0][+FIPS])noty({text:"<strong>No Profile Available</strong>"});else{var state=countyObjectById[+FIPS].STATE,profileURL="../profiles/stateTransportation/state_summary_"+state+".pdf";cbOptsHoriz.title='<a class="newWindow" href="'+profileURL+'" target=_blank">Open In New Window</a>',cbOptsHoriz.href=profileURL,$.colorbox(cbOptsHoriz)}else if("MAP-21 Profiles | MAP-21 Profiles"===currentDI)if(0/0===quantByIds[0][+FIPS])noty({text:"<strong>No Profile Available</strong>"});else{var state=countyObjectById[+FIPS].STATE,profileURL="../profiles/MAP-21/"+state+".pdf";cbOptsHoriz.title='<a class="newWindow" href="'+profileURL+'" target=_blank">Open In New Window</a>',cbOptsHoriz.href=profileURL,$.colorbox(cbOptsHoriz)}else if("U.S. Ex-Im Bank Financing | U.S. Ex-Im Bank County Profiles"===currentDI)if(0===quantByIds[0][+FIPS])noty({text:"<strong>No Profile Available</strong></br>Businesses located in this county have not received export financing support from the U.S. Ex-Im Bank between 2007 and 2014."});else{var countyName=parseCountyName(+FIPS,county.geography);countyName=countyName.replace(/\s/g,"");var profileURL="../profiles/exim/"+countyName+".pdf";cbOptsVert.title='<a class="newWindow" href="'+profileURL+'" target=_blank">Open In New Window</a>',cbOptsVert.href=profileURL,$.colorbox(cbOptsVert)}else if("Secure Rural Schools (SRS) | SRS Profiles"===currentDI)if(0===quantByIds[0][+FIPS]){var profileURL="../profiles/SRSProfiles/National.pdf";cbOptsVert.title='<a class="newWindow" href="'+profileURL+'" target=_blank">Open In New Window</a>',cbOptsVert.href=profileURL,$.colorbox(cbOptsVert)}else{var countyName=parseCountyName(+FIPS,county.geography);countyName=countyName.replace(/\s/g,"");var profileURL="../profiles/SRSProfiles/"+countyName+".pdf";cbOptsVert.title='<a class="newWindow" href="'+profileURL+'" target=_blank">Open In New Window</a>',cbOptsVert.href=profileURL,$.colorbox(cbOptsVert)}else if("Secure Rural Schools (SRS) | State SRS Profiles"===currentDI){var state=countyObjectById[+FIPS].STATE,profileURL="../profiles/StateSRSProfiles/"+state+".pdf";cbOptsVert.title='<a class="newWindow" href="'+profileURL+'" target=_blank">Open In New Window</a>',cbOptsVert.href=profileURL,$.colorbox(cbOptsVert)}else if("Endangered Species | Endangered Species Profiles"===currentDI){var countyName=parseCountyName(+FIPS,county.geography);countyName=countyName.replace(/\s/g,"");var profileURL="../profiles/endangeredSpecies/"+countyName+".pdf";cbOptsHoriz.title='<a class="newWindow" href="'+profileURL+'" target=_blank">Open In New Window</a>',cbOptsHoriz.href=profileURL,$.colorbox(cbOptsHoriz)}else if("County Administrators | County Administrator Profiles"===currentDI){var state=countyObjectById[+FIPS].STATE,profileURL="../profiles/countyAdminProfiles/administratorProfile_"+state+".pdf";cbOptsHoriz.title='<a class="newWindow" href="'+profileURL+'" target=_blank">Open In New Window</a>',cbOptsHoriz.href=profileURL,$.colorbox(cbOptsHoriz)}}),zoomTransition}return tooltip.classed("hidden",!0),noty({text:"Data not available for this county"}),!1},CIC.displayResults=function(url){showResults(),$("#print").css("display","inline"),d3.xhr("/ciccfm/"+url,function(error,request){if(error)console.log("Error retrieving data from : /ciccfm/"+url),console.log(error);else{var response=request.responseText;if(-1!==response.indexOf("An error occurred"))return void noty({text:"Information for this county is not currently available."});var frame=d3.select("#results-container").append("div").attr("class","container-fluid temp");frame.html(response),-1!=url.indexOf("state")&&(CIC.mapToggle(768>windowWidth?"table":"map"),$("#stateSearchToggle").show(),$("#state-map-iframe").css("height",stateImgHeight+"px")),showInstructions()}var feed=$("#naco-website-feed").html();$("#naco-website-feed-blank").html(feed)})},CIC.update=function(dataset,indicator){NProgress.start(),currentDI=dataset+" | "+indicator,$(document.body).scrollTop(0),indObjects=allInfo(dataset,indicator),currentDataType=indObjects[0].dataType,customColors=indObjects[0].hasOwnProperty("customRange")?indObjects[0].customRange:null,isPerCapita=!1,$("#perCapitaButton").removeClass("active"),!indObjects[0].hasOwnProperty("perCapita")||indObjects[0].perCapita!==!0||"level"!=currentDataType&&"level_np"!=currentDataType?$("#perCapitaButton").addClass("disabled"):$("#perCapitaButton").removeClass("disabled"),$(document.body).off("dataReceived"),$(document.body).on("dataReceived",function(event,qbis,data){NProgress.set(.5),quantByIds=qbis,quantByIds=manipulateData(quantByIds,indObjects);for(var fips in data)idByName[data[fips].geography]=fips,countyObjectById[fips]=data[fips];updateView(),updateDefinitions(),NProgress.done(!0)}),getData(indObjects)};var getData=function(indObjs){if(localVersion)d3.tsv("data/local_data.tsv",function(error,countyData){for(var qbis=[],i=0;i<indObjs.length;i++)qbis.push([]);countyData.forEach(function(d){for(var i=0;i<indObjs.length;i++)qbis[i][d.id]=isNumFun(indObjs[i].dataType)?parseFloat(d[indObjs[i].DI]):d[indObjs[i].DI],indObjs[i].hasOwnProperty("unit")&&-1!==indObjs[i].unit.indexOf("thousand")&&(qbis[i][d.id]*=1e3),indObjs[i].hasOwnProperty("unit")&&-1!==indObjs[i].unit.indexOf("million")&&(qbis[i][d.id]*=1e6);idByName[d.geography]=d.id,countyObjectById[d.id]=d}),attachCountyTitles(),$(document.body).trigger("dataReceived",[qbis])});else{for(var indicatorList={},i=0;i<indObjs.length;i++){{indObjs[i].dataset+" - "+indObjs[i].name}indObjs[i].hasOwnProperty("name")||console.log("Indicator #"+i+" not matched in CIC structure");var year=indObjs[i].year;indicatorList.hasOwnProperty(indObjs[i].db_dataset)||(indicatorList[indObjs[i].db_dataset]={});var dataset_obj=indicatorList[indObjs[i].db_dataset];dataset_obj.hasOwnProperty(year)||(dataset_obj[year]=[]),dataset_obj[year].push(indObjs[i].db_indicator)}var qsa=[];for(var ds_name in indicatorList)for(var year in indicatorList[ds_name]){for(var ind_list=indicatorList[ds_name][year],query_str="db_set="+ds_name+"&db_year="+year+"&db_ind=",j=0;j<ind_list.length;j++)query_str+=ind_list[j],j!=ind_list.length-1&&(query_str+=",");qsa.push(query_str)}var getRequest=function(query_str){d3.xhr("/ciccfm/indicators.cfm?"+query_str,function(error,request){try{var responseObj=jQuery.parseJSON(request.responseText)}catch(error){noty({text:"Error retrieving information from database."}),console.log(-1!=query_str.indexOf("undefined")?"A companion is not matching to the metadata: "+query_str:"Error retrieving data.\nDataset:"+query_str.substring(7,query_str.indexOf("&db_ind=")-7)+"\nIndicators:"+query_str.substring(query_str.indexOf("&db_ind="))),NProgress.done(!0)}0===responseObj.ROWCOUNT&&noty({text:"Database error: ROWCOUNT = 0"});for(var i=0;i<responseObj.DATA.FIPS.length;i++){var fips=parseInt(responseObj.DATA.FIPS[i]);data.hasOwnProperty(fips)||(data[fips]={id:fips});for(var j=1;j<responseObj.COLUMNS.length;j++){var property=responseObj.COLUMNS[j];data[fips].hasOwnProperty(property)||(data[fips][property]=responseObj.DATA[property][i])}data[fips].hasOwnProperty("geography")||(data[fips].geography=data[fips].COUNTY_NAME+", "+data[fips].STATE)}$(document.body).trigger("requestReceived")})},data={},requestsReceived=0;$(document.body).off("requestReceived"),$(document.body).on("requestReceived",function(){if(requestsReceived++,requestsReceived===qsa.length){for(var qbis=[],i=0;i<indObjs.length;i++)qbis.push([]);for(var fips in data){for(var i=0;i<indObjs.length;i++){var value=data[fips][indObjs[i].db_indicator.toUpperCase()];qbis[i][fips]=isNumFun(indObjs[i].dataType)?parseFloat(value):value,indObjs[i].hasOwnProperty("unit")&&-1!==indObjs[i].unit.indexOf("thousand")&&(qbis[i][fips]*=1e3),indObjs[i].hasOwnProperty("unit")&&-1!==indObjs[i].unit.indexOf("million")&&(qbis[i][fips]*=1e6)}idByName[data[fips].geography]=fips,countyObjectById[fips]=data[fips]}attachCountyTitles(),$(document.body).trigger("dataReceived",[qbis,data])}});for(var i=0;i<qsa.length;i++)getRequest(qsa[i],i)}},updateView=function(){function setDomainRange(){"none"!==currentDataType&&(color=d3.scale.quantile(),isNumeric?color.domain(domain).range(range):color.domain(corrDomain).range(range))}var isNumeric=isNumFun(currentDataType),quantById=quantByIds[0];if(isNumeric){var domain=[];for(var ind in quantById)domain[ind]=quantById[ind]}else if("binary"===currentDataType){corrDomain=[];for(var ind in quantById)(0===quantById[ind]||1===quantById[ind])&&(corrDomain[ind]=quantById[ind]);var vals={Yes:1,No:0}}else if("categorical"===currentDataType){corrDomain=[];var numCorrVals=0,vals={},corrVal=0;if(indObjects[0].hasOwnProperty("order")){vals=indObjects[0].order;for(var ind in quantById)corrDomain[ind]=vals[quantById[ind]]}else for(var ind in quantById)"."!==quantById[ind]&&""!==quantById[ind]&&null!==quantById[ind]&&(vals.hasOwnProperty(quantById[ind])||(vals[quantById[ind]]=corrVal,corrVal++),corrDomain[ind]=vals[quantById[ind]]);for(var ind in vals)numCorrVals++}switch(currentDataType){case"percent":range=percent_colors;break;case"binary":range=binary_colors;break;case"categorical":if(2===numCorrVals)range=binary_colors;else if(null!=customColors)range=customColors;else{range=[];for(var availColors=categorical_colors,i=0;numCorrVals>i;i++)range.push(availColors[i])}break;default:range=level_colors}if(setDomainRange(),measureType="quintile",isNumeric){if(indObjects[0].hasOwnProperty("thresholds"))measureType="threshold";else{var quantiles=color.quantiles();if(isPerCapita){if(quantiles[0]<.01){pop_db.personPerUnit=!0,domain=[];for(var ind in quantById)quantById[ind]=0!=quantById[ind]?1/quantById[ind]:null,domain[ind]=quantById[ind];setDomainRange(),quantiles=color.quantiles()}indObjects[0].hasOwnProperty("unit")||(indObjects[0].unit=""),(-1==indObjects[0].unit.indexOf("per person")&&0==pop_db.personPerUnit||-1==indObjects[0].unit.indexOf("people per")&&1==pop_db.personPerUnit)&&(pop_db.personPerUnit?(indObjects[0].unit=indObjects[0].unit.substring(0,indObjects[0].unit.indexOf("s")),indObjects[0].unit="people per "+indObjects[0].unit):indObjects[0].unit=indObjects[0].unit+" per person")}if(0===quantiles[0]){measureType="quartile";var q_domain=[];for(var ind in domain)0!==+domain[ind]&&(q_domain[ind]=domain[ind]);for(var q_range=[],i=1;i<level_colors.length;i++)q_range.push(level_colors[i]);color.domain(q_domain).range(q_range),quantiles=color.quantiles()}for(var i=0;i<quantiles.length-1;i++)if(quantiles[i]===quantiles[i+1]){measureType="threshold";break}var d=color.domain();"quartile"===measureType&&quantiles[0]<=1&&(measureType="threshold"),(quantiles[0]===d[0]||quantiles[quantiles.length-1]===d[d.length-1])&&(measureType="threshold")}"threshold"===measureType?small_large_array=switchToThreshold(domain,range):"quartile"===measureType&&(domain=q_domain,range=q_range)}if(isNumeric?"threshold"===measureType?($("#quantileButton").addClass("disabled"),$("#quantileButton").removeClass("active"),$("#thresholdButton").addClass("active"),showThresholdInputs()):($("#quantileButton").removeClass("disabled"),$("#quantileButton").addClass("active"),$("#thresholdButton").removeClass("disabled active"),$("#thresholdInputContainer").hide()):($("#quantileButton, #thresholdButton").addClass("disabled"),$("#quantileButton, #thresholdButton").removeClass("active"),$("#thresholdInputContainer").hide()),d3.select(".county.active").empty()!==!0&&$("#tt").hasClass("hidden")===!0&&unhighlight(),fillMapColors(),"none"===currentDataType?(changeLegendTitle(),$("#quantileLegend").css("visibility","hidden")):($("#quantileLegend").css("visibility","visible"),legend=isNumeric?createLegend(measureType,null,small_large_array):createLegend(measureType,vals)),d3.select(".county.active").empty()!==!0&&$("#tt").hasClass("hidden")===!1){var active_county=d3.select(".county.active")[0][0];
populateTooltip(active_county),positionTooltip(active_county)}var writeSource=function(){for(var sources=indObjects[0].source+(indObjects[0].suppressYear?".":indObjects[0].legendTitlePre?", "+indObjects[0].legendTitlePre:", "+indObjects[0].year),i=1;i<indObjects.length;i++)if(indObjects[i].dataset!==indObjects[0].dataset){var tempSource=indObjects[i].source+(indObjects[i].suppressYear?"":indObjects[i].legendTitlePre?", "+indObjects[i].legendTitlePre:", "+indObjects[i].year);-1===sources.indexOf(tempSource)&&(sources=sources.concat("; "+tempSource))}d3.select("#sourceContainer").append("p").attr("id","sourceText").html('<span style="font-weight:400;">Source: </span>'+sources)};if(d3.select("#sourceContainer").selectAll("p").remove(),writeSource(),indObjects[0].has_profile){var text="Click once on a county to see their county profile.";("MFA Profiles"===indObjects[0].name||"Transportation Funding Profiles"===indObjects[0].name||"Statewide Muni Bonds Profiles"===indObjects[0].name||"MAP-21 Profiles"===indObjects[0].name||"State PILT Profilestt"===indObjects[0].name)&&(text="Click once on a county to see their state profile."),noty({type:"alert",text:"<strong>"+text+"</strong>",timeout:!1})}$(".idio-note").hide(),indObjects[0].hasOwnProperty("notes")&&$(indObjects[0].notes).show()},switchToThreshold=function(domain,range){color=d3.scale.threshold();for(var new_domain=[],i=0;i<domain.length;i++)isNaN(domain[i])||new_domain.push(domain[i]);if(new_domain.sort(function(a,b){return a-b}),large=new_domain[new_domain.length-1],small="level"===currentDataType?0:new_domain[0],indObjects[0].hasOwnProperty("thresholds"))domain=indObjects[0].thresholds;else if("percent"!==currentDataType&&5>=large)domain=[1,2,3,4];else if(domain=[],"percent"===currentDataType)for(var i=1;5>i;i++)domain.push(small+i*(large-small)/5);else{for(var i=1;5>i;i++)domain.push(large*Math.pow(10,i-5));for(var i=0;i<domain.length;i++)indObjects[0].format_type?"dec1"===indObjects[0].format_type?domain[i]=domain[i].toFixed(1):"dec2"===indObjects[0].format_type&&(domain[i]=domain[i].toFixed(2)):domain[i]=Math.round(domain[i]);domain[0]<=0&&(domain[0]=1);for(var i=1;i<domain.length;i++)domain[i]<=domain[i-1]&&(domain[i]=domain[i-1]+1)}return color.domain(domain).range(range),[small,large]},showThresholdInputs=function(){$("#thresholdInputContainer").show();for(var domain=color.domain(),i=0;4>i;i++)$("#thresholdInput"+(i+1)).val(domain[i])},manipulateData=function(qbis,indObjs){for(var i=0;i<qbis.length;i++)for(var ind in qbis[i])exceptionCounties.hasOwnProperty(+ind)?qbis[i][ind]=".":"binary"===indObjs[i].dataType?(1==qbis[i][ind]||"Yes"===qbis[i][ind]?qbis[i][ind]=1:0==qbis[i][ind]||"No"===qbis[i][ind]?qbis[i][ind]=0:2===qbis[i][ind]&&(qbis[i][ind]=1),"Consolidation"===indObjs[i].name&&null===qbis[i][ind]&&(qbis[i][ind]=0)):"categorical"===indObjs[i].dataType?(0===qbis[i][ind]&&(qbis[i][ind]="None"),"Level of CBSA"===indObjs[i].name&&(1===qbis[i][ind]?qbis[i][ind]="Metropolitan":2===qbis[i][ind]&&(qbis[i][ind]="Micropolitan"))):"level"===indObjs[i].dataType?"Federal Funding"===indObjs[i].category?isNaN(qbis[i][ind])&&(qbis[i][ind]=0):"Fixed Internet Connections"===indObjs[i].name?5===qbis[i][ind]?qbis[i][ind]=1e3:qbis[i][ind]>=1&&(qbis[i][ind]=200*qbis[i][ind]-100):"Supported Exporters"===indObjs[i].name|"U.S. Ex-Im Bank County Profiles"===indObjs[i].name&&5===qbis[i][ind]&&(qbis[i][ind]=4):"percent"===indObjs[i].dataType?"Educational Attainment"===indObjs[i].dataset&&(qbis[i][ind]/=100):"CSA Code"===indObjs[i].name&&0===qbis[i][ind]&&(qbis[i][ind]=null);return qbis},allInfo=function(dataset,indicator){for(var firstObj=CIC.getInfo(dataset,indicator),objArray=[firstObj],i=0;i<firstObj.companions.length;i++)if(objArray.length<firstObj.companions.length){var obj=CIC.getInfo(firstObj.companions[i][0],firstObj.companions[i][1]),isDisabled=$('.dataset[name="'+obj.dataset+'"] .indicator[name="'+obj.name+'"]').parent().hasClass("disabled");obj.name===firstObj.name||isDisabled||objArray.push(obj)}return objArray};CIC.getInfo=function(dataset,indicator){var selectedInd={},structure=CICstructure.children;CICstructure.children||console.log("JSON invalid in metadata file");for(var i=0;i<structure.length;i++)for(var j=0;j<structure[i].children.length;j++)if(structure[i].children[j].name===dataset){var Jdataset=structure[i].children[j];if(selectedInd.category=structure[i].name,selectedInd.dataset=Jdataset.name,selectedInd.year=d3.max(Jdataset.years),selectedInd.source=Jdataset.source,selectedInd.companions=Jdataset.companions,selectedInd.db_dataset=Jdataset.db_dataset,Jdataset.hasOwnProperty("legendTitlePre")&&(selectedInd.legendTitlePre=Jdataset.legendTitlePre),Jdataset.hasOwnProperty("legendTitleMain")&&(selectedInd.legendTitleMain=Jdataset.legendTitleMain),Jdataset.hasOwnProperty("legendTitlePost")&&(selectedInd.legendTitlePost=Jdataset.legendTitlePost),Jdataset.hasOwnProperty("vintage")&&(selectedInd.vintage=Jdataset.vintage),Jdataset.hasOwnProperty("suppressYear")&&(selectedInd.suppressYear=Jdataset.suppressYear),Jdataset.hasOwnProperty("notes")&&(selectedInd.notes=Jdataset.notes),Jdataset.hasOwnProperty("perCapita")&&(selectedInd.perCapita=Jdataset.perCapita),"undefined"!=typeof indicator)for(var h=0;h<Jdataset.children.length;h++)if(indicator===Jdataset.children[h].name){for(var ind in Jdataset.children[h])selectedInd[ind]=Jdataset.children[h][ind];selectedInd.DI=selectedInd.dataset+" - "+selectedInd.name;break}break}return selectedInd};var fillMapColors=function(){var getColor=function(type,d,i){switch(type){case"binary":return corrDomain.hasOwnProperty(d.id)?range[corrDomain[d.id]]:na_color;case"categorical":return isNaN(corrDomain[d.id])?na_color:range[corrDomain[d.id]];case"level":case"level_np":case"percent":return"quartile"===measureType&&0===+quantByIds[0][d.id]?level_colors[0]:isNaN(quantByIds[0][d.id])?na_color:color(quantByIds[0][d.id]);default:var val=quantByIds[0][d.id];return"undefined"==typeof val||null===val||0===val?na_color:(colorKeyArray.hasOwnProperty(val)?d.color=colorKeyArray[val]:(d.color=d3.max(neighbors[i],function(n){return topo[n].color})+1|0,colorKeyArray[val]=d.color),neighbor_colors(d.color))}},colorKeyArray={};""!=CIC.stateAssoc?(g.selectAll(".counties .county[state = "+CIC.stateAssoc+"]:not(.active)").transition().duration(750).style("fill",function(d,i){return getColor(currentDataType,d,i)}),g.selectAll(".counties .county:not([state = "+CIC.stateAssoc+"])").style("fill",na_color).style("pointer-events","none")):g.selectAll(".counties .county:not(.active)").transition().duration(750).style("fill",function(d,i){return getColor(currentDataType,d,i)}),g.selectAll(".counties .county.active").transition().duration(750).style("fill",function(d,i){return frmrFill=getColor(currentDataType,d,i),highlight_color})},updateDefinitions=function(){d3.select("#definitionsContainer").selectAll("p").remove();var defContainer=d3.select("#definitionsContainer").append("p").attr("id","definitionsText");defContainer.append("div").html("<i>Definitions</i>:");for(var i=0;i<indObjects.length;i++)indObjects[i].suppressPrimeInd!==!0&&defContainer.append("div").html("<b>"+indObjects[i].name+"</b>: "+indObjects[i].definition)},createLegend=function(measure_type,keyArray,dataVals){d3.selectAll(".legend svg").remove();var primeIndObj=indObjects[0];if("none"!==primeIndObj.dataType){var options={boxHeight:18,boxWidth:58,dataType:primeIndObj.dataType,unit:primeIndObj.unit,measure_type:measure_type,formatFnArr:format,isPerCapita:isPerCapita};return keyArray&&(options.keyArray=keyArray),dataVals&&(options.small_large=dataVals),("Body of Water"===primeIndObj.name||"County Supported Local Health Departments (LHDs)"===primeIndObj.name)&&(options.boxWidth=68),primeIndObj.hasOwnProperty("format_type")&&(options.format_type=primeIndObj.format_type),primeIndObj.hasOwnProperty("suppressMinMax")&&(options.suppressMinMax=primeIndObj.suppressMinMax),primeIndObj.hasOwnProperty("longLegendNames")&&(options.longLegendNames=primeIndObj.longLegendNames),primeIndObj.hasOwnProperty("overrideLegendMax")&&(options.overrideLegendMax=primeIndObj.overrideLegendMax),changeLegendTitle(),colorlegend("#quantileLegend",color,"quantile",options)}return!1},changeLegendTitle=function(){var primeIndObj=indObjects[0],subtitlePre=primeIndObj.hasOwnProperty("subtitlePre")?primeIndObj.subtitlePre+" ":"",subtitleMain=primeIndObj.hasOwnProperty("subtitleMain")?primeIndObj.subtitleMain:primeIndObj.name,subtitlePost=primeIndObj.hasOwnProperty("subtitlePost")?primeIndObj.subtitlePost:primeIndObj.hasOwnProperty("unit")&&-1!==primeIndObj.unit.indexOf("per ")&&-1===subtitleMain.indexOf("per ")?" ("+primeIndObj.unit+")":"",legendTitlePre=primeIndObj.hasOwnProperty("legendTitlePre")?primeIndObj.legendTitlePre+" ":primeIndObj.year+" ",legendTitleMain=primeIndObj.hasOwnProperty("legendTitleMain")?primeIndObj.legendTitleMain:primeIndObj.dataset,legendTitlePost=primeIndObj.hasOwnProperty("legendTitlePost")?" "+primeIndObj.legendTitlePost:"";primeIndObj.has_profile===!0&&(subtitleMain=primeIndObj.companions[0][1]);var subtitle=subtitlePre+subtitleMain+subtitlePost,legendTitle=legendTitlePre+legendTitleMain+legendTitlePost;d3.select("#legendTitle").text(legendTitle),d3.select("#legendSubtitle").text(subtitle),$(".unavailable-text").html(primeIndObj.hasOwnProperty("greyData")?"*"+primeIndObj.greyData:"*county data is unavailable if the county is colored grey")};CIC.temp;var frmrFill,frmrActive,populateTooltip=function(d){var getAttributes=function(objs){for(var sameDataset=!0,i=1;i<objs.length;i++)if(objs[i].dataset!==objs[0].dataset){sameDataset=!1;break}for(var allSameYear=!0,i=1;i<objs.length;i++)if(objs[i].year!==objs[0].year){allSameYear=!1;break}return{sameDataset:sameDataset,allSameYear:allSameYear}},writeHeader=function(objs,attr){row.append("td").attr({"class":"datasetName",colspan:"2"}).text(function(){var titleText=attr.sameDataset?objs[0].dataset:objs[0].category;return objs[0].hasOwnProperty("yearSpan")?attr.allSameYear?titleText+", "+objs[0].yearSpan:titleText:attr.allSameYear?titleText+", "+objs[0].year:titleText})},writeIndicators=function(row,obj,quant,attr){var unit=obj.hasOwnProperty("unit")?obj.unit:"";if(obj.hasOwnProperty("format_type"))var value=format_tt[obj.format_type](quant[d.id],unit);else var value=format_tt[obj.dataType](quant[d.id],unit);if("$NaN"===value||"NaN"===value||"NaN%"===value||null===value||"."===value||isNumFun(obj.dataType)&&isNaN(quant[d.id]))value='Not Available<a class="more-info-link" href="#"><sup>more info</sup></a>',unit="";else if("string"==typeof value&&(value=value.charAt(0).toUpperCase()+value.substr(1)),"-0.0%"==value&&(value="0.0%"),-1!==unit.indexOf("dollar")||-1!==unit.indexOf("year")&&-1===unit.indexOf("years"))unit="";else if(""!==unit&&1===parseFloat(value.toString().replace(/[^\d\.\-]/g,"")))if("s"===unit.charAt(unit.length-1))unit=unit.substr(0,unit.length-1);else if(-1!==unit.indexOf("s per")){var index=unit.indexOf("s per");unit=unit.substr(0,index)+unit.substr(index+1)}"Fixed Internet Connections"===obj.name?value="1,000"===value?"800-1000":parseInt(value)-100+"-"+(parseInt(value)+100):"Fixed Internet Providers"===obj.name||"Mobile Internet Providers"===obj.name?"1"===value&&(value="1-3",unit+="s"):obj.hasOwnProperty("CETNulls")?"99900.0%"===value||"1000"===value?(value="No Recession",unit=unit="PPT"===unit?"":unit):("-99900.0%"===value||"-1000"===value)&&(value="No Recovery",unit=unit="PPT"===unit?"":unit):"Supported Exporters"===obj.name&&"4"===value&&(value="1-5");var name=-1!=obj.name.indexOf("(")?obj.name.substring(0,obj.name.indexOf("(")):obj.name;attr.allSameYear||obj.hasOwnProperty("year_ind")||(name=obj.year+" "+name),row.append("td").attr("class","dataName").text(name+":"),row.append("td").attr("class","dataNum").html(value+" "+unit)},attrib=getAttributes(indObjects);$("#tipContainer").empty(),tipContainer.append("div").attr("id","tipLocation").text(countyObjectById[d.id].geography);var tipInfo=tipContainer.append("div").attr("id","tipInfo"),tipTable=tipInfo.append("table").attr("class","table").style({"margin-bottom":"5px","margin-top":"0px"}),row=tipTable.append("tr").attr("class","tipKey");writeHeader(indObjects,attrib);for(var i=0;i<indObjects.length;i++)if(indObjects[i].has_profile!==!0&&indObjects[i].suppressPrimeInd!==!0){var row=tipTable.append("tr").attr("class","tipKey");writeIndicators(row,indObjects[i],quantByIds[i],attrib)}d3.selectAll(".more-info-link").on("click",function(){showResults();var moreInfoSource=indObjects[0].source,moreInfoDefs=[];for(i=0;i<indObjects.length;i++)moreInfoDefs.push([indObjects[i].name,indObjects[i].definition]);var moreInfoNotes=d3.selectAll(".idio-note").filter(function(){return"inline"==d3.select(this).style("display")}),moreInfo=d3.select("#results-container").append("div").attr("class","temp").attr("id","more-info-container");for(moreInfo.append("p").text(function(){var titleText=attrib.sameDataset?indObjects[0].dataset:indObjects[0].category;return indObjects[0].hasOwnProperty("yearSpan")?attrib.allSameYear?titleText+", "+indObjects[0].yearSpan:titleText:attrib.allSameYear?titleText+", "+indObjects[0].year:titleText}).attr("id","more-info-header"),i=0;i<moreInfoNotes.length;i++)moreInfo.append("div").html("<br/>*"+moreInfoNotes[i][0].innerText);for(moreInfo.append("p").html("<b>Source:</b> "+moreInfoSource),i=0;i<moreInfoDefs.length;i++)moreInfo.append("div").html("<b>"+moreInfoDefs[i][0]+":</b> "+moreInfoDefs[i][1]);showInstructions()})},positionTooltip=function(county){if(county){tooltip.classed("hidden",!1);var ttWidth=$("#tt").width(),ttHeight=$("#tt").height(),scroll_top=document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop,scroll_left=document.documentElement&&document.documentElement.scrollLeft||document.body.scrollLeft,countyCoord=county.getBoundingClientRect(),top=countyCoord.top-ttHeight-containerOffset.top+scroll_top-10,left=countyCoord.left+countyCoord.width-ttWidth-containerOffset.left+scroll_left+20,arrow_left=-20+countyCoord.width/2,dx=windowWidth-(left+ttWidth),dy=windowHeight-(top+ttHeight);0>left?(arrow_left-=left,left=0):0>dx&&(arrow_left+=-20>dx?-20:dx,left+=dx),0>top?top=0:0>dy&&(top+=dy),tooltip.transition().style("left",left+"px").style("top",top+"px"),d3.select(".arrow-box").transition().style("right",arrow_left+"px")}},doubleClicked=function(fips){tooltip.classed("hidden",!0),zoomTo(parseInt(fips));var countyID=fips.toString();4==countyID.length&&(countyID="0"+countyID),CIC.displayResults("county.cfm?id="+countyID)},zoomTo=function(fips){var t=path.centroid(countyPathById[fips]),s=4.5,coordAdjust=1.215,transAdjust=20,area=path.area(countyPathById[fips]);s=10>area?7:50>area?6:200>area?5.5:400>area?5:700>area?4.5:1e3>area?4:3.5,t[0]=-t[0]*(s-1)*coordAdjust,t[1]=(transAdjust-t[1])*(s-1)*coordAdjust;var transition=zoomMap(t,s);return transition},highlight=function(d){selected===d&&tooltip.classed("hidden",!0),selected=d&&selected!==d?"Feature"===d.type?d:countyPathById[d.id]:null,g.selectAll("path").classed("active",selected&&function(d){return d===selected}),frmrActive&&frmrActive.style("fill",frmrFill),frmrActive=d3.select(".county.active"),frmrActive.empty()!==!0&&(frmrFill=frmrActive.style("fill"),frmrActive.style("fill",null))},unhighlight=function(){null!==selected&&highlight(selected),$(".county.active").removeClass("active")},redraw=function(){tooltip.classed("hidden",!0),windowWidth=$(window).width(),windowWidth>2e3&&$("#container").removeClass("container").addClass("container-fluid"),width=document.getElementById("container").offsetWidth,height=width/1.8,containerOffset=$("#container").offset(),d3.select("svg").remove(),setup(width,height),draw(topo,stateMesh),"undefined"!=typeof legend&&legend!==!1&&legend.reposition(),fillMapColors(),$.colorbox.resize({innerWidth:"80%",innerHeight:"80%"})},zoomMap=function(t,s,smooth){if("undefined"==typeof smooth)var smooth=!0;zoom.translate(t),zoom.scale(s),frmrS=s,frmrT=t;var sb=d3.select("#state-borders");if(s>7?sb.style("stroke-width","0.7px"):sb.style("stroke-width","1.5px"),smooth){var transition=g.transition().attr("transform","translate("+t+")scale("+s+")");return transition}return g.attr("transform","translate("+t+")scale("+s+")"),!1},positionInstruction=function(){var instructionLeft=.05*windowWidth/2;windowWidth>1024&&(instructionLeft=(windowWidth-960)/2);var minHeight=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;minHeight-=50,minHeight>450&&(minHeight=450),d3.select("#instructions").style({left:instructionLeft-containerOffset.left+"px",height:height+"px","min-height":minHeight+"px"})},positionZoomIcons=function(){var openTrayCoords=($(window).width()-$("#container").width()-30)/2;d3.select("#side-icon-container").style("right",-openTrayCoords+"px"),d3.selectAll(".icon-right-panel").style("margin-left","110px").on("mouseover",function(){d3.select(this).transition().duration(300).style("margin-left","0px")}).on("mouseout",function(){d3.select(this).transition().duration(300).style("margin-left","110px")})},setZoomIconBehavior=function(){d3.select("#zoomPlusIcon").on("click",function(){for(var s=frmrS>9?10:frmrS+1,t=[0,0],i=0;i<frmrT.length;i++)t[i]=frmrT[i]*(s/frmrS);zoomMap(t,s),tooltip.classed("hidden",!0)}),d3.select("#zoomMinusIcon").on("click",function(){var s=2>frmrS?1:frmrS-1,t=[0,0];if(1!==s)for(var i=0;i<frmrT.length;i++)t[i]=frmrT[i]*(s/frmrS);zoomMap(t,s),tooltip.classed("hidden",!0)})},attachCountyTitles=function(){d3.selectAll(".county").append("title").html(function(d){return countyObjectById.hasOwnProperty(d.id)&&countyObjectById[d.id].hasOwnProperty("geography")?countyObjectById[d.id].geography:!1})};$(".share-toggle").click(function(){var baseState={base:"index"},directLink="index.html?dset="+encodeURIComponent(indObjects[0].dataset)+"&ind="+encodeURIComponent(indObjects[0].name);history.pushState(baseState,"directLink",directLink)}),$("#embed-copy").click(function(){function copyToClipboard(text){window.prompt("To embed this indicator, copy to clipboard: Ctrl+C, and paste into HTML",text)}var currentIndicatorUrl="index.html?dset="+encodeURIComponent(indObjects[0].dataset)+"&ind="+encodeURIComponent(indObjects[0].name),embedCopyIframe='<div style="width: 100%;  height: 0; padding-bottom: 72%; position: relative;"><iframe style="width: 100%; height: 100%; position: absolute;" src="http://explorer.naco.org/'+currentIndicatorUrl+'&external=true&embed=true" frameborder="0" scrolling="no">County Explorer</iFrame></div>';copyToClipboard(embedCopyIframe)});var exportSVG=function(){d3.selectAll("path").attr({stroke:"#fff","stroke-width":".2px"}),d3.select("#state-borders").attr({fill:"none",stroke:"#fff","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5px"}),svgenie.save("map-svg",{name:"test.png"})};d3.select(document.body).on("keyup",function(){d3.event.ctrlKey&&d3.event.shiftKey&&69===d3.event.keyCode&&exportSVG()}),d3.select(document.body).on("keyup",function(){if(d3.event.ctrlKey&&d3.event.shiftKey&&76===d3.event.keyCode){level_colors=["rgb(189,215,231)","rgb(107,174,214)","rgb(49,130,189)","rgb(7,81,156)","rgb(28,53,99)"];var i=currentDI.indexOf(" | ");CIC.update(currentDI.substring(0,i),currentDI.substring(i+3,currentDI.length))}}),setup(width,height),windowWidth>=768||1==CIC.embed?d3.json("data/us.json",function(error,us){var counties=topojson.feature(us,us.objects.counties).features,states=topojson.mesh(us,us.objects.states,function(a,b){return a!==b});counties.forEach(function(d){countyPathById[d.id]=d}),topo=counties,neighbors=topojson.neighbors(us.objects.counties.geometries),stateMesh=states,draw(topo,stateMesh),d3.json("data/CICstructure.json",function(error,CICStructure){CICstructure=CICStructure,setBehaviors();for(var match,urlParams={},pl=/\+/g,search=/([^&=]+)=?([^&]*)/g,decode=function(s){return decodeURIComponent(s.replace(pl," "))},query=window.location.search.substring(1);match=search.exec(query);)urlParams[decode(match[1])]=decode(match[2]);var custom_dset="",custom_ind="";if(urlParams.hasOwnProperty("dset")&&urlParams.hasOwnProperty("ind")&&(custom_dset=urlParams.dset,custom_ind=urlParams.ind),localVersion?CIC.update(default_dset,default_ind):""!==custom_dset?CIC.update(custom_dset,custom_ind):CIC.update(default_dset,default_ind),""!==custom_dset){CIC.findACounty=!1;var scope=angular.element($("#container")).scope();scope.$apply(function(){scope.panel.setVisible(!1)})}else if(urlParams.hasOwnProperty("signup")){var scope=angular.element($("#container")).scope();scope.$apply(function(){scope.panel.toggleShowing("mailingList")})}else if(urlParams.hasOwnProperty("showhelp")){var scope=angular.element($("#container")).scope();scope.$apply(function(){scope.panel.toggleShowing("help"),scope.panel.selectHelpTab(parseInt(urlParams.showhelp))})}else urlParams.hasOwnProperty("zipSearch")&&($("#citySearch").trigger("click"),$("#search-field").focus())})}):d3.tsv("data/fips_name_data.tsv",function(error,mobileData){mobileData.forEach(function(d){idByName[d.geography]=d.id,countyObjectById[d.id]=d}),window.onload=function(){setBehaviors()};for(var match,urlParams={},pl=/\+/g,search=/([^&=]+)=?([^&]*)/g,decode=function(s){return decodeURIComponent(s.replace(pl," "))},query=window.location.search.substring(1);match=search.exec(query);)urlParams[decode(match[1])]=decode(match[2]);if(urlParams.hasOwnProperty("signup")){var scope=angular.element($("#container")).scope();scope.$apply(function(){scope.panel.toggleShowing("mailingList")})}else if(urlParams.hasOwnProperty("showhelp")){var scope=angular.element($("#container")).scope();scope.$apply(function(){scope.panel.toggleShowing("help"),scope.panel.selectHelpTab(parseInt(urlParams.showhelp))})}else urlParams.hasOwnProperty("zipSearch")&&($("#citySearch").trigger("click"),$("#search-field").focus());$("#stateSearchToggle").hide()});var throttleTimer;d3.select(window).on("resize",function(){window.clearTimeout(throttleTimer),throttleTimer=window.setTimeout(redraw,200)}),CIC.mapToggle=function(showIt){"map"==showIt?($("#state-map-iframe").show(),$("#stateResponse-table").hide()):($("#stateResponse-table").show(),$("#state-map-iframe").hide())};var showInstructions=function(){var scope=angular.element($("#container")).scope();scope.$apply(function(){scope.panel.setVisible(!0)})},hideInstructions=function(){var scope=angular.element($("#container")).scope();scope.$apply(function(){scope.panel.setVisible(!1)})},showResults=function(){$("#results-container").empty();var scope=angular.element($("#container")).scope();scope.$apply(function(){scope.panel.toggleShowing("results")})};768>windowWidth&&0==CIC.embed&&(""!=CIC.stateAssoc&&window.location.replace("http://explorer.naco.org"),CIC.findACounty=!0,$("#mobile-text").show(),$("#map").hide(),$("#zoomIcons").hide(),$("#undermap").hide(),$("#external-logo").hide(),window.setTimeout(function(){"true"!==$(".navbar-collapse").attr("aria-expanded")&&$(".navbar-toggle").trigger("click")},8e3));for(var exceptionList=[9001,9003,9005,9007,9009,9011,9013,9015,25003,25009,25011,25013,25015,25017,25027,44001,44003,44005,44007,44009,51510,51520,51530,51540,51550,51570,51580,51590,51595,51600,51610,51620,51630,51640,51650,51660,51670,51678,51680,51683,51685,51690,51700,51710,51720,51730,51735,51740,51750,51760,51770,51775,51790,51800,51810,51820,51830,51840],exceptionCounties={},i=0;i<exceptionList.length;i++)exceptionCounties[exceptionList[i]]=!0;CIC.fipsConversion=function(convertTo,fips){if("number"==convertTo)return+fips;if("string"==convertTo){var fipsStr=fips.toString();return 4==fipsStr.length&&(fipsStr="0"+fipsStr),fipsStr}};var parseCountyName=function(fips,name){var countyName=name.replace(/,| /g,"");return 21111===fips?countyName="Louisville/JeffersonCountyKY":24033===fips?countyName="PrinceGeorgesCountyMD":20209===fips?countyName="WyandotteCounty/KansasCityKS":22109===fips?countyName="TerrebonneParishLA":47037===fips&&(countyName="Nashville/DavidsonCountyTN"),countyName},stateFipsMatch=function(stateID){switch(stateID){case 12:return"FL";case 55:return"WI";default:return"na"}},toTitleCase=function(str){return str.replace(/\w\S*/g,function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase()})},isNumFun=function(data_type){return"level"===data_type||"level_np"===data_type||"percent"===data_type},determineType=function(unit){var type="";return unit&&""!==unit&&(-1!=unit.indexOf("dollar")?type="currency":-1!=unit.indexOf("year")&&"years of potential life lost before age 75 per 100,000 people"!=unit?type="year":(-1!=unit.indexOf("person")||-1!=unit.indexOf("employee"))&&(type="person")),type},format={percent:d3.format(".1%"),binary:function(num){return num},categorical:function(num){return num},level:function(num,unit){var type=determineType(unit);if("year"===type)return num.toFixed(0);if("PPT"===unit)return d3.format(".1r")(num)+" PPT";if(Math.abs(num)>=1e9)var formatted=String((num/1e9).toFixed(1))+"bil";else if(Math.abs(num)>=1e6)var formatted=String((num/1e6).toFixed(1))+"mil";else{if(!(Math.abs(num)>=1e4))return Math.abs(num)>=100?"currency"===type?d3.format("$,.0f")(num):d3.format(",.0f")(num):0==num?isPerCapita?d3.format("")(num):"currency"===type?"$0":0:"currency"===type?d3.format("$.2f")(num):"person"===type&&isPerCapita?d3.format(".2f")(num):d3.format("0f")(num);var formatted=String((num/1e3).toFixed(1))+"k";"1000.0k"===formatted&&(formatted=String((num/1e6).toFixed(1))+" Mil")}return"currency"===type?"$"+formatted:formatted},dec1:function(num,unit){var type=determineType(unit);return Math.abs(num)>=1e3?"currency"===type?d3.format("$,.0f")(num):d3.format(",.0f")(num):"currency"===type?d3.format("$.1f")(num):d3.format(".1f")(num)},dec2:function(num,unit){var type=determineType(unit);return Math.abs(num)>=1e3?"currency"===type?d3.format("$,.0f")(num):d3.format(",.0f")(num):"currency"===type?d3.format("$.2f")(num):d3.format(".2f")(num)},none:function(num){return num}};format.level_np=format.level;var format_tt={};for(var ind in format)format_tt[ind]=format[ind];format_tt.binary=function(num){return 1===+num?"Yes":"No"},format_tt.level=function(num,unit){var type=determineType(unit);if("year"===type)return num.toFixed(0);if("PPT"===unit)return d3.format(".1f")(num);if(Math.abs(num)>=1e9)var formatted=String((num/1e9).toFixed(1))+" Bil";else if(Math.abs(num)>=1e6)var formatted=String((num/1e6).toFixed(1))+" Mil";else{if(!(Math.abs(num)>=1e4))return Math.abs(num)>=100?"currency"===type?d3.format("$,.0f")(num):d3.format(",.0f")(num):0==num?"currency"===type?"$0":0:"currency"===type?d3.format("$.2f")(num):d3.format("0f")("person"===type?num:num);var formatted=String((num/1e3).toFixed(1))+"k";"1000.0k"===formatted&&(formatted=String((num/1e6).toFixed(1))+" Mil")}return"currency"===type?"$"+formatted:formatted},format_tt.level_np=format_tt.level}();